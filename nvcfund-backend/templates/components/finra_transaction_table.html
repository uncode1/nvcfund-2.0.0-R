<!-- FINRA-Compliant Transaction Table Component -->
<!--
This component provides a FINRA-compliant transaction table with:
- Proper audit trail formatting
- Required disclosure information
- WCAG AA+ accessibility compliance
- Real-time status indicators
- Regulatory-compliant data presentation
-->

{% macro finra_transaction_table(transactions=[], title="Transaction History", show_filters=true, show_export=true) %}
<div class="nvc-transaction-table mb-4">
    <!-- Table Header -->
    <div class="d-flex justify-content-between align-items-center p-3 nvc-table-header">
        <div>
            <h5 class="mb-1 text-white">{{ title }}</h5>
            <small class="text-muted">FINRA-compliant transaction records with full audit trail</small>
        </div>
        {% if show_export %}
        <div class="btn-group" role="group" aria-label="Export options">
            <button type="button" class="btn btn-outline-light btn-sm" onclick="exportTransactions('csv')" aria-label="Export to CSV">
                <i class="fas fa-file-csv me-1" aria-hidden="true"></i>CSV
            </button>
            <button type="button" class="btn btn-outline-light btn-sm" onclick="exportTransactions('pdf')" aria-label="Export to PDF">
                <i class="fas fa-file-pdf me-1" aria-hidden="true"></i>PDF
            </button>
        </div>
        {% endif %}
    </div>

    {% if show_filters %}
    <!-- Filter Controls -->
    <div class="nvc-table-filters mb-4">
        <div class="row g-3">
            <div class="col-md-3">
                <label for="date-from" class="nvc-form-label">From Date</label>
                <input type="date" class="nvc-form-control nvc-wcag-focus" id="date-from" name="date_from">
            </div>
            <div class="col-md-3">
                <label for="date-to" class="nvc-form-label">To Date</label>
                <input type="date" class="nvc-form-control nvc-wcag-focus" id="date-to" name="date_to">
            </div>
            <div class="col-md-3">
                <label for="transaction-type" class="nvc-form-label">Transaction Type</label>
                <select class="nvc-form-control nvc-wcag-focus" id="transaction-type" name="transaction_type">
                    <option value="">All Types</option>
                    <option value="deposit">Deposit</option>
                    <option value="withdrawal">Withdrawal</option>
                    <option value="transfer">Transfer</option>
                    <option value="payment">Payment</option>
                    <option value="investment">Investment</option>
                </select>
            </div>
            <div class="col-md-3">
                <label for="status-filter" class="nvc-form-label">Status</label>
                <select class="nvc-form-control nvc-wcag-focus" id="status-filter" name="status">
                    <option value="">All Statuses</option>
                    <option value="completed">Completed</option>
                    <option value="pending">Pending</option>
                    <option value="failed">Failed</option>
                    <option value="cancelled">Cancelled</option>
                </select>
            </div>
        </div>
        <div class="mt-3">
            <button type="button" class="nvc-btn nvc-btn-primary nvc-btn-sm nvc-wcag-focus" onclick="applyFilters()">
                <i class="fas fa-filter me-2" aria-hidden="true"></i>
                Apply Filters
            </button>
            <button type="button" class="nvc-btn nvc-btn-outline nvc-btn-sm nvc-wcag-focus" onclick="clearFilters()">
                <i class="fas fa-times me-2" aria-hidden="true"></i>
                Clear Filters
            </button>
        </div>
    </div>
    {% endif %}

    <!-- Transaction Table -->
    <div class="table-responsive">
        <table class="nvc-finra-table" role="table" aria-label="FINRA-compliant transaction history">
            <thead>
                <tr role="row">
                    <th scope="col" class="sortable" data-sort="date" role="columnheader" aria-sort="none" tabindex="0">
                        <button class="nvc-table-sort-btn" aria-label="Sort by transaction date">
                            Date/Time
                            <i class="fas fa-sort ms-1" aria-hidden="true"></i>
                        </button>
                    </th>
                    <th scope="col" class="sortable" data-sort="id" role="columnheader" aria-sort="none" tabindex="0">
                        <button class="nvc-table-sort-btn" aria-label="Sort by transaction ID">
                            Transaction ID
                            <i class="fas fa-sort ms-1" aria-hidden="true"></i>
                        </button>
                    </th>
                    <th scope="col" class="sortable" data-sort="type" role="columnheader" aria-sort="none" tabindex="0">
                        <button class="nvc-table-sort-btn" aria-label="Sort by transaction type">
                            Type
                            <i class="fas fa-sort ms-1" aria-hidden="true"></i>
                        </button>
                    </th>
                    <th scope="col" class="sortable" data-sort="amount" role="columnheader" aria-sort="none" tabindex="0">
                        <button class="nvc-table-sort-btn" aria-label="Sort by transaction amount">
                            Amount
                            <i class="fas fa-sort ms-1" aria-hidden="true"></i>
                        </button>
                    </th>
                    <th scope="col" class="sortable" data-sort="status" role="columnheader" aria-sort="none" tabindex="0">
                        <button class="nvc-table-sort-btn" aria-label="Sort by transaction status">
                            Status
                            <i class="fas fa-sort ms-1" aria-hidden="true"></i>
                        </button>
                    </th>
                    <th scope="col" role="columnheader">
                        Description
                    </th>
                    <th scope="col" role="columnheader">
                        Actions
                    </th>
                </tr>
            </thead>
            <tbody>
                {% if transactions %}
                    {% for transaction in transactions %}
                    <tr role="row" data-transaction-id="{{ transaction.id }}">
                        <td data-label="Date/Time">
                            <time datetime="{{ transaction.created_at.isoformat() }}">
                                {{ transaction.created_at.strftime('%Y-%m-%d %H:%M:%S UTC') }}
                            </time>
                        </td>
                        <td data-label="Transaction ID">
                            <span class="transaction-id">{{ transaction.id }}</span>
                        </td>
                        <td data-label="Type">
                            <span class="transaction-type">{{ transaction.type.title() }}</span>
                        </td>
                        <td data-label="Amount" class="transaction-amount">
                            <span class="currency-symbol">$</span>{{ "{:,.2f}".format(transaction.amount) }}
                        </td>
                        <td data-label="Status">
                            <span class="transaction-status status-{{ transaction.status.lower() }}" 
                                  role="status" aria-label="Transaction status: {{ transaction.status }}">
                                {{ transaction.status.title() }}
                            </span>
                        </td>
                        <td data-label="Description">
                            {{ transaction.description or 'N/A' }}
                        </td>
                        <td data-label="Actions">
                            <div class="nvc-table-actions-cell">
                                <button type="button" class="nvc-btn nvc-btn-sm nvc-btn-outline nvc-wcag-focus"
                                        aria-label="View transaction {{ transaction.id }} details"
                                        onclick="viewTransaction('{{ transaction.id }}')">
                                    <i class="fas fa-eye" aria-hidden="true"></i>
                                </button>
                                {% if transaction.status.lower() == 'completed' %}
                                <button type="button" class="nvc-btn nvc-btn-sm nvc-btn-outline nvc-wcag-focus"
                                        aria-label="Download receipt for transaction {{ transaction.id }}"
                                        onclick="downloadReceipt('{{ transaction.id }}')">
                                    <i class="fas fa-receipt" aria-hidden="true"></i>
                                </button>
                                {% endif %}
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                {% else %}
                    <tr role="row">
                        <td colspan="7" class="text-center py-5">
                            <div class="nvc-empty-state">
                                <i class="fas fa-inbox fa-3x text-muted mb-3" aria-hidden="true"></i>
                                <h5 class="text-muted">No transactions found</h5>
                                <p class="text-muted">No transactions match your current filters or date range.</p>
                            </div>
                        </td>
                    </tr>
                {% endif %}
            </tbody>
        </table>
    </div>

    <!-- Pagination -->
    {% if transactions and transactions|length > 0 %}
    <div class="nvc-table-pagination mt-4">
        <div class="d-flex justify-content-between align-items-center">
            <div class="nvc-pagination-info">
                <span class="text-muted">Showing 1-{{ transactions|length }} of {{ transactions|length }} transactions</span>
            </div>
            <nav aria-label="Transaction table pagination">
                <ul class="pagination pagination-sm">
                    <li class="page-item disabled">
                        <span class="page-link" aria-label="Previous page">
                            <i class="fas fa-chevron-left" aria-hidden="true"></i>
                        </span>
                    </li>
                    <li class="page-item active">
                        <span class="page-link" aria-current="page">1</span>
                    </li>
                    <li class="page-item disabled">
                        <span class="page-link" aria-label="Next page">
                            <i class="fas fa-chevron-right" aria-hidden="true"></i>
                        </span>
                    </li>
                </ul>
            </nav>
        </div>
    </div>
    {% endif %}
</div>

<script>
// FINRA Transaction Table JavaScript
function applyFilters() {
    // Implementation for applying filters
    console.log('Applying transaction filters...');
}

function clearFilters() {
    // Implementation for clearing filters
    document.getElementById('date-from').value = '';
    document.getElementById('date-to').value = '';
    document.getElementById('transaction-type').value = '';
    document.getElementById('status-filter').value = '';
}

function viewTransaction(transactionId) {
    // Implementation for viewing transaction details
    console.log('Viewing transaction:', transactionId);
}

function downloadReceipt(transactionId) {
    // Implementation for downloading receipt
    console.log('Downloading receipt for transaction:', transactionId);
}
</script>
{% endmacro %}
