{% extends "unified_base.html" %}
{% from "components/nvc_components.html" import metric_card, action_card, account_card, transaction_row, form_input, form_select, notification_banner, progress_bar, stats_grid, loading_spinner, empty_state %}


{% block title %}Interest Rate Management Dashboard - NVC Banking & Crypto Platform{% endblock %}

{% block page_title %}Interest Rate Management{% endblock %}
{% block page_description %}Comprehensive interest rate management and yield curve analysis for treasury operations{% endblock %}

{% block page_actions %}
<button type="button" class="nvc-btn nvc-btn-outline-enterprise" data-action="custom-action">
    <i class="fas fa-download"></i>
    Export Data
</button>
<button type="button" class="nvc-btn nvc-btn-secondary-enterprise" data-action="custom-action">
    <i class="fas fa-chart-line"></i>
    Yield Curve
</button>
<button type="button" class="nvc-btn nvc-btn-primary-enterprise" data-action="custom-action">
    <i class="fas fa-percent"></i>
    Set Rates
</button>
{% endblock %}

{% block extra_css %}
<style>
    /* Interest Rate Specific Styles */
    .rate-metric-card {
        background: linear-gradient(135deg, var(--info-bg) 0%, var(--info-hover) 100%);
        border: 2px solid var(--info-color);
        border-radius: var(--border-radius-lg);
        padding: 1.5rem;
        margin-bottom: 1.5rem;
        color: white;
        transition: all 0.3s ease;
    }

    .rate-metric-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 25px rgba(6, 182, 212, 0.3);
    }
</style>
{% endblock %}

{% block content %}
<div class="nvc-page-content">
    <div class="main-content">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="h3 mb-0 text-white">
            <i class="fas fa-percent text-primary me-2"></i>
            Interest Rate Management
        </h1>
        <div class="text-light">
            <i class="fas fa-university me-1"></i>
            Fed Funds Rate: 5.25%
        </div>
    </div>

    <!-- Central Bank Rates Overview -->
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="nvc-card border-0">
                <div class="nvc-nvc-card-header bg-primary text-white">
                    <h6 class="mb-0">
                        <i class="fas fa-university me-2"></i>
                        Federal Funds Rate
                    </h6>
                </div>
                <div class="nvc-nvc-card-body text-center">
                    <h2 class="text-primary">5.25%</h2>
                    <small class="text-light">Target: 5.00% - 5.50%</small>
                    <div class="mt-2">
                        <span class="badge bg-success">
                            +0.25%
                        </span>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="nvc-card border-0">
                <div class="nvc-nvc-card-header bg-success text-white">
                    <h6 class="mb-0">
                        <i class="fas fa-chart-line me-2"></i>
                        10-Year Treasury
                    </h6>
                </div>
                <div class="nvc-nvc-card-body text-center">
                    <h2 class="text-success">4.85%</h2>
                    <small class="text-light">Benchmark Rate</small>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="nvc-card border-0">
                <div class="nvc-nvc-card-header bg-info text-white">
                    <h6 class="mb-0">
                        <i class="fas fa-clock me-2"></i>
                        SOFR Overnight
                    </h6>
                </div>
                <div class="nvc-nvc-card-body text-center">
                    <h2 class="text-info">5.30%</h2>
                    <small class="text-light">Secured Overnight</small>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="nvc-card border-0">
                <div class="nvc-nvc-card-header bg-warning text-white">
                    <h6 class="mb-0">
                        <i class="fas fa-window-restore me-2"></i>
                        Discount Window
                    </h6>
                </div>
                <div class="nvc-nvc-card-body text-center">
                    <h2 class="text-warning">5.75%</h2>
                    <small class="text-light">Primary Credit</small>
                </div>
            </div>
        </div>
    </div>

    <!-- Rate Setting Authority -->
    <div class="row mb-4">
        <div class="col-md-6">
            <div class="nvc-card border-0">
                <div class="nvc-nvc-card-header bg-primary text-white">
                    <h5 class="mb-0">
                        <i class="fas fa-user-shield me-2"></i>
                        Your Rate Authority
                    </h5>
                </div>
                <div class="nvc-nvc-card-body">
                    <div class="mb-3">
                        <h6 class="text-light mb-2">Authorized Products</h6>
                        <div class="row">
                            <div class="col-6 mb-2">
                                <div class="p-2 border rounded">
                                    <div class="fw-bold">Consumer Deposits</div>
                                    <small class="text-light">Savings, checking, and CD rates</small>
                                </div>
                            </div>
                            <div class="col-6 mb-2">
                                <div class="p-2 border rounded">
                                    <div class="fw-bold">Consumer Lending</div>
                                    <small class="text-light">Personal loans and credit cards</small>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="d-flex justify-content-center">
                        <button type="button" class="btn nvc-btn nvc-btn-primary me-2" data-bs-toggle="modal" data-bs-target="#rateChangeModal">
                            <i class="fas fa-edit me-2"></i>
                            Propose Rate Change
                        </button>
                        <a href="{{ url_for('interest_rate_management.rate_history') }}" class="btn nvc-btn nvc-btn-outline-secondary">
                            <i class="fas fa-history me-2"></i>
                            Rate History
                        </a>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="nvc-card border-0">
                <div class="nvc-nvc-card-header bg-success text-white">
                    <h5 class="mb-0">
                        <i class="fas fa-money-bill-wave me-2"></i>
                        Current Prime Rate
                    </h5>
                </div>
                <div class="nvc-nvc-card-body">
                    <div class="text-center">
                        <h1 class="display-4 text-success">8.25%</h1>
                        <p class="text-light">Prime Lending Rate</p>
                    </div>
                    <div class="row mt-3">
                        <div class="col-6">
                            <div class="text-center p-2 border rounded">
                                <small class="text-light">Formula</small>
                                <div class="fw-bold">Fed Funds + 3.00%</div>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="text-center p-2 border rounded">
                                <small class="text-light">Last Change</small>
                                <div class="fw-bold">Dec 13, 2024</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Lending vs Deposit Rates Comparison -->
    <div class="row mb-4">
        <div class="col-md-6">
            <div class="nvc-card border-0">
                <div class="nvc-nvc-card-header bg-warning text-white">
                    <h5 class="mb-0">
                        <i class="fas fa-hand-holding-usd me-2"></i>
                        Key Lending Rates
                    </h5>
                </div>
                <div class="nvc-nvc-card-body">
                    <div class="mb-3">
                        <div class="d-flex justify-content-between">
                            <span class="text-light">30-Year Mortgage (Prime):</span>
                            <span class="fw-bold">7.25%</span>
                        </div>
                    </div>
                    <div class="mb-3">
                        <div class="d-flex justify-content-between">
                            <span class="text-light">Personal Loan (Excellent):</span>
                            <span class="fw-bold">9.99%</span>
                        </div>
                    </div>
                    <div class="mb-3">
                        <div class="d-flex justify-content-between">
                            <span class="text-light">Auto Loan (New):</span>
                            <span class="fw-bold">6.75%</span>
                        </div>
                    </div>
                    <div class="mb-3">
                        <div class="d-flex justify-content-between">
                            <span class="text-light">Business Term Loan:</span>
                            <span class="fw-bold">8.50%</span>
                        </div>
                    </div>
                    <div>
                        <div class="d-flex justify-content-between">
                            <span class="text-light">Credit Cards (Prime):</span>
                            <span class="fw-bold">21.24%</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="nvc-card border-0">
                <div class="nvc-nvc-card-header bg-info text-white">
                    <h5 class="mb-0">
                        <i class="fas fa-piggy-bank me-2"></i>
                        Key Deposit Rates
                    </h5>
                </div>
                <div class="nvc-nvc-card-body">
                    <div class="mb-3">
                        <div class="d-flex justify-content-between">
                            <span class="text-light">High-Yield Savings:</span>
                            <span class="fw-bold">4.25%</span>
                        </div>
                    </div>
                    <div class="mb-3">
                        <div class="d-flex justify-content-between">
                            <span class="text-light">Money Market:</span>
                            <span class="fw-bold">3.95%</span>
                        </div>
                    </div>
                    <div class="mb-3">
                        <div class="d-flex justify-content-between">
                            <span class="text-light">1-Year CD:</span>
                            <span class="fw-bold">4.75%</span>
                        </div>
                    </div>
                    <div class="mb-3">
                        <div class="d-flex justify-content-between">
                            <span class="text-light">Business Money Market:</span>
                            <span class="fw-bold">3.50%</span>
                        </div>
                    </div>
                    <div>
                        <div class="d-flex justify-content-between">
                            <span class="text-light">Regular Savings:</span>
                            <span class="fw-bold">0.50%</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="row">
        <div class="col-12">
            <div class="nvc-card border-0">
                <div class="nvc-nvc-card-header bg-dark text-white">
                    <h5 class="mb-0">
                        <i class="fas fa-tools me-2"></i>
                        Rate Management Tools
                    </h5>
                </div>
                <div class="nvc-nvc-card-body">
                    <div class="row">
                        <div class="col-md-2">
                            <a href="{{ url_for('interest_rate_management.lending_rates') }}" class="btn nvc-btn nvc-btn-outline-warning w-100 mb-2">
                                <i class="fas fa-hand-holding-usd me-2"></i>
                                Lending Rates
                            </a>
                        </div>
                        <div class="col-md-2">
                            <a href="{{ url_for('interest_rate_management.deposit_rates') }}" class="btn nvc-btn nvc-btn-outline-info w-100 mb-2">
                                <i class="fas fa-piggy-bank me-2"></i>
                                Deposit Rates
                            </a>
                        </div>
                        <div class="col-md-2">
                            <a href="{{ url_for('interest_rate_management.rate_history') }}" class="btn nvc-btn nvc-btn-outline-secondary w-100 mb-2">
                                <i class="fas fa-history me-2"></i>
                                Rate History
                            </a>
                        </div>
                        <div class="col-md-2">
                            <a href="{{ url_for('interest_rate_management.rate_algorithms') }}" class="btn nvc-btn nvc-btn-outline-success w-100 mb-2">
                                <i class="fas fa-robot me-2"></i>
                                Algorithms
                            </a>
                        </div>
                        <div class="col-md-2">
                            <button type="button" class="btn nvc-btn nvc-btn-outline-primary w-100 mb-2" data-action="custom-action">
                                <i class="fas fa-calculator me-2"></i>
                                Calculator
                            </button>
                        </div>
                        <div class="col-md-2">
                            <button type="button" class="btn nvc-btn nvc-btn-outline-danger w-100 mb-2" data-bs-toggle="modal" data-bs-target="#emergencyRateModal">
                                <i class="fas fa-exclamation-triangle me-2"></i>
                                Emergency
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Rate Change Proposal Modal -->
<div class="modal fade" id="rateChangeModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content bg-dark">
            <div class="modal-header">
                <h5 class="modal-title text-white">
                    <i class="fas fa-edit me-2"></i>
                    Propose Rate Change
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="rateChangeForm">
                    <div class="mb-3">
                        <label class="nvc-form-label text-white">Product Category</label>
                        <select class="nvc-form-input" id="productCategory" required>
                            <option value="">Select Product Category</option>
                            <option value="consumer_deposits">Consumer Deposits</option>
                            <option value="consumer_lending">Consumer Lending</option>
                            <option value="commercial_lending">Commercial Lending</option>
                            <option value="institutional_lending">Institutional Lending</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label class="nvc-form-label text-white">Current Rate (%)</label>
                        <input type="number" class="nvc-form-input" id="currentRate" step="0.01" required>
                    </div>
                    <div class="mb-3">
                        <label class="nvc-form-label text-white">Proposed Rate (%)</label>
                        <input type="number" class="nvc-form-input" id="proposedRate" step="0.01" required>
                    </div>
                    <div class="mb-3">
                        <label class="nvc-form-label text-white">Effective Date</label>
                        <input type="date" class="nvc-form-input" id="effectiveDate" required>
                    </div>
                    <div class="mb-3">
                        <label class="nvc-form-label text-white">Justification</label>
                        <textarea class="nvc-form-input" id="justification" rows="3" required 
                                  placeholder="Provide business justification for the rate change..."></textarea>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn nvc-btn nvc-btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn nvc-btn nvc-btn-primary" data-action="custom-action">
                    <i class="fas fa-paper-plane me-2"></i>
                    Submit Proposal
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Rate Calculator Modal -->
<div class="modal fade" id="rateCalculatorModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content bg-dark">
            <div class="modal-header">
                <h5 class="modal-title text-white">
                    <i class="fas fa-calculator me-2"></i>
                    Rate Change Impact Calculator
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="calculatorForm">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="nvc-form-label text-white">Product Type</label>
                                <select class="nvc-form-input" id="calcProductType" required>
                                    <option value="savings">Savings Account</option>
                                    <option value="cd">Certificate of Deposit</option>
                                    <option value="mortgage">Mortgage</option>
                                    <option value="personal_loan">Personal Loan</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label class="nvc-form-label text-white">Current Rate (%)</label>
                                <input type="number" class="nvc-form-input" id="calcCurrentRate" step="0.01" required>
                            </div>
                            <div class="mb-3">
                                <label class="nvc-form-label text-white">Proposed Rate (%)</label>
                                <input type="number" class="nvc-form-input" id="calcProposedRate" step="0.01" required>
                            </div>
                            <div class="mb-3">
                                <label class="nvc-form-label text-white">Portfolio Amount ($)</label>
                                <input type="number" class="nvc-form-input" id="calcPortfolioAmount" required>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div id="calculationResults" class="border rounded p-3" class="d-none">
                                <h6 class="text-white mb-3">Impact Analysis</h6>
                                <div class="mb-2">
                                    <span class="text-light">Rate Change:</span>
                                    <span class="fw-bold" id="rateChange">0.00%</span>
                                </div>
                                <div class="mb-2">
                                    <span class="text-light">Annual Revenue Impact:</span>
                                    <span class="fw-bold" id="annualImpact">$0</span>
                                </div>
                                <div class="mb-2">
                                    <span class="text-light">Monthly Impact:</span>
                                    <span class="fw-bold" id="monthlyImpact">$0</span>
                                </div>
                                <div class="mb-2">
                                    <span class="text-light">Customer Impact (per $100):</span>
                                    <span class="fw-bold" id="customerImpact">$0</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn nvc-btn nvc-btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn nvc-btn nvc-btn-primary" data-action="custom-action">
                    <i class="fas fa-calculator me-2"></i>
                    Calculate Impact
                </button>
            </div>
        </div>
    </div>
</div>

<script>
function openRateCalculator() {
    $('#rateCalculatorModal').modal('show');
}

function calculateImpact() {
    const currentRate = parseFloat(document.getElementById('calcCurrentRate').value) || 0;
    const proposedRate = parseFloat(document.getElementById('calcProposedRate').value) || 0;
    const portfolioAmount = parseFloat(document.getElementById('calcPortfolioAmount').value) || 0;
    
    if (currentRate && proposedRate && portfolioAmount) {
        const rateChange = proposedRate - currentRate;
        const annualImpact = (rateChange / 100) * portfolioAmount;
        const monthlyImpact = annualImpact / 12;
        const customerImpact = rateChange;
        
        document.getElementById('rateChange').textContent = (rateChange >= 0 ? '+' : '') + rateChange.toFixed(2) + '%';
        document.getElementById('annualImpact').textContent = '$' + annualImpact.toLocaleString();
        document.getElementById('monthlyImpact').textContent = '$' + monthlyImpact.toLocaleString();
        document.getElementById('customerImpact').textContent = '$' + customerImpact.toFixed(2);
        
        document.getElementById('calculationResults').style.display = 'block';
    }
}

function submitRateChange() {
    const formData = {
        product_category: document.getElementById('productCategory').value,
        current_rate: parseFloat(document.getElementById('currentRate').value),
        proposed_rate: parseFloat(document.getElementById('proposedRate').value),
        effective_date: document.getElementById('effectiveDate').value,
        justification: document.getElementById('justification').value
    };
    
    // Mock submission
    alert('Rate change proposal submitted for review. Proposal ID: PROP-' + Math.floor(Math.random() * 10000));
    $('#rateChangeModal').modal('hide');
}
</script>
</div>
{% endblock %}