{% extends "unified_base.html" %}
{% from "components/nvc_components.html" import metric_card, action_card, account_card, transaction_row, form_input, form_select, notification_banner, progress_bar, stats_grid, loading_spinner, empty_state %}
{% from "components/unified_card_system.html" import metric_card_standard, action_card_standard, content_card_standard, account_card_standard, transaction_row_standard, stats_grid_standard, quick_actions_grid_standard, notification_banner_standard, progress_bar_standard, loading_spinner_standard, empty_state_standard, form_input_standard, form_select_standard %}


{% block title %}Performance Analytics - NVC Banking Platform{% endblock %}

{% block content %}
<div class="nvc-page-content">
    <div class="container-fluid py-4">
    <!-- Analytics Header -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="nvc-card bg-gradient-primary">
                <div class="nvc-nvc-card-body">
                    <div class="row align-items-center">
                        <div class="col">
                            <h1 class="h2 text-white mb-2">
                                <i class="fas fa-chart-bar me-2"></i>Performance Analytics
                            </h1>
                            <p class="text-light mb-0">Comprehensive performance metrics and business intelligence</p>
                        </div>
                        <div class="col-auto">
                            <a href="{{ url_for('analytics.analytics_dashboard') }}" class="btn btn-light">
                                <i class="fas fa-arrow-left me-2"></i>Back to Analytics
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Key Performance Indicators -->
    <div class="row mb-4">
        <div class="col-lg-3 col-md-6 mb-3">
            <div class="nvc-card bg-success">
                <div class="nvc-nvc-card-body text-center">
                    <i class="fas fa-dollar-sign fa-3x text-white-50 mb-3"></i>
                    <h4 class="text-white">Total Revenue</h4>
                    <h2 class="text-white">${{ "847.2M"|default("0") }}</h2>
                    <small class="text-light">YTD Revenue</small>
                </div>
            </div>
        </div>
        <div class="col-lg-3 col-md-6 mb-3">
            <div class="nvc-card bg-info">
                <div class="nvc-nvc-card-body text-center">
                    <i class="fas fa-users fa-3x text-white-50 mb-3"></i>
                    <h4 class="text-white">Active Users</h4>
                    <h2 class="text-white">{{ "2.45M"|default("0") }}</h2>
                    <small class="text-light">Monthly Active Users</small>
                </div>
            </div>
        </div>
        <div class="col-lg-3 col-md-6 mb-3">
            <div class="nvc-card bg-warning">
                <div class="nvc-nvc-card-body text-center">
                    <i class="fas fa-exchange-alt fa-3x text-white-50 mb-3"></i>
                    <h4 class="text-white">Transactions</h4>
                    <h2 class="text-white">{{ "15.8M"|default("0") }}</h2>
                    <small class="text-light">Monthly Volume</small>
                </div>
            </div>
        </div>
        <div class="col-lg-3 col-md-6 mb-3">
            <div class="nvc-card bg-primary">
                <div class="nvc-nvc-card-body text-center">
                    <i class="fas fa-percentage fa-3x text-white-50 mb-3"></i>
                    <h4 class="text-white">Growth Rate</h4>
                    <h2 class="text-white">{{ "+23.5%"|default("0%") }}</h2>
                    <small class="text-light">YoY Growth</small>
                </div>
            </div>
        </div>
    </div>

    <!-- Performance Charts -->
    <div class="row">
        <div class="col-lg-8 mb-4">
            <div class="nvc-card">
                <div class="nvc-nvc-card-header d-flex justify-content-between">
                    <h5><i class="fas fa-chart-line me-2"></i>Revenue Trends</h5>
                    <div class="btn-group btn-group-sm">
                        <button type="button" class="btn nvc-btn nvc-btn-outline-primary active">YTD</button>
                        <button type="button" class="btn nvc-btn nvc-btn-outline-primary">1Y</button>
                        <button type="button" class="btn nvc-btn nvc-btn-outline-primary">3Y</button>
                    </div>
                </div>
                <div class="nvc-nvc-card-body">
                    <canvas id="revenueChart" height="300"></canvas>
                </div>
            </div>
        </div>

        <div class="col-lg-4 mb-4">
            <div class="nvc-card">
                <div class="nvc-nvc-card-header">
                    <h5><i class="fas fa-chart-pie me-2"></i>Revenue Distribution</h5>
                </div>
                <div class="nvc-nvc-card-body">
                    <canvas id="distributionChart" height="300"></canvas>
                    <div class="mt-3">
                        <div class="d-flex justify-content-between mb-2">
                            <span><i class="fas fa-circle text-primary"></i> Banking Services</span>
                            <span>45%</span>
                        </div>
                        <div class="d-flex justify-content-between mb-2">
                            <span><i class="fas fa-circle text-success"></i> Investment Services</span>
                            <span>28%</span>
                        </div>
                        <div class="d-flex justify-content-between mb-2">
                            <span><i class="fas fa-circle text-warning"></i> Trading Fees</span>
                            <span>18%</span>
                        </div>
                        <div class="d-flex justify-content-between">
                            <span><i class="fas fa-circle text-info"></i> Other Services</span>
                            <span>9%</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Detailed Analytics -->
    <div class="row">
        <div class="col-lg-6 mb-4">
            <div class="nvc-card">
                <div class="nvc-nvc-card-header">
                    <h5><i class="fas fa-users-cog me-2"></i>User Analytics</h5>
                </div>
                <div class="nvc-nvc-card-body">
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>Metric</th>
                                    <th>Current</th>
                                    <th>Previous</th>
                                    <th>Change</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>New Registrations</td>
                                    <td>{{ "24,567"|default("0") }}</td>
                                    <td>{{ "19,234"|default("0") }}</td>
                                    <td><span class="text-success">+27.7%</span></td>
                                </tr>
                                <tr>
                                    <td>Average Session Duration</td>
                                    <td>{{ "12m 34s"|default("0m") }}</td>
                                    <td>{{ "11m 28s"|default("0m") }}</td>
                                    <td><span class="text-success">+9.6%</span></td>
                                </tr>
                                <tr>
                                    <td>User Retention (30d)</td>
                                    <td>{{ "78.3%"|default("0%") }}</td>
                                    <td>{{ "75.1%"|default("0%") }}</td>
                                    <td><span class="text-success">+4.3%</span></td>
                                </tr>
                                <tr>
                                    <td>Customer Satisfaction</td>
                                    <td>{{ "4.6/5"|default("0/5") }}</td>
                                    <td>{{ "4.4/5"|default("0/5") }}</td>
                                    <td><span class="text-success">+4.5%</span></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-lg-6 mb-4">
            <div class="nvc-card">
                <div class="nvc-nvc-card-header">
                    <h5><i class="fas fa-chart-area me-2"></i>Transaction Analytics</h5>
                </div>
                <div class="nvc-nvc-card-body">
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>Transaction Type</th>
                                    <th>Volume</th>
                                    <th>Value</th>
                                    <th>Avg Size</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Wire Transfers</td>
                                    <td>{{ "847K"|default("0") }}</td>
                                    <td>${{ "2.1B"|default("0") }}</td>
                                    <td>${{ "2,478"|default("0") }}</td>
                                </tr>
                                <tr>
                                    <td>ACH Transfers</td>
                                    <td>{{ "12.4M"|default("0") }}</td>
                                    <td>${{ "8.7B"|default("0") }}</td>
                                    <td>${{ "701"|default("0") }}</td>
                                </tr>
                                <tr>
                                    <td>Card Transactions</td>
                                    <td>{{ "45.7M"|default("0") }}</td>
                                    <td>${{ "3.2B"|default("0") }}</td>
                                    <td>${{ "70"|default("0") }}</td>
                                </tr>
                                <tr>
                                    <td>Investment Trades</td>
                                    <td>{{ "234K"|default("0") }}</td>
                                    <td>${{ "1.8B"|default("0") }}</td>
                                    <td>${{ "7,692"|default("0") }}</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Geographic and Demographic Analytics -->
    <div class="row">
        <div class="col-lg-8 mb-4">
            <div class="nvc-card">
                <div class="nvc-nvc-card-header">
                    <h5><i class="fas fa-globe me-2"></i>Geographic Distribution</h5>
                </div>
                <div class="nvc-nvc-card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h6>Top Regions by Revenue</h6>
                            <div class="mb-3">
                                <div class="d-flex justify-content-between">
                                    <span>North America</span>
                                    <span>$425M (50.2%)</span>
                                </div>
                                <div class="progress">
                                    <div class="progress-bar bg-primary" class="progress-bar-50"></div>
                                </div>
                            </div>
                            <div class="mb-3">
                                <div class="d-flex justify-content-between">
                                    <span>Europe</span>
                                    <span>$254M (30.0%)</span>
                                </div>
                                <div class="progress">
                                    <div class="progress-bar bg-success" class="progress-bar-30"></div>
                                </div>
                            </div>
                            <div class="mb-3">
                                <div class="d-flex justify-content-between">
                                    <span>Asia Pacific</span>
                                    <span>$127M (15.0%)</span>
                                </div>
                                <div class="progress">
                                    <div class="progress-bar bg-warning" class="progress-bar-15"></div>
                                </div>
                            </div>
                            <div class="mb-3">
                                <div class="d-flex justify-content-between">
                                    <span>Other</span>
                                    <span>$41M (4.8%)</span>
                                </div>
                                <div class="progress">
                                    <div class="progress-bar bg-info" class="progress-bar-5"></div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <h6>Growth by Region (YoY)</h6>
                            <div class="table-responsive">
                                <table class="table table-sm">
                                    <thead>
                                        <tr>
                                            <th>Region</th>
                                            <th>Growth</th>
                                            <th>Trend</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>Asia Pacific</td>
                                            <td>+45.2%</td>
                                            <td><i class="fas fa-arrow-up text-success"></i></td>
                                        </tr>
                                        <tr>
                                            <td>Europe</td>
                                            <td>+28.7%</td>
                                            <td><i class="fas fa-arrow-up text-success"></i></td>
                                        </tr>
                                        <tr>
                                            <td>North America</td>
                                            <td>+18.3%</td>
                                            <td><i class="fas fa-arrow-up text-success"></i></td>
                                        </tr>
                                        <tr>
                                            <td>Latin America</td>
                                            <td>+52.1%</td>
                                            <td><i class="fas fa-arrow-up text-success"></i></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-lg-4 mb-4">
            <div class="nvc-card">
                <div class="nvc-nvc-card-header">
                    <h5><i class="fas fa-exclamation-triangle me-2"></i>Performance Alerts</h5>
                </div>
                <div class="nvc-nvc-card-body">
                    <div class="alert nvc-nvc-alert-success" role="alert">
                        <i class="fas fa-check-circle me-2"></i>
                        <strong>Revenue Target:</strong> 124% of monthly target achieved
                    </div>
                    <div class="alert nvc-nvc-alert-warning" role="alert">
                        <i class="fas fa-exclamation-triangle me-2"></i>
                        <strong>Processing Time:</strong> Average increased by 15% this week
                    </div>
                    <div class="alert nvc-nvc-alert-info" role="alert">
                        <i class="fas fa-info-circle me-2"></i>
                        <strong>New Market:</strong> Asia Pacific growth exceeds projections
                    </div>
                    <div class="alert nvc-nvc-alert-danger" role="alert">
                        <i class="fas fa-times-circle me-2"></i>
                        <strong>Churn Rate:</strong> Enterprise segment churn above threshold
                    </div>
                </div>
            </div>

            <div class="nvc-card mt-3">
                <div class="nvc-nvc-card-header">
                    <h5><i class="fas fa-download me-2"></i>Export Options</h5>
                </div>
                <div class="nvc-nvc-card-body">
                    <div class="d-grid gap-2">
                        <button type="button" class="btn nvc-btn nvc-btn-primary">
                            <i class="fas fa-file-excel me-2"></i>Export to Excel
                        </button>
                        <button type="button" class="btn nvc-btn nvc-btn-success">
                            <i class="fas fa-file-pdf me-2"></i>Generate PDF Report
                        </button>
                        <button type="button" class="btn btn-info">
                            <i class="fas fa-chart-bar me-2"></i>Create Dashboard
                        </button>
                        <button type="button" class="btn nvc-btn nvc-btn-secondary">
                            <i class="fas fa-share me-2"></i>Share Report
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Revenue Chart
    const revenueCtx = document.getElementById('revenueChart').getContext('2d');
    new Chart(revenueCtx, {
        type: 'line',
        data: {
            labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
            datasets: [{
                label: 'Revenue (Millions)',
                data: [45, 52, 58, 61, 67, 73, 78, 82, 86, 91, 95, 98],
                borderColor: '#0d6efd',
                backgroundColor: 'rgba(13, 110, 253, 0.1)',
                tension: 0.4
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: {
                    beginAtZero: true,
                    ticks: {
                        callback: function(value) {
                            return '$' + value + 'M';
                        }
                    }
                }
            }
        }
    });

    // Distribution Chart
    const distributionCtx = document.getElementById('distributionChart').getContext('2d');
    new Chart(distributionCtx, {
        type: 'pie',
        data: {
            labels: ['Banking Services', 'Investment Services', 'Trading Fees', 'Other Services'],
            datasets: [{
                data: [45, 28, 18, 9],
                backgroundColor: ['#0d6efd', '#198754', '#ffc107', '#17a2b8']
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    display: false
                }
            }
        }
    });
});
</script>
</div>
{% endblock %}