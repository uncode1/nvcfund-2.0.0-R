{% extends "unified_base.html" %}
{% from "components/nvc_components.html" import metric_card, action_card, account_card, transaction_row, form_input, form_select, notification_banner, progress_bar, stats_grid, loading_spinner, empty_state %}


{% block content %}
<div class="nvc-page-content">
    <div class="container-fluid">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="text-white mb-0">Liquidity Management</h1>
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb bg-transparent mb-0">
                <li class="breadcrumb-item"><a href="{{ url_for('treasury.main_dashboard') }}" class="text-info">Treasury</a></li>
                <li class="breadcrumb-item active text-white">Liquidity Management</li>
            </ol>
        </nav>
    </div>

    <!-- Liquidity Overview -->
    <div class="row mb-4">
        <div class="col-lg-3 col-md-6 mb-3">
            <div class="dashboard-stat-nvc-card">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="text-light mb-1">Available Liquidity</h6>
                        <h3 class="text-success mb-0">$847.2M</h3>
                        <small class="text-success">+5.2% from target</small>
                    </div>
                    <div class="stat-icon">
                        <i class="fas fa-tint text-success"></i>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-3 col-md-6 mb-3">
            <div class="dashboard-stat-nvc-card">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="text-light mb-1">Liquidity Ratio</h6>
                        <h3 class="text-white mb-0">15.7%</h3>
                        <small class="text-info">Above minimum 12%</small>
                    </div>
                    <div class="stat-icon">
                        <i class="fas fa-percentage text-info"></i>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-3 col-md-6 mb-3">
            <div class="dashboard-stat-nvc-card">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="text-light mb-1">LCR</h6>
                        <h3 class="text-success mb-0">124.3%</h3>
                        <small class="text-success">Basel III compliant</small>
                    </div>
                    <div class="stat-icon">
                        <i class="fas fa-shield-alt text-success"></i>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-3 col-md-6 mb-3">
            <div class="dashboard-stat-nvc-card">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h6 class="text-light mb-1">NSFR</h6>
                        <h3 class="text-success mb-0">118.9%</h3>
                        <small class="text-success">Stable funding</small>
                    </div>
                    <div class="stat-icon">
                        <i class="fas fa-chart-line text-primary"></i>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Liquidity Analysis Charts -->
    <div class="row mb-4">
        <div class="col-lg-8">
            <div class="dashboard-stat-nvc-card">
                <div class="nvc-nvc-card-header d-flex justify-content-between align-items-center">
                    <h5 class="text-white mb-0">Liquidity Position Trends</h5>
                    <div class="btn-group" role="group">
                        <button type="button" class="btn nvc-btn nvc-btn-outline-info btn-sm active">Daily</button>
                        <button type="button" class="btn nvc-btn nvc-btn-outline-info btn-sm">Weekly</button>
                        <button type="button" class="btn nvc-btn nvc-btn-outline-info btn-sm">Monthly</button>
                        <button type="button" class="btn nvc-btn nvc-btn-outline-info btn-sm">Quarterly</button>
                    </div>
                </div>
                <div class="nvc-nvc-card-body">
                    <canvas id="liquidityTrendsChart" height="300"></canvas>
                </div>
            </div>
        </div>
        <div class="col-lg-4">
            <div class="dashboard-stat-nvc-card">
                <div class="nvc-nvc-card-header">
                    <h6 class="text-white mb-0">Liquidity Sources</h6>
                </div>
                <div class="nvc-nvc-card-body">
                    <canvas id="liquiditySourcesChart" height="250"></canvas>
                </div>
            </div>
        </div>
    </div>

    <!-- Detailed Liquidity Breakdown -->
    <div class="row mb-4">
        <div class="col-lg-6">
            <div class="dashboard-stat-nvc-card">
                <div class="nvc-nvc-card-header">
                    <h6 class="text-white mb-0">High-Quality Liquid Assets (HQLA)</h6>
                </div>
                <div class="nvc-nvc-card-body">
                    <div class="hqla-item d-flex justify-content-between align-items-center mb-3">
                        <div class="d-flex align-items-center">
                            <div class="hqla-icon bg-success me-3">
                                <i class="fas fa-coins text-white"></i>
                            </div>
                            <div>
                                <div class="text-white fw-bold">Cash & Central Bank Reserves</div>
                                <div class="text-light small">Level 1 assets</div>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="text-success fw-bold">$425.8M</div>
                            <div class="text-light small">50.3%</div>
                        </div>
                    </div>
                    <div class="hqla-item d-flex justify-content-between align-items-center mb-3">
                        <div class="d-flex align-items-center">
                            <div class="hqla-icon bg-primary me-3">
                                <i class="fas fa-certificate text-white"></i>
                            </div>
                            <div>
                                <div class="text-white fw-bold">Government Securities</div>
                                <div class="text-light small">Level 1 assets</div>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="text-primary fw-bold">$234.7M</div>
                            <div class="text-light small">27.7%</div>
                        </div>
                    </div>
                    <div class="hqla-item d-flex justify-content-between align-items-center mb-3">
                        <div class="d-flex align-items-center">
                            <div class="hqla-icon bg-info me-3">
                                <i class="fas fa-building text-white"></i>
                            </div>
                            <div>
                                <div class="text-white fw-bold">Corporate Bonds</div>
                                <div class="text-light small">Level 2A assets</div>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="text-info fw-bold">$124.5M</div>
                            <div class="text-light small">14.7%</div>
                        </div>
                    </div>
                    <div class="hqla-item d-flex justify-content-between align-items-center">
                        <div class="d-flex align-items-center">
                            <div class="hqla-icon bg-warning me-3">
                                <i class="fas fa-home text-white"></i>
                            </div>
                            <div>
                                <div class="text-white fw-bold">Covered Bonds</div>
                                <div class="text-light small">Level 2B assets</div>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="text-warning fw-bold">$62.2M</div>
                            <div class="text-light small">7.3%</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-6">
            <div class="dashboard-stat-nvc-card">
                <div class="nvc-nvc-card-header">
                    <h6 class="text-white mb-0">Funding Sources</h6>
                </div>
                <div class="nvc-nvc-card-body">
                    <div class="funding-item d-flex justify-content-between align-items-center mb-3">
                        <div class="d-flex align-items-center">
                            <div class="funding-icon bg-primary me-3">
                                <i class="fas fa-users text-white"></i>
                            </div>
                            <div>
                                <div class="text-white fw-bold">Customer Deposits</div>
                                <div class="text-light small">Retail & corporate</div>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="text-primary fw-bold">$1.2B</div>
                            <div class="text-light small">Stable 78.5%</div>
                        </div>
                    </div>
                    <div class="funding-item d-flex justify-content-between align-items-center mb-3">
                        <div class="d-flex align-items-center">
                            <div class="funding-icon bg-success me-3">
                                <i class="fas fa-handshake text-white"></i>
                            </div>
                            <div>
                                <div class="text-white fw-bold">Interbank Funding</div>
                                <div class="text-light small">Overnight & term</div>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="text-success fw-bold">$185.4M</div>
                            <div class="text-light small">12.1%</div>
                        </div>
                    </div>
                    <div class="funding-item d-flex justify-content-between align-items-center mb-3">
                        <div class="d-flex align-items-center">
                            <div class="funding-icon bg-warning me-3">
                                <i class="fas fa-chart-line text-white"></i>
                            </div>
                            <div>
                                <div class="text-white fw-bold">Capital Markets</div>
                                <div class="text-light small">Bonds & equity</div>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="text-warning fw-bold">$97.8M</div>
                            <div class="text-light small">6.4%</div>
                        </div>
                    </div>
                    <div class="funding-item d-flex justify-content-between align-items-center">
                        <div class="d-flex align-items-center">
                            <div class="funding-icon bg-info me-3">
                                <i class="fas fa-university text-white"></i>
                            </div>
                            <div>
                                <div class="text-white fw-bold">Central Bank</div>
                                <div class="text-light small">Emergency facilities</div>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="text-info fw-bold">$45.6M</div>
                            <div class="text-light small">3.0%</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Stress Testing & Scenarios -->
    <div class="row">
        <div class="col-lg-8">
            <div class="dashboard-stat-nvc-card">
                <div class="nvc-nvc-card-header d-flex justify-content-between align-items-center">
                    <h5 class="text-white mb-0">Liquidity Stress Testing</h5>
                    <button type="button" class="btn nvc-btn nvc-btn-primary btn-sm">
                        <i class="fas fa-play me-2"></i>Run Stress Test
                    </button>
                </div>
                <div class="nvc-nvc-card-body">
                    <div class="table-responsive">
                        <table class="table table-dark table-striped">
                            <thead>
                                <tr>
                                    <th>Scenario</th>
                                    <th>Liquidity Impact</th>
                                    <th>Survival Days</th>
                                    <th>LCR Impact</th>
                                    <th>Status</th>
                                    <th>Action Required</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>Mild Stress</strong></td>
                                    <td class="text-warning">-$125.4M</td>
                                    <td class="text-success">180+ days</td>
                                    <td class="text-info">98.7%</td>
                                    <td><span class="badge bg-success">Pass</span></td>
                                    <td class="text-light">None</td>
                                </tr>
                                <tr>
                                    <td><strong>Moderate Stress</strong></td>
                                    <td class="text-warning">-$247.8M</td>
                                    <td class="text-warning">45 days</td>
                                    <td class="text-warning">87.2%</td>
                                    <td><span class="badge bg-warning">Monitor</span></td>
                                    <td class="text-warning">Review funding</td>
                                </tr>
                                <tr>
                                    <td><strong>Severe Stress</strong></td>
                                    <td class="text-danger">-$425.6M</td>
                                    <td class="text-danger">15 days</td>
                                    <td class="text-danger">65.8%</td>
                                    <td><span class="badge bg-danger">Alert</span></td>
                                    <td class="text-danger">Contingency plan</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-4">
            <div class="dashboard-stat-nvc-card">
                <div class="nvc-nvc-card-header">
                    <h6 class="text-white mb-0">Key Metrics</h6>
                </div>
                <div class="nvc-nvc-card-body">
                    <div class="metric-item mb-3">
                        <div class="d-flex justify-content-between align-items-center">
                            <span class="text-light">Liquidity Buffer</span>
                            <span class="text-success fw-bold">$247.8M</span>
                        </div>
                        <div class="progress mt-1" class="nvc-h-4">
                            <div class="progress-bar bg-success" class="progress-bar-85"></div>
                        </div>
                    </div>
                    <div class="metric-item mb-3">
                        <div class="d-flex justify-content-between align-items-center">
                            <span class="text-light">Loan-to-Deposit</span>
                            <span class="text-info fw-bold">76.3%</span>
                        </div>
                        <div class="progress mt-1" class="nvc-h-4">
                            <div class="progress-bar bg-info" class="progress-bar-76"></div>
                        </div>
                    </div>
                    <div class="metric-item mb-3">
                        <div class="d-flex justify-content-between align-items-center">
                            <span class="text-light">Cost of Funding</span>
                            <span class="text-warning fw-bold">2.85%</span>
                        </div>
                        <div class="progress mt-1" class="nvc-h-4">
                            <div class="progress-bar bg-warning" class="progress-bar-58"></div>
                        </div>
                    </div>
                    <div class="metric-item">
                        <div class="d-flex justify-content-between align-items-center">
                            <span class="text-light">Maturity Mismatch</span>
                            <span class="text-primary fw-bold">1.24x</span>
                        </div>
                        <div class="progress mt-1" class="nvc-h-4">
                            <div class="progress-bar bg-primary" class="progress-bar-62"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Liquidity Trends Chart
    const trendsCtx = document.getElementById('liquidityTrendsChart').getContext('2d');
    new Chart(trendsCtx, {
        type: 'line',
        data: {
            labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
            datasets: [{
                label: 'Available Liquidity',
                data: [840, 852, 845, 847, 849, 851, 847],
                borderColor: '#28a745',
                backgroundColor: 'rgba(40, 167, 69, 0.1)',
                fill: true,
                tension: 0.4
            }, {
                label: 'LCR Ratio',
                data: [122, 125, 123, 124, 125, 126, 124],
                borderColor: '#007bff',
                backgroundColor: 'rgba(0, 123, 255, 0.1)',
                fill: false,
                yAxisID: 'y1'
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    labels: {
                        color: '#e2e8f0'
                    }
                }
            },
            scales: {
                x: {
                    ticks: {
                        color: '#e2e8f0'
                    },
                    grid: {
                        color: 'rgba(226, 232, 240, 0.1)'
                    }
                },
                y: {
                    type: 'linear',
                    display: true,
                    position: 'left',
                    ticks: {
                        color: '#e2e8f0',
                        callback: function(value) {
                            return '$' + value + 'M';
                        }
                    },
                    grid: {
                        color: 'rgba(226, 232, 240, 0.1)'
                    }
                },
                y1: {
                    type: 'linear',
                    display: true,
                    position: 'right',
                    ticks: {
                        color: '#e2e8f0',
                        callback: function(value) {
                            return value + '%';
                        }
                    },
                    grid: {
                        drawOnChartArea: false
                    }
                }
            }
        }
    });

    // Liquidity Sources Chart
    const sourcesCtx = document.getElementById('liquiditySourcesChart').getContext('2d');
    new Chart(sourcesCtx, {
        type: 'doughnut',
        data: {
            labels: ['Cash & Reserves', 'Gov Securities', 'Corporate Bonds', 'Covered Bonds'],
            datasets: [{
                data: [50.3, 27.7, 14.7, 7.3],
                backgroundColor: ['#28a745', '#007bff', '#17a2b8', '#ffc107'],
                borderWidth: 0
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'bottom',
                    labels: {
                        color: '#e2e8f0',
                        padding: 10
                    }
                }
            }
        }
    });
});
</script>
</div>
{% endblock %}