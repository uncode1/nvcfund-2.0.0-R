{% extends "unified_base.html" %}
{% from "components/nvc_components.html" import metric_card, action_card, account_card, transaction_row, form_input, form_select, notification_banner, progress_bar, stats_grid, loading_spinner, empty_state %}
{% from "macros/finra_macros.html" import finra_transaction_table, finra_compliance_summary %}

{% block title %}Performance Monitoring - NVC Banking Platform{% endblock %}

{% block page_title %}Performance Monitoring{% endblock %}
{% block page_description %}Real-time system performance analytics and monitoring{% endblock %}

{% block breadcrumb_items %}
<li class="nvc-breadcrumb-item">
    <a href="{{ url_for('admin_management.admin_dashboard') }}" class="nvc-wcag-focus">
        <i class="fas fa-shield-alt" aria-hidden="true"></i>
        Administration
    </a>
</li>
<li class="nvc-breadcrumb-item">
    <a href="{{ url_for('admin_management.system_monitoring') }}" class="nvc-wcag-focus">
        <i class="fas fa-desktop" aria-hidden="true"></i>
        System Management
    </a>
</li>
<li class="nvc-breadcrumb-item active">
    <i class="fas fa-chart-line" aria-hidden="true"></i>
    Performance Monitoring
</li>
{% endblock %}

{% block page_actions %}
<button type="button" class="nvc-btn nvc-btn-outline nvc-btn-sm nvc-wcag-focus" aria-label="Refresh performance data">
    <i class="fas fa-sync-alt" aria-hidden="true"></i>
    Refresh
</button>
<button type="button" class="nvc-btn nvc-btn-secondary nvc-btn-sm nvc-wcag-focus" aria-label="Export performance report">
    <i class="fas fa-download" aria-hidden="true"></i>
    Export Report
</button>
<button type="button" class="nvc-btn nvc-btn-primary nvc-btn-sm nvc-wcag-focus" aria-label="Configure monitoring settings">
    <i class="fas fa-cog" aria-hidden="true"></i>
    Configure
</button>
{% endblock %}

        /* Form Container */
        .form-container {
            max-width: 800px;
            margin: 2rem auto;
            padding: 0 1rem;
        }

{% block content %}
<div class="nvc-dashboard-content">
    <div class="nvc-container-fluid">
        <!-- Performance Overview -->
        <div class="nvc-dashboard-section nvc-dashboard-section-primary">
            <div class="nvc-section-header">
                <h2 class="nvc-section-title nvc-wcag-high-contrast">
                    <i class="fas fa-chart-line" aria-hidden="true"></i>
                    Performance Overview
                </h2>
                <div class="nvc-section-actions">
                    <span class="nvc-badge nvc-badge-info">
                        <i class="fas fa-clock" aria-hidden="true"></i>
                        Real-time Monitoring
                    </span>
                </div>
            </div>

            <div class="nvc-section-content">
                <!-- Performance Metrics Dashboard -->
                <div class="nvc-dashboard-grid">
                    <div class="nvc-metrics-row">
                        <div class="nvc-metric-card nvc-metric-success">
                            <div class="nvc-metric-header">
                                <div class="nvc-metric-icon nvc-metric-icon-success">
                                    <i class="fas fa-tachometer-alt" aria-hidden="true"></i>
                                </div>
                                <div class="nvc-metric-trend nvc-trend-positive">
                                    <i class="fas fa-arrow-up" aria-hidden="true"></i>
                                    <span>+15%</span>
                                </div>
                            </div>
                            <div class="nvc-metric-content">
                                <h3 class="nvc-metric-value nvc-wcag-high-contrast">{{ performance_data.response_time or '12' }}ms</h3>
                                <p class="nvc-metric-label nvc-wcag-medium-contrast">Avg Response Time</p>
                                <p class="nvc-metric-subtitle">Last 24 hours</p>
                            </div>
                        </div>

                        <div class="nvc-metric-card nvc-metric-info">
                            <div class="nvc-metric-header">
                                <div class="nvc-metric-icon nvc-metric-icon-info">
                                    <i class="fas fa-exchange-alt" aria-hidden="true"></i>
                                </div>
                                <div class="nvc-metric-trend nvc-trend-positive">
                                    <i class="fas fa-arrow-up" aria-hidden="true"></i>
                                    <span>+8%</span>
                                </div>
                            </div>
                            <div class="nvc-metric-content">
                                <h3 class="nvc-metric-value nvc-wcag-high-contrast">{{ performance_data.throughput or '1,247' }}/sec</h3>
                                <p class="nvc-metric-label nvc-wcag-medium-contrast">Throughput</p>
                                <p class="nvc-metric-subtitle">Requests per second</p>
                            </div>
                        </div>

                        <div class="nvc-metric-card nvc-metric-warning">
                            <div class="nvc-metric-header">
                                <div class="nvc-metric-icon nvc-metric-icon-warning">
                                    <i class="fas fa-exclamation-triangle" aria-hidden="true"></i>
                                </div>
                                <div class="nvc-metric-trend nvc-trend-negative">
                                    <i class="fas fa-arrow-down" aria-hidden="true"></i>
                                    <span>-2%</span>
                                </div>
                            </div>
                            <div class="nvc-metric-content">
                                <h3 class="nvc-metric-value nvc-wcag-high-contrast">{{ performance_data.error_rate or '0.23' }}%</h3>
                                <p class="nvc-metric-label nvc-wcag-medium-contrast">Error Rate</p>
                                <p class="nvc-metric-subtitle">System errors</p>
                            </div>
                        </div>

                        <div class="nvc-metric-card nvc-metric-success">
                            <div class="nvc-metric-header">
                                <div class="nvc-metric-icon nvc-metric-icon-success">
                                    <i class="fas fa-check-circle" aria-hidden="true"></i>
                                </div>
                                <div class="nvc-metric-trend nvc-trend-positive">
                                    <i class="fas fa-check" aria-hidden="true"></i>
                                    <span>99.98%</span>
                                </div>
                            </div>
                            <div class="nvc-metric-content">
                                <h3 class="nvc-metric-value nvc-wcag-high-contrast">{{ performance_data.uptime or '99.98' }}%</h3>
                                <p class="nvc-metric-label nvc-wcag-medium-contrast">System Uptime</p>
                                <p class="nvc-metric-subtitle">30-day average</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Performance Charts Dashboard -->
        <div class="nvc-dashboard-section nvc-dashboard-section-secondary">
            <div class="nvc-section-header">
                <h2 class="nvc-section-title nvc-wcag-high-contrast">
                    <i class="fas fa-chart-area" aria-hidden="true"></i>
                    Performance Analytics
                </h2>
                <div class="nvc-section-actions">
                    <select class="nvc-chart-select nvc-wcag-focus" aria-label="Select time range">
                        <option value="24h" selected>Last 24 Hours</option>
                        <option value="7d">Last 7 Days</option>
                        <option value="30d">Last 30 Days</option>
                    </select>
                </div>
            </div>

            <div class="nvc-section-content">
                <div class="nvc-performance-charts">
                    <div class="nvc-chart-container">
                        <div class="nvc-chart-header">
                            <h3 class="nvc-chart-title nvc-wcag-high-contrast">Response Time Trends</h3>
                        </div>
                        <div class="nvc-chart-content">
                            <canvas id="responseTimeChart" aria-label="Response time trends chart"></canvas>
                        </div>
                    </div>

                    <div class="nvc-chart-container">
                        <div class="nvc-chart-header">
                            <h3 class="nvc-chart-title nvc-wcag-high-contrast">Throughput Analysis</h3>
                        </div>
                        <div class="nvc-chart-content">
                            <canvas id="throughputChart" aria-label="Throughput analysis chart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Professional Performance Monitoring Dashboard Interactions

    // Initialize performance charts
    initializePerformanceCharts();

    function initializePerformanceCharts() {
        // Response Time Chart
        const responseTimeCtx = document.getElementById('responseTimeChart');
        if (responseTimeCtx) {
            new Chart(responseTimeCtx, {
                type: 'line',
                data: {
                    labels: Array.from({length: 24}, (_, i) => `${i}:00`),
                    datasets: [{
                        label: 'Response Time (ms)',
                        data: Array.from({length: 24}, () => Math.floor(Math.random() * 20) + 5),
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return value + 'ms';
                                }
                            }
                        }
                    }
                }
            });
        }

        // Throughput Chart
        const throughputCtx = document.getElementById('throughputChart');
        if (throughputCtx) {
            new Chart(throughputCtx, {
                type: 'bar',
                data: {
                    labels: Array.from({length: 24}, (_, i) => `${i}:00`),
                    datasets: [{
                        label: 'Requests/sec',
                        data: Array.from({length: 24}, () => Math.floor(Math.random() * 1000) + 500),
                        backgroundColor: 'rgba(16, 185, 129, 0.8)',
                        borderColor: '#10b981',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'top',
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return value + '/sec';
                                }
                            }
                        }
                    }
                }
            });
        }
    }

    // Metric card hover effects
    const metricCards = document.querySelectorAll('.nvc-metric-card');
    metricCards.forEach(card => {
        card.addEventListener('mouseenter', function() {
            this.style.transform = 'translateY(-2px)';
            this.style.boxShadow = '0 8px 25px rgba(0, 0, 0, 0.15)';
        });

        card.addEventListener('mouseleave', function() {
            this.style.transform = 'translateY(0)';
            this.style.boxShadow = '';
        });
    });

    // Chart time range selector
    const chartSelect = document.querySelector('.nvc-chart-select');
    if (chartSelect) {
        chartSelect.addEventListener('change', function() {
            console.log('Chart time range changed to:', this.value);
            // Add logic to update chart data based on selected time range
        });
    }

    // Real-time performance updates
    function updatePerformanceData() {
        // Update metric values with simulated data
        const metricValues = document.querySelectorAll('.nvc-metric-value');
        metricValues.forEach(value => {
            if (value.textContent.includes('ms')) {
                // Simulate response time fluctuations
                const currentValue = parseInt(value.textContent);
                const variation = Math.floor(Math.random() * 6) - 3; // -3 to +3
                const newValue = Math.max(1, currentValue + variation);
                value.textContent = newValue + 'ms';
            }
        });

        console.log('Performance data updated');
    }

    // Update performance data every 30 seconds
    setInterval(updatePerformanceData, 30000);

    // Page action buttons
    const refreshButton = document.querySelector('[aria-label="Refresh performance data"]');
    const exportButton = document.querySelector('[aria-label="Export performance report"]');

    if (refreshButton) {
        refreshButton.addEventListener('click', function() {
            console.log('Refreshing performance data...');

            // Show loading state
            const originalText = this.innerHTML;
            this.innerHTML = '<i class="fas fa-spinner fa-spin" aria-hidden="true"></i> Refreshing...';
            this.disabled = true;

            // Simulate refresh operation
            setTimeout(() => {
                this.innerHTML = originalText;
                this.disabled = false;
                updatePerformanceData();
                console.log('Performance data refreshed');
            }, 2000);
        });
    }

    if (exportButton) {
        exportButton.addEventListener('click', function() {
            console.log('Exporting performance report...');

            // Show loading state
            const originalText = this.innerHTML;
            this.innerHTML = '<i class="fas fa-spinner fa-spin" aria-hidden="true"></i> Exporting...';
            this.disabled = true;

            // Simulate export operation
            setTimeout(() => {
                this.innerHTML = originalText;
                this.disabled = false;
                console.log('Performance report exported');
            }, 1500);
        });
    }

    // Accessibility enhancements
    const focusableElements = document.querySelectorAll('button, a, input, select, textarea, [tabindex]:not([tabindex="-1"])');
    focusableElements.forEach(element => {
        element.addEventListener('focus', function() {
            this.style.outline = '2px solid #2563eb';
            this.style.outlineOffset = '2px';
        });

        element.addEventListener('blur', function() {
            this.style.outline = '';
            this.style.outlineOffset = '';
        });
    });
});
</script>
{% endblock %}
