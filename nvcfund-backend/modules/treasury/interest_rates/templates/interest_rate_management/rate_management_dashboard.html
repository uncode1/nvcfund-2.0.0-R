{% extends "unified_base.html" %}
{% from "components/nvc_components.html" import metric_card, action_card, account_card, transaction_row, form_input, form_select, notification_banner, progress_bar, stats_grid, loading_spinner, empty_state %}


{% block title %}Interest Rate Management - NVC Banking Platform{% endblock %}

{% block content %}
<div class="nvc-page-content">
    <div class="container-fluid py-4">
    <!-- Rate Management Header -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="nvc-card bg-gradient-info">
                <div class="nvc-nvc-card-body">
                    <div class="row align-items-center">
                        <div class="col">
                            <h1 class="h2 text-white mb-2">
                                <i class="fas fa-percentage me-2"></i>Interest Rate Management
                            </h1>
                            <p class="text-light mb-0">Comprehensive interest rate setting and risk management</p>
                        </div>
                        <div class="col-auto">
                            <div class="btn-group">
                                <button type="button" class="btn btn-light btn-sm">Live Rates</button>
                                <button type="button" class="btn nvc-btn nvc-btn-outline-light btn-sm">Rate History</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Current Rates Overview -->
    <div class="row mb-4">
        <div class="col-lg-3 col-md-6 mb-3">
            <div class="nvc-card bg-primary">
                <div class="nvc-nvc-card-body text-center">
                    <i class="fas fa-university fa-3x text-white-50 mb-3"></i>
                    <h4 class="text-white">Fed Funds Rate</h4>
                    <h2 class="text-white">{{ "5.25%"|default("0%") }}</h2>
                    <small class="text-light">Current Target</small>
                </div>
            </div>
        </div>
        <div class="col-lg-3 col-md-6 mb-3">
            <div class="nvc-card bg-success">
                <div class="nvc-nvc-card-body text-center">
                    <i class="fas fa-piggy-bank fa-3x text-white-50 mb-3"></i>
                    <h4 class="text-white">Deposit Rate</h4>
                    <h2 class="text-white">{{ "4.75%"|default("0%") }}</h2>
                    <small class="text-light">Savings APY</small>
                </div>
            </div>
        </div>
        <div class="col-lg-3 col-md-6 mb-3">
            <div class="nvc-card bg-warning">
                <div class="nvc-nvc-card-body text-center">
                    <i class="fas fa-hand-holding-usd fa-3x text-white-50 mb-3"></i>
                    <h4 class="text-white">Prime Rate</h4>
                    <h2 class="text-white">{{ "8.50%"|default("0%") }}</h2>
                    <small class="text-light">Lending Base</small>
                </div>
            </div>
        </div>
        <div class="col-lg-3 col-md-6 mb-3">
            <div class="nvc-card bg-danger">
                <div class="nvc-nvc-card-body text-center">
                    <i class="fas fa-chart-line fa-3x text-white-50 mb-3"></i>
                    <h4 class="text-white">Net Spread</h4>
                    <h2 class="text-white">{{ "3.75%"|default("0%") }}</h2>
                    <small class="text-light">Interest Margin</small>
                </div>
            </div>
        </div>
    </div>

    <!-- Rate Setting Interface -->
    <div class="row">
        <div class="col-lg-8 mb-4">
            <div class="nvc-card">
                <div class="nvc-nvc-card-header">
                    <h5><i class="fas fa-sliders-h me-2"></i>Rate Setting Control Panel</h5>
                </div>
                <div class="nvc-nvc-card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="nvc-card border-primary">
                                <div class="nvc-nvc-card-header bg-primary text-white">
                                    <h6><i class="fas fa-arrow-down me-2"></i>Deposit Rates</h6>
                                </div>
                                <div class="nvc-nvc-card-body">
                                    <form id="depositRatesForm">
                                        <div class="mb-3">
                                            <label class="nvc-form-label">Savings Account APY</label>
                                            <div class="input-group">
                                                <input type="number" class="nvc-form-input" value="4.75" step="0.01" min="0" max="10">
                                                <span class="input-group-text">%</span>
                                            </div>
                                        </div>
                                        <div class="mb-3">
                                            <label class="nvc-form-label">Money Market APY</label>
                                            <div class="input-group">
                                                <input type="number" class="nvc-form-input" value="4.85" step="0.01" min="0" max="10">
                                                <span class="input-group-text">%</span>
                                            </div>
                                        </div>
                                        <div class="mb-3">
                                            <label class="nvc-form-label">CD 12-Month APY</label>
                                            <div class="input-group">
                                                <input type="number" class="nvc-form-input" value="5.15" step="0.01" min="0" max="10">
                                                <span class="input-group-text">%</span>
                                            </div>
                                        </div>
                                        <button type="submit" class="btn nvc-btn nvc-btn-primary w-100">Update Deposit Rates</button>
                                    </form>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-6">
                            <div class="nvc-card border-warning">
                                <div class="nvc-nvc-card-header bg-warning text-white">
                                    <h6><i class="fas fa-arrow-up me-2"></i>Lending Rates</h6>
                                </div>
                                <div class="nvc-nvc-card-body">
                                    <form id="lendingRatesForm">
                                        <div class="mb-3">
                                            <label class="nvc-form-label">Personal Loan APR</label>
                                            <div class="input-group">
                                                <input type="number" class="nvc-form-input" value="9.25" step="0.01" min="0" max="30">
                                                <span class="input-group-text">%</span>
                                            </div>
                                        </div>
                                        <div class="mb-3">
                                            <label class="nvc-form-label">Mortgage 30-Year APR</label>
                                            <div class="input-group">
                                                <input type="number" class="nvc-form-input" value="7.15" step="0.01" min="0" max="20">
                                                <span class="input-group-text">%</span>
                                            </div>
                                        </div>
                                        <div class="mb-3">
                                            <label class="nvc-form-label">Business Loan APR</label>
                                            <div class="input-group">
                                                <input type="number" class="nvc-form-input" value="8.75" step="0.01" min="0" max="25">
                                                <span class="input-group-text">%</span>
                                            </div>
                                        </div>
                                        <button type="submit" class="btn nvc-btn nvc-btn-warning w-100">Update Lending Rates</button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Market Conditions -->
        <div class="col-lg-4 mb-4">
            <div class="nvc-card">
                <div class="nvc-nvc-card-header">
                    <h5><i class="fas fa-chart-area me-2"></i>Market Conditions</h5>
                </div>
                <div class="nvc-nvc-card-body">
                    <div class="mb-3">
                        <label class="nvc-form-label">10-Year Treasury</label>
                        <div class="d-flex justify-content-between">
                            <span class="h6">{{ "4.45%"|default("0%") }}</span>
                            <span class="badge bg-warning">↗ +0.05%</span>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="nvc-form-label">2-Year Treasury</label>
                        <div class="d-flex justify-content-between">
                            <span class="h6">{{ "4.12%"|default("0%") }}</span>
                            <span class="badge bg-danger">↘ -0.02%</span>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="nvc-form-label">LIBOR (3-Month)</label>
                        <div class="d-flex justify-content-between">
                            <span class="h6">{{ "5.38%"|default("0%") }}</span>
                            <span class="badge bg-success">↗ +0.08%</span>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="nvc-form-label">SOFR (Overnight)</label>
                        <div class="d-flex justify-content-between">
                            <span class="h6">{{ "5.31%"|default("0%") }}</span>
                            <span class="badge bg-info">→ 0.00%</span>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label class="nvc-form-label">Inflation Rate (CPI)</label>
                        <div class="d-flex justify-content-between">
                            <span class="h6">{{ "3.2%"|default("0%") }}</span>
                            <span class="badge bg-warning">↗ +0.1%</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Interest Rate Analytics -->
    <div class="row">
        <div class="col-lg-8 mb-4">
            <div class="nvc-card">
                <div class="nvc-nvc-card-header d-flex justify-content-between">
                    <h5><i class="fas fa-chart-line me-2"></i>Interest Rate Trends</h5>
                    <div class="btn-group btn-group-sm">
                        <button type="button" class="btn nvc-btn nvc-btn-outline-primary active">1M</button>
                        <button type="button" class="btn nvc-btn nvc-btn-outline-primary">3M</button>
                        <button type="button" class="btn nvc-btn nvc-btn-outline-primary">6M</button>
                        <button type="button" class="btn nvc-btn nvc-btn-outline-primary">1Y</button>
                    </div>
                </div>
                <div class="nvc-nvc-card-body">
                    <canvas id="rateChart" height="300"></canvas>
                </div>
            </div>
        </div>

        <div class="col-lg-4 mb-4">
            <div class="nvc-card">
                <div class="nvc-nvc-card-header">
                    <h5><i class="fas fa-balance-scale me-2"></i>Rate Impact Analysis</h5>
                </div>
                <div class="nvc-nvc-card-body">
                    <div class="mb-3">
                        <label class="nvc-form-label">Net Interest Income</label>
                        <div class="progress">
                            <div class="progress-bar bg-success" class="progress-bar-85">
                                ${{ "45.7M"|default("0") }}
                            </div>
                        </div>
                        <small class="text-success">+12.5% vs last quarter</small>
                    </div>
                    <div class="mb-3">
                        <label class="nvc-form-label">Deposit Growth Rate</label>
                        <div class="progress">
                            <div class="progress-bar bg-info" class="progress-bar-75">
                                {{ "18.2%"|default("0%") }}
                            </div>
                        </div>
                        <small class="text-info">Above industry average</small>
                    </div>
                    <div class="mb-3">
                        <label class="nvc-form-label">Loan Demand Index</label>
                        <div class="progress">
                            <div class="progress-bar bg-warning" class="progress-bar-65">
                                {{ "6.5"|default("0") }}/10
                            </div>
                        </div>
                        <small class="text-warning">Moderate demand</small>
                    </div>
                    <div class="mb-3">
                        <label class="nvc-form-label">Rate Sensitivity Score</label>
                        <div class="progress">
                            <div class="progress-bar bg-danger" class="progress-bar-45">
                                {{ "4.5"|default("0") }}/10
                            </div>
                        </div>
                        <small class="text-success">Low sensitivity</small>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Rate Schedule & Competitive Analysis -->
    <div class="row">
        <div class="col-lg-6 mb-4">
            <div class="nvc-card">
                <div class="nvc-nvc-card-header">
                    <h5><i class="fas fa-calendar-alt me-2"></i>Rate Change Schedule</h5>
                </div>
                <div class="nvc-nvc-card-body">
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>Date</th>
                                    <th>Product</th>
                                    <th>Previous</th>
                                    <th>New Rate</th>
                                    <th>Change</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>{{ "Jul 15, 2025"|default("TBD") }}</td>
                                    <td>Savings APY</td>
                                    <td>4.50%</td>
                                    <td>4.75%</td>
                                    <td><span class="badge bg-success">+0.25%</span></td>
                                </tr>
                                <tr>
                                    <td>{{ "Jul 10, 2025"|default("TBD") }}</td>
                                    <td>30-Year Mortgage</td>
                                    <td>6.95%</td>
                                    <td>7.15%</td>
                                    <td><span class="badge bg-warning">+0.20%</span></td>
                                </tr>
                                <tr>
                                    <td>{{ "Jul 5, 2025"|default("TBD") }}</td>
                                    <td>Personal Loan</td>
                                    <td>9.50%</td>
                                    <td>9.25%</td>
                                    <td><span class="badge bg-success">-0.25%</span></td>
                                </tr>
                                <tr>
                                    <td>{{ "Jul 1, 2025"|default("TBD") }}</td>
                                    <td>CD 12-Month</td>
                                    <td>4.95%</td>
                                    <td>5.15%</td>
                                    <td><span class="badge bg-success">+0.20%</span></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-lg-6 mb-4">
            <div class="nvc-card">
                <div class="nvc-nvc-card-header">
                    <h5><i class="fas fa-users-cog me-2"></i>Competitive Analysis</h5>
                </div>
                <div class="nvc-nvc-card-body">
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>Bank</th>
                                    <th>Savings APY</th>
                                    <th>CD 12-Month</th>
                                    <th>Mortgage</th>
                                    <th>Rank</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="table-success">
                                    <td><strong>NVC Banking</strong></td>
                                    <td>4.75%</td>
                                    <td>5.15%</td>
                                    <td>7.15%</td>
                                    <td><span class="badge bg-success">#2</span></td>
                                </tr>
                                <tr>
                                    <td>Marcus by Goldman Sachs</td>
                                    <td>4.80%</td>
                                    <td>5.25%</td>
                                    <td>7.05%</td>
                                    <td><span class="badge bg-warning">#1</span></td>
                                </tr>
                                <tr>
                                    <td>Capital One</td>
                                    <td>4.25%</td>
                                    <td>4.85%</td>
                                    <td>7.25%</td>
                                    <td><span class="badge bg-info">#4</span></td>
                                </tr>
                                <tr>
                                    <td>Ally Bank</td>
                                    <td>4.35%</td>
                                    <td>4.95%</td>
                                    <td>7.20%</td>
                                    <td><span class="badge bg-info">#3</span></td>
                                </tr>
                                <tr>
                                    <td>Chase Bank</td>
                                    <td>0.50%</td>
                                    <td>2.75%</td>
                                    <td>7.35%</td>
                                    <td><span class="badge bg-secondary">#8</span></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Risk Management Tools -->
    <div class="row">
        <div class="col-12">
            <div class="nvc-card">
                <div class="nvc-nvc-card-header">
                    <h5><i class="fas fa-shield-alt me-2"></i>Interest Rate Risk Management</h5>
                </div>
                <div class="nvc-nvc-card-body">
                    <div class="row">
                        <div class="col-md-3">
                            <div class="text-center">
                                <h6>Duration Gap</h6>
                                <h4 class="text-warning">{{ "2.3"|default("0") }} years</h4>
                                <small class="text-light">Asset-Liability</small>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="text-center">
                                <h6>Interest Rate Sensitivity</h6>
                                <h4 class="text-info">{{ "4.2%"|default("0%") }}</h4>
                                <small class="text-light">100bp shock impact</small>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="text-center">
                                <h6>Hedge Ratio</h6>
                                <h4 class="text-success">{{ "85%"|default("0%") }}</h4>
                                <small class="text-light">Rate risk hedged</small>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="text-center">
                                <h6>VAR (1-Day)</h6>
                                <h4 class="text-danger">${{ "1.2M"|default("0") }}</h4>
                                <small class="text-light">95% confidence</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Interest Rate Chart
    const rateCtx = document.getElementById('rateChart').getContext('2d');
    new Chart(rateCtx, {
        type: 'line',
        data: {
            labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul'],
            datasets: [{
                label: 'Fed Funds Rate',
                data: [5.00, 5.00, 5.25, 5.25, 5.25, 5.25, 5.25],
                borderColor: '#0d6efd',
                backgroundColor: 'rgba(13, 110, 253, 0.1)',
                tension: 0.4
            }, {
                label: 'Our Savings Rate',
                data: [4.25, 4.25, 4.50, 4.50, 4.50, 4.75, 4.75],
                borderColor: '#198754',
                backgroundColor: 'rgba(25, 135, 84, 0.1)',
                tension: 0.4
            }, {
                label: 'Our Lending Rate',
                data: [8.75, 8.75, 9.00, 9.00, 9.25, 9.25, 9.25],
                borderColor: '#ffc107',
                backgroundColor: 'rgba(255, 193, 7, 0.1)',
                tension: 0.4
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: {
                    beginAtZero: false,
                    min: 4,
                    max: 10,
                    ticks: {
                        callback: function(value) {
                            return value + '%';
                        }
                    }
                }
            }
        }
    });

    // Form handlers
    document.getElementById('depositRatesForm').addEventListener('submit', function(e) {
        e.preventDefault();
        alert('Deposit rates updated successfully. Changes will take effect at 9:00 AM ET tomorrow.');
    });

    document.getElementById('lendingRatesForm').addEventListener('submit', function(e) {
        e.preventDefault();
        alert('Lending rates updated successfully. Changes will take effect immediately for new applications.');
    });
});
</script>
</div>
{% endblock %}