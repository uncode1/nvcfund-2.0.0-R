{% extends "unified_base.html" %}
{% from "components/nvc_components.html" import metric_card, action_card, account_card, transaction_row, form_input, form_select, notification_banner, progress_bar, stats_grid, loading_spinner, empty_state %}


{% block title %}Fraud Detection & AML - NVC Banking & Crypto Platform{% endblock %}

{% block page_title %}Fraud Detection & AML{% endblock %}
{% block page_description %}Advanced fraud detection and anti-money laundering monitoring for banking and cryptocurrency operations{% endblock %}

{% block page_actions %}
<button type="button" class="nvc-btn nvc-btn-outline-enterprise" data-action="custom-action">
    <i class="fas fa-download"></i>
    Export Report
</button>
<button type="button" class="nvc-btn nvc-btn-secondary-enterprise" data-action="custom-action">
    <i class="fas fa-file-alt"></i>
    AML Reports
</button>
<button type="button" class="nvc-btn nvc-btn-primary-enterprise" data-action="custom-action">
    <i class="fas fa-exclamation-triangle"></i>
    Create Alert
</button>
{% endblock %}

{% block extra_css %}
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/3.9.1/chart.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
<style>
    .fraud-aml-dashboard {
        background: linear-gradient(135deg, #0a2447 0%, #1a365d 100%);
        min-height: 100vh;
        color: #ffffff;
        padding: 20px;
    }
    
    .fraud-header {
        background: rgba(255,255,255,0.1);
        border-radius: 15px;
        padding: 25px;
        margin-bottom: 30px;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255,255,255,0.2);
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .fraud-metrics-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }
    
    .metric-card {
        background: rgba(255,255,255,0.1);
        border-radius: 12px;
        padding: 20px;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255,255,255,0.2);
        transition: all 0.3s ease;
        cursor: pointer;
    }
    
    .metric-card:hover {
        background: rgba(255,255,255,0.15);
        transform: translateY(-3px);
    }
    
    .card-suspicious { border-left: 4px solid #ff4444; }
    .card-blocked { border-left: 4px solid #ff0000; }
    .card-patterns { border-left: 4px solid #ffaa00; }
    .card-users { border-left: 4px solid #66ccff; }
    .card-transactions { border-left: 4px solid #9966ff; }
    .card-alerts { border-left: 4px solid #00ff88; }
    
    .metric-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 15px;
    }
    
    .metric-title {
        font-weight: bold;
        font-size: 1rem;
    }
    
    .metric-icon {
        font-size: 1.5rem;
        opacity: 0.8;
    }
    
    .metric-value {
        font-size: 2.2rem;
        font-weight: bold;
        color: #66ccff;
        margin-bottom: 10px;
    }
    
    .value-critical { color: #ff4444; }
    .value-warning { color: #ffaa00; }
    .value-success { color: #00ff88; }
    
    .metric-change {
        font-size: 0.8rem;
        opacity: 0.8;
    }
    
    .change-positive { color: #00ff88; }
    .change-negative { color: #ff4444; }
    
    .pattern-analysis {
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: 30px;
        margin-bottom: 30px;
    }
    
    .analysis-container {
        background: rgba(255,255,255,0.1);
        border-radius: 15px;
        padding: 25px;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255,255,255,0.2);
    }
    
    .user-behavior-profiles {
        background: rgba(255,255,255,0.1);
        border-radius: 15px;
        padding: 25px;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255,255,255,0.2);
        margin-bottom: 30px;
    }
    
    .profile-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 20px;
        margin-top: 20px;
    }
    
    .profile-card {
        background: rgba(255,255,255,0.05);
        border-radius: 10px;
        padding: 15px;
        border-left: 4px solid;
        cursor: pointer;
        transition: all 0.3s ease;
    }
    
    .profile-card:hover {
        background: rgba(255,255,255,0.1);
    }
    
    .profile-normal { border-left-color: #00ff88; }
    .profile-suspicious { border-left-color: #ffaa00; }
    .profile-fraudulent { border-left-color: #ff4444; }
    .profile-high-risk { border-left-color: #ff0000; }
    
    .profile-header {
        display: flex;
        justify-content: between;
        align-items: center;
        margin-bottom: 10px;
    }
    
    .profile-id {
        font-weight: bold;
        color: #66ccff;
    }
    
    .risk-score {
        padding: 3px 8px;
        border-radius: 6px;
        font-size: 0.8rem;
        font-weight: bold;
        margin-left: auto;
    }
    
    .risk-low { background: #00ff88; color: #000; }
    .risk-medium { background: #ffaa00; color: #000; }
    .risk-high { background: #ff4444; color: #fff; }
    .risk-critical { background: #ff0000; color: #fff; }
    
    .profile-details {
        font-size: 0.9rem;
        margin-bottom: 10px;
    }
    
    .profile-patterns {
        font-size: 0.8rem;
        opacity: 0.8;
    }
    
    .suspicious-activities {
        background: rgba(255,255,255,0.1);
        border-radius: 15px;
        padding: 25px;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255,255,255,0.2);
        margin-bottom: 30px;
    }
    
    .activity-timeline {
        margin-top: 20px;
        max-height: 500px;
        overflow-y: auto;
    }
    
    .activity-item {
        background: rgba(255,255,255,0.05);
        border-radius: 10px;
        padding: 15px;
        margin-bottom: 15px;
        border-left: 4px solid;
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .activity-critical { border-left-color: #ff0000; }
    .activity-high { border-left-color: #ff4444; }
    .activity-medium { border-left-color: #ffaa00; }
    .activity-low { border-left-color: #66ccff; }
    
    .activity-content {
        flex: 1;
    }
    
    .activity-title {
        font-weight: bold;
        margin-bottom: 5px;
    }
    
    .activity-details {
        font-size: 0.9rem;
        opacity: 0.8;
        margin-bottom: 5px;
    }
    
    .activity-meta {
        font-size: 0.8rem;
        opacity: 0.7;
    }
    
    .activity-actions {
        display: flex;
        gap: 5px;
    }
    
    .aml-compliance {
        background: rgba(255,255,255,0.1);
        border-radius: 15px;
        padding: 25px;
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255,255,255,0.2);
        margin-bottom: 30px;
    }
    
    .compliance-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-top: 20px;
    }
    
    .compliance-item {
        background: rgba(255,255,255,0.05);
        border-radius: 10px;
        padding: 15px;
        text-align: center;
    }
    
    .compliance-status {
        width: 12px;
        height: 12px;
        border-radius: 50%;
        margin: 0 auto 10px;
    }
    
    .status-compliant { background: #00ff88; }
    .status-warning { background: #ffaa00; }
    .status-violation { background: #ff4444; }
    
    .compliance-title {
        font-weight: bold;
        margin-bottom: 5px;
    }
    
    .compliance-value {
        font-size: 1.2rem;
        font-weight: bold;
        color: #66ccff;
        margin-bottom: 5px;
    }
    
    .compliance-description {
        font-size: 0.8rem;
        opacity: 0.8;
    }
    
    .action-btn {
        background: #66ccff;
        color: #0a2447;
        border: none;
        padding: 6px 12px;
        border-radius: 6px;
        cursor: pointer;
        font-size: 0.8rem;
        font-weight: bold;
        transition: all 0.3s ease;
        display: flex;
        align-items: center;
        gap: 3px;
    }
    
    .action-btn:hover {
        background: #4db8ff;
        transform: scale(1.05);
    }
    
    .action-btn.danger {
        background: #ff4444;
        color: #fff;
    }
    
    .action-btn.success {
        background: #4caf50;
        color: #fff;
    }
    
    .action-btn.warning {
        background: #ffaa00;
        color: #000;
    }
    
    .filters-section {
        background: rgba(255,255,255,0.05);
        border-radius: 10px;
        padding: 15px;
        margin-bottom: 20px;
        display: flex;
        gap: 15px;
        align-items: center;
        flex-wrap: wrap;
    }
    
    .filter-input,
    .filter-select {
        background: rgba(255,255,255,0.1);
        border: 1px solid rgba(255,255,255,0.3);
        border-radius: 8px;
        padding: 8px;
        color: #fff;
        min-width: 150px;
    }
    
    .realtime-indicator {
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 0.9rem;
    }
    
    .realtime-dot {
        width: 8px;
        height: 8px;
        background: #00ff88;
        border-radius: 50%;
        animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
        0% { opacity: 1; }
        50% { opacity: 0.5; }
        100% { opacity: 1; }
    }
</style>
{% endblock %}

{% block content %}
<div class="nvc-page-content">
    <!-- Fraud Detection Overview -->
<div class="row mb-4">
    <div class="col-12">
        <div class="enterprise-nvc-card">
            <div class="nvc-nvc-card-header-enterprise">
                <div class="header-content">
                    <div class="header-icon">
                        <i class="fas fa-user-secret"></i>
                    </div>
                    <div class="header-text">
                        <h3>Fraud Detection & AML Center</h3>
                        <p>Advanced behavioral analytics and pattern recognition for financial crime prevention</p>
                    </div>
                </div>
                <div class="header-status">
                    <div class="realtime-indicator">
                        <span class="realtime-dot"></span>
                        <span>Live ML Analysis</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Fraud Detection Metrics -->
<div class="row mb-4">
    <div class="col-xl-3 col-md-6 mb-4">
        <div class="nvc-card metric-nvc-card" data-action="custom-action">
            <div class="metric-content">
                <div class="metric-icon danger">
                    <i class="fas fa-exclamation-triangle"></i>
                </div>
                <div class="metric-details">
                    <h3>{{ fraud_data.suspicious_activities or 23 }}</h3>
                    <p>Suspicious Activities</p>
                    <span class="metric-trend negative">
                        <i class="fas fa-arrow-up"></i> +15% from yesterday
                    </span>
                </div>
            </div>
        </div>
    </div>

    <div class="col-xl-3 col-md-6 mb-4">
        <div class="nvc-card metric-nvc-card" data-action="custom-action">
            <div class="metric-content">
                <div class="metric-icon danger">
                    <i class="fas fa-ban"></i>
                </div>
                <div class="metric-details">
                    <h3>{{ fraud_data.blocked_transactions or 147 }}</h3>
                    <p>Blocked Transactions</p>
                    <span class="metric-trend negative">
                        <i class="fas fa-arrow-up"></i> +8% from yesterday
                    </span>
                </div>
            </div>
        </div>
    </div>

    <div class="col-xl-3 col-md-6 mb-4">
        <div class="nvc-card metric-nvc-card" data-action="custom-action">
            <div class="metric-content">
                <div class="metric-icon warning">
                    <i class="fas fa-search"></i>
                </div>
                <div class="metric-details">
                    <h3>{{ fraud_data.unusual_patterns or 67 }}</h3>
                    <p>Unusual Patterns</p>
                    <span class="metric-trend positive">
                        <i class="fas fa-arrow-down"></i> -3% from yesterday
                    </span>
                </div>
            </div>
        </div>
    </div>

    <div class="col-xl-3 col-md-6 mb-4">
        <div class="nvc-card metric-nvc-card" data-action="custom-action">
            <div class="metric-content">
                <div class="metric-icon success">
                    <i class="fas fa-bell"></i>
                </div>
                <div class="metric-details">
                    <h3>{{ fraud_data.aml_alerts or 45 }}</h3>
                    <p>AML Alerts</p>
                    <span class="metric-trend positive">
                        <i class="fas fa-arrow-down"></i> -5% from yesterday
                    </span>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Level 2: Investigative Category Breakdown -->
<div class="row mb-4">
    <div class="col-xl-2 col-md-4 mb-3">
        <div class="nvc-card metric-card investigation-category-nvc-card" data-investigation-type="dpi" >
            <div class="metric-content">
                <div class="metric-icon danger">
                    <i class="fas fa-search-plus"></i>
                </div>
                <div class="metric-details">
                    <h4>{{ investigation_data.dpi_alerts if investigation_data else '24' }}</h4>
                    <p>DPI Alerts</p>
                    <small class="text-muted"><i class="fas fa-microscope"></i> Deep packet analysis</small>
                </div>
            </div>
        </div>
    </div>
    <div class="col-xl-2 col-md-4 mb-3">
        <div class="nvc-card metric-card investigation-category-nvc-card" data-investigation-type="ip" >
            <div class="metric-content">
                <div class="metric-icon warning">
                    <i class="fas fa-globe"></i>
                </div>
                <div class="metric-details">
                    <h4>{{ investigation_data.suspicious_ips if investigation_data else '18' }}</h4>
                    <p>Suspicious IPs</p>
                    <small class="text-muted"><i class="fas fa-map-marker-alt"></i> Geolocation analysis</small>
                </div>
            </div>
        </div>
    </div>
    <div class="col-xl-2 col-md-4 mb-3">
        <div class="nvc-card metric-card investigation-category-nvc-card" data-investigation-type="user" >
            <div class="metric-content">
                <div class="metric-icon info">
                    <i class="fas fa-user-shield"></i>
                </div>
                <div class="metric-details">
                    <h4>{{ investigation_data.flagged_users if investigation_data else '7' }}</h4>
                    <p>Flagged Users</p>
                    <small class="text-muted"><i class="fas fa-chart-line"></i> Behavior analysis</small>
                </div>
            </div>
        </div>
    </div>
    <div class="col-xl-2 col-md-4 mb-3">
        <div class="nvc-card metric-card investigation-category-nvc-card" data-investigation-type="transaction" >
            <div class="metric-content">
                <div class="metric-icon primary">
                    <i class="fas fa-exchange-alt"></i>
                </div>
                <div class="metric-details">
                    <h4>{{ investigation_data.suspicious_transactions if investigation_data else '31' }}</h4>
                    <p>Suspicious Transactions</p>
                    <small class="text-muted"><i class="fas fa-money-bill-wave"></i> Pattern analysis</small>
                </div>
            </div>
        </div>
    </div>
    <div class="col-xl-2 col-md-4 mb-3">
        <div class="nvc-card metric-card investigation-category-nvc-card" data-investigation-type="device" >
            <div class="metric-content">
                <div class="metric-icon success">
                    <i class="fas fa-mobile-alt"></i>
                </div>
                <div class="metric-details">
                    <h4>{{ investigation_data.suspicious_devices if investigation_data else '12' }}</h4>
                    <p>Suspicious Devices</p>
                    <small class="text-muted"><i class="fas fa-fingerprint"></i> Device fingerprinting</small>
                </div>
            </div>
        </div>
    </div>
    <div class="col-xl-2 col-md-4 mb-3">
        <div class="nvc-card metric-card investigation-category-nvc-card" data-investigation-type="event" >
            <div class="metric-content">
                <div class="metric-icon secondary">
                    <i class="fas fa-exclamation-triangle"></i>
                </div>
                <div class="metric-details">
                    <h4>{{ investigation_data.security_events if investigation_data else '89' }}</h4>
                    <p>Security Events</p>
                    <small class="text-muted"><i class="fas fa-clock"></i> Timeline analysis</small>
                </div>
            </div>
        </div>
    </div>
</div>

    <!-- Pattern Analysis -->
    <div class="pattern-analysis">
        <div class="analysis-container">
            <h3><i class="fas fa-chart-line"></i> Fraud Pattern Analysis</h3>
            <canvas id="fraudPatternsChart" width="400" height="300"></canvas>
        </div>
        
        <div class="analysis-container">
            <h3><i class="fas fa-chart-pie"></i> Risk Distribution</h3>
            <canvas id="riskDistributionChart" width="400" height="300"></canvas>
        </div>
    </div>

<!-- Level 3: Investigative Data Table -->
<div class="row mb-4">
    <div class="col-12">
        <div class="enterprise-nvc-card">
            <div class="nvc-nvc-card-header-enterprise">
                <h4><i class="fas fa-table"></i> Investigation Datapoints</h4>
                <div class="header-actions">
                    <select id="investigation-filter" class="form-select nvc-form-select-sm">
                        <option value="">All Categories</option>
                        <option value="dpi">DPI Analysis</option>
                        <option value="ip">IP Intelligence</option>
                        <option value="user">User Behavior</option>
                        <option value="transaction">Transaction Patterns</option>
                        <option value="device">Device Analysis</option>
                        <option value="event">Security Events</option>
                    </select>
                </div>
            </div>
            <div class="nvc-nvc-card-body">
                <div class="table-responsive">
                    <table class="table enterprise-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Type</th>
                                <th>Source</th>
                                <th>Risk Score</th>
                                <th>Status</th>
                                <th>Timestamp</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="investigation-table-body">
                            <tr class="investigation-row" data-investigation-id="DPI-001" data-type="dpi" data-risk="high" >
                                <td><strong>DPI-001</strong></td>
                                <td><span class="badge bg-danger">DPI Alert</span></td>
                                <td>185.220.101.42:443</td>
                                <td><span class="badge bg-danger">95</span></td>
                                <td><span class="badge bg-warning">Investigating</span></td>
                                <td>2 min ago</td>
                                <td>
                                    <button type="button" class="btn btn-sm nvc-btn nvc-btn-outline-primary" data-action="custom-action">Investigate</button>
                                    <button type="button" class="btn btn-sm nvc-btn nvc-btn-outline-danger" data-action="custom-action">Block</button>
                                </td>
                            </tr>
                            <tr class="investigation-row" data-investigation-id="IP-002" data-type="ip" data-risk="medium" >
                                <td><strong>IP-002</strong></td>
                                <td><span class="badge bg-warning">Suspicious IP</span></td>
                                <td>192.168.1.100</td>
                                <td><span class="badge bg-warning">67</span></td>
                                <td><span class="badge bg-info">Monitoring</span></td>
                                <td>5 min ago</td>
                                <td>
                                    <button type="button" class="btn btn-sm nvc-btn nvc-btn-outline-primary" data-action="custom-action">Investigate</button>
                                    <button type="button" class="btn btn-sm nvc-btn nvc-btn-outline-warning" data-action="custom-action">Geolocate</button>
                                </td>
                            </tr>
                            <tr class="investigation-row" data-investigation-id="USR-003" data-type="user" data-risk="critical" >
                                <td><strong>USR-003</strong></td>
                                <td><span class="badge bg-danger">User Anomaly</span></td>
                                <td>user@example.com</td>
                                <td><span class="badge bg-danger">89</span></td>
                                <td><span class="badge bg-danger">Flagged</span></td>
                                <td>1 min ago</td>
                                <td>
                                    <button type="button" class="btn btn-sm nvc-btn nvc-btn-outline-primary" data-action="custom-action">Investigate</button>
                                    <button type="button" class="btn btn-sm nvc-btn nvc-btn-outline-info" data-action="custom-action">Behavior</button>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

    <!-- User Behavior Profiles -->
    <div class="user-behavior-profiles">
        <h3><i class="fas fa-user-chart"></i> User Behavior Profiles & Pattern Recognition</h3>
        
        <div class="filters-section">
            <input type="text" class="filter-input" id="user-search" placeholder="Search by user ID, name, or account...">
            <select class="filter-select" id="risk-filter">
                <option value="">All Risk Levels</option>
                <option value="critical">Critical Risk</option>
                <option value="high">High Risk</option>
                <option value="medium">Medium Risk</option>
                <option value="low">Low Risk</option>
            </select>
            <select class="filter-select" id="behavior-filter">
                <option value="">All Behaviors</option>
                <option value="normal">Normal Pattern</option>
                <option value="suspicious">Suspicious Activity</option>
                <option value="fraudulent">Fraudulent Behavior</option>
                <option value="anomalous">Anomalous Pattern</option>
            </select>
            <button type="button" class="action-btn" data-action="custom-action">
                <i class="fas fa-brain"></i> Run ML Analysis
            </button>
            <button type="button" class="action-btn warning" data-action="custom-action">
                <i class="fas fa-file-alt"></i> Generate Report
            </button>
        </div>
        
        <div class="profile-grid" id="user-profiles-container">
            {% set user_profiles = [
                {
                    'user_id': 'USR-78423',
                    'name': 'Marcus Thompson',
                    'risk_level': 'critical',
                    'risk_score': 94,
                    'account_type': 'Business',
                    'anomalies': 'Unusual transaction times, geographic inconsistencies',
                    'patterns': 'Large cash deposits followed by immediate international transfers',
                    'last_activity': '2 hours ago'
                },
                {
                    'user_id': 'USR-65721',
                    'name': 'Elena Rodriguez',
                    'risk_level': 'high',
                    'risk_score': 78,
                    'account_type': 'Personal',
                    'anomalies': 'Rapid account velocity increase, multiple failed authentication',
                    'patterns': 'Login from multiple countries within 24 hours',
                    'last_activity': '45 min ago'
                },
                {
                    'user_id': 'USR-94512',
                    'name': 'David Chen',
                    'risk_level': 'medium',
                    'risk_score': 56,
                    'account_type': 'Investment',
                    'anomalies': 'Transaction amount variance, new payee additions',
                    'patterns': 'Sudden increase in high-value transactions',
                    'last_activity': '1 hour ago'
                },
                {
                    'user_id': 'USR-32184',
                    'name': 'Sarah Williams',
                    'risk_level': 'low',
                    'risk_score': 23,
                    'account_type': 'Personal',
                    'anomalies': 'None detected',
                    'patterns': 'Consistent transaction patterns, stable behavior',
                    'last_activity': '15 min ago'
                }
            ] %}
            
            {% for profile in user_profiles %}
            <div class="profile-nvc-card profile-{{ 'fraudulent' if profile.risk_score > 80 else 'suspicious' if profile.risk_score > 60 else 'normal' }}" data-action="custom-action">
                <div class="profile-header">
                    <div class="profile-id">{{ profile.user_id }}</div>
                    <div class="risk-score risk-{{ 'critical' if profile.risk_score > 80 else 'high' if profile.risk_score > 60 else 'medium' if profile.risk_score > 40 else 'low' }}">{{ profile.risk_score }%}</div>
                </div>
                <div class="profile-details">
                    <strong>{{ profile.name }}</strong> • {{ profile.account_type }} Account<br>
                    <strong>Anomalies:</strong> {{ profile.anomalies }}<br>
                    <strong>Last Activity:</strong> {{ profile.last_activity }}
                </div>
                <div class="profile-patterns">{{ profile.patterns }}</div>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- Suspicious Activities Timeline -->
    <div class="suspicious-activities">
        <h3><i class="fas fa-exclamation-circle"></i> Real-time Suspicious Activities</h3>
        
        <div class="filters-section">
            <select class="filter-select" id="activity-type-filter">
                <option value="">All Activity Types</option>
                <option value="transaction">Transaction Anomaly</option>
                <option value="login">Login Pattern</option>
                <option value="velocity">Velocity Check</option>
                <option value="geographic">Geographic Anomaly</option>
                <option value="behavioral">Behavioral Change</option>
                <option value="aml">AML Flag</option>
            </select>
            <select class="filter-select" id="activity-severity-filter">
                <option value="">All Severities</option>
                <option value="critical">Critical</option>
                <option value="high">High</option>
                <option value="medium">Medium</option>
                <option value="low">Low</option>
            </select>
            <select class="filter-select" id="timeframe-filter">
                <option value="1h">Last Hour</option>
                <option value="24h" selected>Last 24 Hours</option>
                <option value="7d">Last 7 Days</option>
            </select>
            <button type="button" class="action-btn" data-action="custom-action">
                <i class="fas fa-sync"></i> Refresh
            </button>
        </div>
        
        <div class="activity-timeline" id="suspicious-activities-container">
            {% set suspicious_activities = [
                {
                    'title': 'Structuring Pattern Detected',
                    'severity': 'critical',
                    'user': 'USR-78423 (Marcus Thompson)',
                    'description': 'Multiple transactions just below $10,000 reporting threshold',
                    'amount': '$9,950 x 8 transactions',
                    'location': 'New York, NY',
                    'time': '15 min ago',
                    'confidence': '96%'
                },
                {
                    'title': 'Velocity Check Failed',
                    'severity': 'high',
                    'user': 'USR-65721 (Elena Rodriguez)', 
                    'description': 'Unusual transaction frequency - 47 transactions in 2 hours',
                    'amount': 'Total: $284,750',
                    'location': 'Multiple locations',
                    'time': '32 min ago',
                    'confidence': '89%'
                },
                {
                    'title': 'Geographic Anomaly',
                    'severity': 'medium',
                    'user': 'USR-94512 (David Chen)',
                    'description': 'Login from unusual location followed by large transfer',
                    'amount': '$45,000 to offshore account',
                    'location': 'Lagos, Nigeria',
                    'time': '1 hour ago',
                    'confidence': '74%'
                },
                {
                    'title': 'Behavioral Pattern Change',
                    'severity': 'high',
                    'user': 'USR-51289 (Jennifer Adams)',
                    'description': 'Sudden change in transaction patterns after 2 years of stability',
                    'amount': '$125,000 in cryptocurrency purchases',
                    'location': 'Chicago, IL',
                    'time': '2 hours ago',
                    'confidence': '82%'
                },
                {
                    'title': 'PEP Match Alert',
                    'severity': 'critical',
                    'user': 'USR-73641 (Alexander Petrov)',
                    'description': 'Customer matches Politically Exposed Person watchlist',
                    'amount': '$2,150,000 deposit',
                    'location': 'Miami, FL',
                    'time': '3 hours ago',
                    'confidence': '99%'
                }
            ] %}
            
            {% for activity in suspicious_activities %}
            <div class="activity-item activity-{{ activity.severity }}">
                <div class="activity-content">
                    <div class="activity-title">{{ activity.title }}</div>
                    <div class="activity-details">
                        <strong>User:</strong> {{ activity.user }}<br>
                        {{ activity.description }}
                    </div>
                    <div class="activity-meta">
                        <strong>Amount:</strong> {{ activity.amount }} • 
                        <strong>Location:</strong> {{ activity.location }} • 
                        <strong>Confidence:</strong> {{ activity.confidence }} • {{ activity.time }}
                    </div>
                </div>
                <div class="activity-actions">
                    <button type="button" class="action-btn" data-action="custom-action" title="Investigate">
                        <i class="fas fa-search"></i>
                    </button>
                    <button type="button" class="action-btn warning" data-action="custom-action" title="Flag">
                        <i class="fas fa-flag"></i>
                    </button>
                    <button type="button" class="action-btn danger" data-action="custom-action" title="Block">
                        <i class="fas fa-ban"></i>
                    </button>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- AML Compliance Dashboard -->
    <div class="aml-compliance">
        <h3><i class="fas fa-gavel"></i> AML Compliance Dashboard</h3>
        
        <div class="compliance-grid">
            <div class="compliance-item" data-action="custom-action">
                <div class="compliance-status status-compliant"></div>
                <div class="compliance-title">SAR Reports</div>
                <div class="compliance-value">{{ fraud_data.sar_reports or 12 }}</div>
                <div class="compliance-description">Filed this month</div>
            </div>
            
            <div class="compliance-item" data-action="custom-action">
                <div class="compliance-status status-compliant"></div>
                <div class="compliance-title">CTR Reports</div>
                <div class="compliance-value">{{ fraud_data.ctr_reports or 847 }}</div>
                <div class="compliance-description">Filed this month</div>
            </div>
            
            <div class="compliance-item" data-action="custom-action">
                <div class="compliance-status status-warning"></div>
                <div class="compliance-title">KYC Compliance</div>
                <div class="compliance-value">{{ fraud_data.kyc_compliance or '94.2%' }}</div>
                <div class="compliance-description">Customer verification rate</div>
            </div>
            
            <div class="compliance-item" data-action="custom-action">
                <div class="compliance-status status-compliant"></div>
                <div class="compliance-title">Watchlist Screening</div>
                <div class="compliance-value">{{ fraud_data.watchlist_hits or 23 }}</div>
                <div class="compliance-description">Matches found today</div>
            </div>
            
            <div class="compliance-item" data-action="custom-action">
                <div class="compliance-status status-compliant"></div>
                <div class="compliance-title">Risk Assessments</div>
                <div class="compliance-value">{{ fraud_data.risk_assessments or 156 }}</div>
                <div class="compliance-description">Completed this week</div>
            </div>
            
            <div class="compliance-item" data-action="custom-action">
                <div class="compliance-status status-compliant"></div>
                <div class="compliance-title">Audit Trail</div>
                <div class="compliance-value">100%</div>
                <div class="compliance-description">Coverage maintained</div>
            </div>
        </div>
    </div>
</div>

<script>
// Socket.IO connection for real-time fraud detection data
const socket = io('/security-center');

// Chart instances
let fraudPatternsChart, riskDistributionChart;

// Initialize page
document.addEventListener('DOMContentLoaded', function() {
    initializeCharts();
    setupEventListeners();
    
    // Connect to socket for real-time updates
    if (socket.connected) {
        socket.emit('request_fraud_data');
    }
});

// Socket event handlers
socket.on('connect', function() {
    console.log('Connected to security center socket for fraud detection');
    socket.emit('request_fraud_data');
});

socket.on('fraud_activity_detected', function(activity) {
    addSuspiciousActivity(activity);
    updateFraudMetrics();
});

socket.on('user_risk_updated', function(data) {
    updateUserRiskProfile(data.user_id, data.risk_score, data.risk_level);
});

socket.on('fraud_patterns_update', function(data) {
    updateFraudPatternsChart(data);
});

socket.on('aml_alert', function(alert) {
    handleAMLAlert(alert);
});

// Initialize charts
function initializeCharts() {
    const chartOptions = {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
            legend: {
                labels: { color: '#ffffff' }
            }
        },
        scales: {
            x: {
                ticks: { color: '#ffffff' },
                grid: { color: 'rgba(255,255,255,0.1)' }
            },
            y: {
                ticks: { color: '#ffffff' },
                grid: { color: 'rgba(255,255,255,0.1)' }
            }
        }
    };

    // Fraud Patterns Chart
    const patternsCtx = document.getElementById('fraudPatternsChart').getContext('2d');
    fraudPatternsChart = new Chart(patternsCtx, {
        type: 'line',
        data: {
            labels: [],
            datasets: [
                {
                    label: 'Suspicious Activities',
                    data: [],
                    borderColor: '#ff4444',
                    backgroundColor: 'rgba(255, 68, 68, 0.1)',
                    tension: 0.4,
                    fill: true
                },
                {
                    label: 'Blocked Transactions',
                    data: [],
                    borderColor: '#ff0000',
                    backgroundColor: 'rgba(255, 0, 0, 0.1)',
                    tension: 0.4,
                    fill: true
                },
                {
                    label: 'ML Detections',
                    data: [],
                    borderColor: '#9966ff',
                    backgroundColor: 'rgba(153, 102, 255, 0.1)',
                    tension: 0.4,
                    fill: true
                }
            ]
        },
        options: chartOptions
    });

    // Risk Distribution Chart
    const riskCtx = document.getElementById('riskDistributionChart').getContext('2d');
    riskDistributionChart = new Chart(riskCtx, {
        type: 'doughnut',
        data: {
            labels: ['Low Risk', 'Medium Risk', 'High Risk', 'Critical Risk'],
            datasets: [{
                data: [65, 20, 12, 3],
                backgroundColor: [
                    '#00ff88',
                    '#ffaa00',
                    '#ff4444',
                    '#ff0000'
                ],
                borderWidth: 2,
                borderColor: '#0a2447'
            }]
        },
        options: {
            ...chartOptions,
            scales: {} // Remove scales for doughnut chart
        }
    });
}

// Setup event listeners
function setupEventListeners() {
    // Filter change events
    document.getElementById('user-search').addEventListener('input', filterUserProfiles);
    document.getElementById('risk-filter').addEventListener('change', filterUserProfiles);
    document.getElementById('behavior-filter').addEventListener('change', filterUserProfiles);
    document.getElementById('activity-type-filter').addEventListener('change', filterSuspiciousActivities);
    document.getElementById('activity-severity-filter').addEventListener('change', filterSuspiciousActivities);
    document.getElementById('timeframe-filter').addEventListener('change', function() {
        const timeframe = this.value;
        socket.emit('request_fraud_data', { timeframe: timeframe });
    });
}

// Update functions
function updateFraudMetrics() {
    // Update metrics from current activity data
    const activities = document.querySelectorAll('#suspicious-activities-container .activity-item');
    const counts = { critical: 0, high: 0, medium: 0, low: 0 };
    
    activities.forEach(activity => {
        const classes = activity.className;
        if (classes.includes('activity-critical')) counts.critical++;
        else if (classes.includes('activity-high')) counts.high++;
        else if (classes.includes('activity-medium')) counts.medium++;
        else if (classes.includes('activity-low')) counts.low++;
    });
    
    const total = counts.critical + counts.high + counts.medium + counts.low;
    document.getElementById('suspicious-count').textContent = total;
}

function updateFraudPatternsChart(data) {
    if (fraudPatternsChart && data.labels) {
        fraudPatternsChart.data.labels = data.labels;
        fraudPatternsChart.data.datasets[0].data = data.suspicious || [];
        fraudPatternsChart.data.datasets[1].data = data.blocked || [];
        fraudPatternsChart.data.datasets[2].data = data.ml_detections || [];
        fraudPatternsChart.update('none');
    }
}

function addSuspiciousActivity(activity) {
    const container = document.getElementById('suspicious-activities-container');
    const item = document.createElement('div');
    item.className = `activity-item activity-${activity.severity}`;
    item.innerHTML = `
        <div class="activity-content">
            <div class="activity-title">${activity.title}</div>
            <div class="activity-details">
                <strong>User:</strong> ${activity.user}<br>
                ${activity.description}
            </div>
            <div class="activity-meta">
                <strong>Amount:</strong> ${activity.amount} • 
                <strong>Location:</strong> ${activity.location} • 
                <strong>Confidence:</strong> ${activity.confidence} • ${activity.time}
            </div>
        </div>
        <div class="activity-actions">
            <button type="button" class="action-btn" data-action="custom-action" title="Investigate">
                <i class="fas fa-search"></i>
            </button>
            <button type="button" class="action-btn warning" data-action="custom-action" title="Flag">
                <i class="fas fa-flag"></i>
            </button>
            <button type="button" class="action-btn danger" data-action="custom-action" title="Block">
                <i class="fas fa-ban"></i>
            </button>
        </div>
    `;
    
    container.insertBefore(item, container.firstChild);
    
    // Keep only latest 20 activities
    while (container.children.length > 20) {
        container.removeChild(container.lastChild);
    }
}

function updateUserRiskProfile(userId, riskScore, riskLevel) {
    const profiles = document.querySelectorAll('#user-profiles-container .profile-card');
    profiles.forEach(profile => {
        const profileId = profile.querySelector('.profile-id').textContent;
        if (profileId === userId) {
            const riskScoreElement = profile.querySelector('.risk-score');
            riskScoreElement.textContent = riskScore + '%';
            riskScoreElement.className = `risk-score risk-${riskLevel}`;
            
            // Update profile card border
            profile.className = `profile-card profile-${riskLevel === 'critical' ? 'fraudulent' : riskLevel === 'high' ? 'suspicious' : 'normal'}`;
        }
    });
}

function handleAMLAlert(alert) {
    // Handle incoming AML alerts
    addSuspiciousActivity({
        title: 'AML Alert: ' + alert.type,
        severity: alert.severity,
        user: alert.user,
        description: alert.description,
        amount: alert.amount,
        location: alert.location,
        time: 'Just now',
        confidence: alert.confidence
    });
    
    // Update AML alerts counter
    const alertsElement = document.getElementById('aml-alerts');
    const currentCount = parseInt(alertsElement.textContent);
    alertsElement.textContent = currentCount + 1;
}

// Navigation functions
function viewSuspiciousActivities() {
    window.location.href = '/security/fraud/suspicious-activities';
}

function viewBlockedTransactions() {
    window.location.href = '/security/fraud/blocked-transactions';
}

function viewUnusualPatterns() {
    window.location.href = '/security/fraud/unusual-patterns';
}

function viewHighRiskUsers() {
    window.location.href = '/security/fraud/high-risk-users';
}

function viewTransactionAnalysis() {
    window.location.href = '/security/fraud/transaction-analysis';
}

function viewAMLAlerts() {
    window.location.href = '/security/aml/alerts';
}

function viewUserProfile(userId) {
    window.location.href = `/security/fraud/user-profile/${userId}`;
}

// AML Compliance navigation
function viewSARReports() {
    window.location.href = '/security/aml/sar-reports';
}

function viewCTRReports() {
    window.location.href = '/security/aml/ctr-reports';
}

function viewKYCStatus() {
    window.location.href = '/security/aml/kyc-status';
}

function viewWatchlistScreening() {
    window.location.href = '/security/aml/watchlist-screening';
}

function viewRiskAssessments() {
    window.location.href = '/security/aml/risk-assessments';
}

function viewAuditTrail() {
    window.location.href = '/security/aml/audit-trail';
}

// Action functions
function investigateActivity(activityTitle) {
    window.location.href = `/security/fraud/investigate?activity=${encodeURIComponent(activityTitle)}`;
}

function flagForReview(userId) {
    if (confirm(`Flag ${userId} for manual review? This will add the user to the review queue.`)) {
        fetch('/security/api/fraud/flag-user', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ user_id: userId })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert('User flagged for review successfully');
            } else {
                alert('Error flagging user: ' + data.error);
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Error flagging user');
        });
    }
}

function blockUser(userId) {
    if (confirm(`Block ${userId}? This will immediately suspend all account access.`)) {
        fetch('/security/api/fraud/block-user', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ user_id: userId })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert('User blocked successfully');
            } else {
                alert('Error blocking user: ' + data.error);
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Error blocking user');
        });
    }
}

function runBehaviorAnalysis() {
    if (confirm('Run comprehensive ML behavior analysis? This may take several minutes.')) {
        fetch('/security/api/fraud/behavior-analysis', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert(`Behavior analysis started. Analyzing ${data.user_count} user profiles.`);
            } else {
                alert('Error starting analysis: ' + data.error);
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Error starting behavior analysis');
        });
    }
}

function generateReport() {
    const reportType = prompt('Report type:\n1. Fraud Summary\n2. AML Compliance\n3. Risk Assessment\n4. User Behavior\n\nEnter number:');
    if (reportType && reportType >= 1 && reportType <= 4) {
        const reportTypes = ['fraud-summary', 'aml-compliance', 'risk-assessment', 'user-behavior'];
        window.location.href = `/security/fraud/reports/${reportTypes[reportType - 1]}`;
    }
}

// Filter functions
function filterUserProfiles() {
    const search = document.getElementById('user-search').value.toLowerCase();
    const riskFilter = document.getElementById('risk-filter').value;
    const behaviorFilter = document.getElementById('behavior-filter').value;
    
    const profiles = document.querySelectorAll('#user-profiles-container .profile-card');
    profiles.forEach(profile => {
        const text = profile.textContent.toLowerCase();
        const riskScore = parseInt(profile.querySelector('.risk-score').textContent);
        const riskLevel = riskScore > 80 ? 'critical' : riskScore > 60 ? 'high' : riskScore > 40 ? 'medium' : 'low';
        
        const matchesSearch = !search || text.includes(search);
        const matchesRisk = !riskFilter || riskLevel === riskFilter;
        const matchesBehavior = !behaviorFilter || text.includes(behaviorFilter);
        
        profile.style.display = matchesSearch && matchesRisk && matchesBehavior ? '' : 'none';
    });
}

function filterSuspiciousActivities() {
    const typeFilter = document.getElementById('activity-type-filter').value;
    const severityFilter = document.getElementById('activity-severity-filter').value;
    
    const activities = document.querySelectorAll('#suspicious-activities-container .activity-item');
    activities.forEach(activity => {
        const text = activity.textContent.toLowerCase();
        const classes = activity.className;
        
        const matchesType = !typeFilter || text.includes(typeFilter);
        const matchesSeverity = !severityFilter || classes.includes(`activity-${severityFilter}`);
        
        activity.style.display = matchesType && matchesSeverity ? '' : 'none';
    });
}

function refreshActivities() {
    const timeframe = document.getElementById('timeframe-filter').value;
    socket.emit('request_fraud_data', { timeframe: timeframe });
}

// Enhanced template functions
function exportFraudData() {
    const csvData = 'Type,Count,Severity,Timestamp,Status\n';
    const blob = new Blob([csvData], { type: 'text/csv' });
    const url = window.URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'fraud_detection_report.csv';
    a.click();
}

function viewAMLReports() {
    window.location.href = "{{ url_for('security_center.aml_reports') }}";
}

function createAlert() {
    window.location.href = "{{ url_for('security_center.create_fraud_alert') }}";
}

// Initialize fraud detection dashboard with drilldown functionality
document.addEventListener('DOMContentLoaded', function() {
    // Add click handlers for metric cards with drilldown navigation
    const metricCards = document.querySelectorAll('.metric-card');
    metricCards.forEach(card => {
        card.style.cursor = 'pointer';
        card.addEventListener('mouseenter', function() {
            this.style.transform = 'translateY(-5px)';
            this.style.boxShadow = '0 8px 25px rgba(0,0,0,0.15)';
        });
        card.addEventListener('mouseleave', function() {
            this.style.transform = 'translateY(0)';
            this.style.boxShadow = '';
        });

        // Add click handlers for drilldown navigation
        card.addEventListener('click', function() {
            const cardTitle = this.querySelector('h3, h4, h5, h6, .metric-title')?.textContent;
            handleFraudAMLDrilldown(cardTitle);
        });
    });

    // Level 2: Investigation Category Cards
    const investigationCategoryCards = document.querySelectorAll('.investigation-category-card');
    investigationCategoryCards.forEach(card => {
        card.addEventListener('click', function() {
            const investigationType = this.getAttribute('data-investigation-type');
            handleInvestigationCategoryDrilldown(investigationType);
        });

        // Add hover effects
        card.addEventListener('mouseenter', function() {
            this.style.transform = 'translateY(-5px)';
            this.style.boxShadow = '0 8px 25px rgba(0,0,0,0.15)';
        });
        card.addEventListener('mouseleave', function() {
            this.style.transform = 'translateY(0)';
            this.style.boxShadow = '';
        });
    });

    // Level 3: Investigation Table Rows
    const investigationRows = document.querySelectorAll('.investigation-row');
    investigationRows.forEach(row => {
        row.addEventListener('click', function() {
            const investigationId = this.getAttribute('data-investigation-id');
            investigateDatapoint(investigationId);
        });

        // Add hover effects
        row.addEventListener('mouseenter', function() {
            this.style.backgroundColor = 'rgba(0,123,255,0.1)';
        });
        row.addEventListener('mouseleave', function() {
            this.style.backgroundColor = '';
        });
    });

    // Investigation filter
    const investigationFilter = document.getElementById('investigation-filter');
    if (investigationFilter) {
        investigationFilter.addEventListener('change', function() {
            filterInvestigationsByType(this.value);
        });
    }
});

// Level 2: Investigation Category Drilldown
function handleInvestigationCategoryDrilldown(investigationType) {
    // Filter the investigation table by type
    filterInvestigationsByType(investigationType);

    // Update the filter dropdown
    const investigationFilter = document.getElementById('investigation-filter');
    if (investigationFilter) {
        investigationFilter.value = investigationType;
    }

    // Scroll to investigation table
    document.querySelector('#investigation-table-body').scrollIntoView({ behavior: 'smooth' });
}

// Level 3: Filter investigations by type
function filterInvestigationsByType(investigationType) {
    const rows = document.querySelectorAll('.investigation-row');
    let visibleCount = 0;

    rows.forEach(row => {
        const rowType = row.getAttribute('data-type');
        if (!investigationType || rowType === investigationType) {
            row.style.display = '';
            visibleCount++;
        } else {
            row.style.display = 'none';
        }
    });

    updateInvestigationCounts(investigationType, visibleCount);
}

// Update investigation counts
function updateInvestigationCounts(activeFilter, visibleCount) {
    const totalRows = document.querySelectorAll('.investigation-row').length;
    const header = document.querySelector('.card-header-enterprise h4');
    if (header) {
        if (!activeFilter) {
            header.innerHTML = `<i class="fas fa-table"></i> Investigation Datapoints (${totalRows} items)`;
        } else {
            header.innerHTML = `<i class="fas fa-table"></i> Investigation Datapoints (${visibleCount} ${activeFilter} items)`;
        }
    }
}

// Level 4: Individual Datapoint Investigation (Level 4 → Level 5 drilldown)
function investigateDatapoint(investigationId) {
    // Navigate to detailed investigation page with comprehensive analysis
    window.location.href = `/security_center/investigation_details/${encodeURIComponent(investigationId)}?view=comprehensive&analysis=deep`;
}

// Specialized investigation functions for different datapoint types
function geolocateIP(ipAddress) {
    // Navigate to IP geolocation analysis
    window.location.href = `/security_center/ip_analysis/${encodeURIComponent(ipAddress)}?view=geolocation&threat_intel=true`;
}

function viewUserBehavior(userId) {
    // Navigate to user behavior analysis
    window.location.href = `/security_center/user_analysis/${encodeURIComponent(userId)}?view=behavior&timeline=true`;
}

function viewTransactionChain(transactionId) {
    // Navigate to transaction chain analysis
    window.location.href = `/security_center/transaction_analysis/${encodeURIComponent(transactionId)}?view=chain&flow=true`;
}

function blockDatapoint(investigationId) {
    if (confirm(`Are you sure you want to block investigation datapoint ${investigationId}?`)) {
        // Secure blocking action
        const form = document.createElement('form');
        form.method = 'POST';
        form.action = '/security_center/block_investigation_datapoint';

        const csrfToken = document.createElement('input');
        csrfToken.type = 'hidden';
        csrfToken.name = 'csrf_token';
        csrfToken.value = document.querySelector('meta[name="csrf-token"]')?.getAttribute('content') || '';
        form.appendChild(csrfToken);

        const investigationIdInput = document.createElement('input');
        investigationIdInput.type = 'hidden';
        investigationIdInput.name = 'investigation_id';
        investigationIdInput.value = investigationId;
        form.appendChild(investigationIdInput);

        const action = document.createElement('input');
        action.type = 'hidden';
        action.name = 'action';
        action.value = 'block';
        form.appendChild(action);

        document.body.appendChild(form);
        form.submit();
        document.body.removeChild(form);
    }
}

function handleFraudAMLDrilldown(cardTitle) {
    if (!cardTitle) return;

    if (cardTitle.includes('Suspicious Transactions') || cardTitle.includes('Flagged')) {
        window.location.href = "{{ url_for('security_center.suspicious_transactions') }}?view=flagged";
    } else if (cardTitle.includes('Risk Score') || cardTitle.includes('Score')) {
        window.location.href = "{{ url_for('security_center.risk_assessment') }}?view=detailed";
    } else if (cardTitle.includes('AML Alerts') || cardTitle.includes('Alerts')) {
        window.location.href = "{{ url_for('security_center.aml_alerts') }}?filter=active";
    } else if (cardTitle.includes('Compliance') || cardTitle.includes('Regulatory')) {
        window.location.href = "{{ url_for('security_center.compliance_reports') }}?view=aml";
    } else if (cardTitle.includes('Investigations') || cardTitle.includes('Cases')) {
        window.location.href = "{{ url_for('security_center.fraud_investigations') }}?status=active";
    } else if (cardTitle.includes('KYC') || cardTitle.includes('Customer')) {
        window.location.href = "{{ url_for('security_center.kyc_monitoring') }}?view=status";
    } else if (cardTitle.includes('Patterns') || cardTitle.includes('Analysis')) {
        window.location.href = "{{ url_for('security_center.pattern_analysis') }}?view=unusual";
    }
}
</script>
</div>
{% endblock %}
{% endblock %}