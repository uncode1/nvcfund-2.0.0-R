{% extends "public/public_base.html" %}
{% from "components/nvc_components.html" import metric_card, action_card, account_card, transaction_row, form_input, form_select, notification_banner, progress_bar, stats_grid, loading_spinner, empty_state %}

{% block title %}Create Account - NVC Banking Platform{% endblock %}

{% block content %}
<!-- Modern NVC Registration Hero Section -->
<section class="nvc-auth-hero">
    <div class="nvc-auth-container">
        <div class="nvc-auth-layout">
            <div class="nvc-auth-content">
                <div class="nvc-auth-grid">
                    <!-- Welcome Section -->
                    <div class="nvc-auth-welcome">
                        <div class="nvc-welcome-content">
                            <div class="nvc-welcome-header">
                                <div class="nvc-brand-icon">
                                    <i class="fas fa-user-plus" aria-hidden="true"></i>
                                </div>
                                <h1 class="nvc-welcome-title nvc-wcag-high-contrast">Join NVC Banking</h1>
                                <p class="nvc-welcome-subtitle nvc-wcag-medium-contrast">
                                    Create your professional banking account with enterprise-grade security, FINRA compliance, and advanced portfolio management tools.
                                </p>
                            </div>

                            <!-- Trust Features Grid -->
                            <div class="nvc-trust-features">
                                <div class="nvc-features-grid">
                                    <div class="nvc-feature-item">
                                        <div class="nvc-feature-icon nvc-feature-security">
                                            <i class="fas fa-shield-alt" aria-hidden="true"></i>
                                        </div>
                                        <div class="nvc-feature-content">
                                            <h3 class="nvc-feature-title nvc-wcag-high-contrast">Bank-Grade Security</h3>
                                            <p class="nvc-feature-description nvc-wcag-medium-contrast">256-bit SSL encryption</p>
                                        </div>
                                    </div>

                                    <div class="nvc-feature-item">
                                        <div class="nvc-feature-icon nvc-feature-analytics">
                                            <i class="fas fa-chart-line" aria-hidden="true"></i>
                                        </div>
                                        <div class="nvc-feature-content">
                                            <h3 class="nvc-feature-title nvc-wcag-high-contrast">Advanced Analytics</h3>
                                            <p class="nvc-feature-description nvc-wcag-medium-contrast">Professional portfolio tools</p>
                                        </div>
                                    </div>

                                    <div class="nvc-feature-item">
                                        <div class="nvc-feature-icon nvc-feature-support">
                                            <i class="fas fa-headset" aria-hidden="true"></i>
                                        </div>
                                        <div class="nvc-feature-content">
                                            <h3 class="nvc-feature-title nvc-wcag-high-contrast">24/7 Support</h3>
                                            <p class="nvc-feature-description nvc-wcag-medium-contrast">Expert assistance</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Modern Registration Form -->
                    <div class="nvc-auth-form">
                        <div class="nvc-login-card">
                            <!-- Form Header -->
                            <div class="nvc-form-header">
                                <div class="nvc-form-icon">
                                    <i class="fas fa-user-plus" aria-hidden="true"></i>
                                </div>
                                <h2 class="nvc-form-title nvc-wcag-high-contrast">Create Account</h2>
                                <p class="nvc-form-subtitle nvc-wcag-medium-contrast">Join NVC Banking for professional financial services</p>
                            </div>

                            <!-- Flash Messages -->
                            {% with messages = get_flashed_messages(with_categories=true) %}
                                {% if messages %}
                                    <div class="nvc-flash-messages">
                                        {% for category, message in messages %}
                                            <div class="nvc-alert nvc-alert-{{ 'danger' if category == 'error' else 'info' if category == 'info' else 'success' }}" role="alert">
                                                <i class="fas fa-{{ 'exclamation-triangle' if category == 'error' else 'info-circle' if category == 'info' else 'check-circle' }}" aria-hidden="true"></i>
                                                <span>{{ message }}</span>
                                                <button type="button" class="nvc-alert-close nvc-wcag-focus" aria-label="Dismiss alert">
                                                    <i class="fas fa-times" aria-hidden="true"></i>
                                                </button>
                                            </div>
                                        {% endfor %}
                                    </div>
                                {% endif %}
                            {% endwith %}

                            <!-- Registration Form -->
                            <form method="POST" action="{{ url_for('auth.register') if url_for else '#' }}" class="nvc-auth-form-container" novalidate>
                                <input type="hidden" name="csrf_token" value="{{ csrf_token() if csrf_token else '' }}"/>

                                <!-- Account Type Selection -->
                                <div class="nvc-account-type-section">
                                    <h3 class="nvc-section-title nvc-wcag-high-contrast">
                                        <i class="fas fa-building" aria-hidden="true"></i>
                                        Select Account Type
                                    </h3>
                                    <p class="nvc-section-subtitle nvc-wcag-medium-contrast">Choose the account type that best fits your needs</p>

                                    <div class="nvc-account-type-grid">
                                        <!-- Individual Account -->
                                        <div class="nvc-account-type-card">
                                            <input type="radio"
                                                   class="nvc-account-type-radio nvc-wcag-focus"
                                                   id="individual_account"
                                                   name="account_type"
                                                   value="individual"
                                                   required>
                                            <label for="individual_account" class="nvc-account-type-label">
                                                <div class="nvc-account-type-header">
                                                    <div class="nvc-account-type-icon">
                                                        <i class="fas fa-user" aria-hidden="true"></i>
                                                    </div>
                                                    <h4 class="nvc-account-type-title nvc-wcag-high-contrast">Individual Account</h4>
                                                </div>
                                                <div class="nvc-account-type-content">
                                                    <p class="nvc-account-type-description nvc-wcag-medium-contrast">
                                                        Personal banking and investment services for individual clients
                                                    </p>
                                                    <ul class="nvc-account-type-features">
                                                        <li class="nvc-wcag-medium-contrast">
                                                            <i class="fas fa-check" aria-hidden="true"></i>
                                                            Personal portfolio management
                                                        </li>
                                                        <li class="nvc-wcag-medium-contrast">
                                                            <i class="fas fa-check" aria-hidden="true"></i>
                                                            Individual investment accounts
                                                        </li>
                                                        <li class="nvc-wcag-medium-contrast">
                                                            <i class="fas fa-check" aria-hidden="true"></i>
                                                            Personal financial planning
                                                        </li>
                                                        <li class="nvc-wcag-medium-contrast">
                                                            <i class="fas fa-check" aria-hidden="true"></i>
                                                            Standard transaction limits
                                                        </li>
                                                    </ul>
                                                </div>
                                            </label>
                                        </div>

                                        <!-- Business Client -->
                                        <div class="nvc-account-type-card">
                                            <input type="radio"
                                                   class="nvc-account-type-radio nvc-wcag-focus"
                                                   id="business_client"
                                                   name="account_type"
                                                   value="business"
                                                   required>
                                            <label for="business_client" class="nvc-account-type-label">
                                                <div class="nvc-account-type-header">
                                                    <div class="nvc-account-type-icon">
                                                        <i class="fas fa-building" aria-hidden="true"></i>
                                                    </div>
                                                    <h4 class="nvc-account-type-title nvc-wcag-high-contrast">Business Client</h4>
                                                </div>
                                                <div class="nvc-account-type-content">
                                                    <p class="nvc-account-type-description nvc-wcag-medium-contrast">
                                                        Corporate banking services for businesses and organizations
                                                    </p>
                                                    <ul class="nvc-account-type-features">
                                                        <li class="nvc-wcag-medium-contrast">
                                                            <i class="fas fa-check" aria-hidden="true"></i>
                                                            Corporate treasury management
                                                        </li>
                                                        <li class="nvc-wcag-medium-contrast">
                                                            <i class="fas fa-check" aria-hidden="true"></i>
                                                            Business investment solutions
                                                        </li>
                                                        <li class="nvc-wcag-medium-contrast">
                                                            <i class="fas fa-check" aria-hidden="true"></i>
                                                            Multi-user account access
                                                        </li>
                                                        <li class="nvc-wcag-medium-contrast">
                                                            <i class="fas fa-check" aria-hidden="true"></i>
                                                            Enhanced transaction limits
                                                        </li>
                                                    </ul>
                                                </div>
                                            </label>
                                        </div>

                                        <!-- Partner Program -->
                                        <div class="nvc-account-type-card">
                                            <input type="radio"
                                                   class="nvc-account-type-radio nvc-wcag-focus"
                                                   id="partner_program"
                                                   name="account_type"
                                                   value="partner"
                                                   required>
                                            <label for="partner_program" class="nvc-account-type-label">
                                                <div class="nvc-account-type-header">
                                                    <div class="nvc-account-type-icon">
                                                        <i class="fas fa-handshake" aria-hidden="true"></i>
                                                    </div>
                                                    <h4 class="nvc-account-type-title nvc-wcag-high-contrast">Partner Program</h4>
                                                </div>
                                                <div class="nvc-account-type-content">
                                                    <p class="nvc-account-type-description nvc-wcag-medium-contrast">
                                                        Strategic partnership opportunities with institutional benefits
                                                    </p>
                                                    <ul class="nvc-account-type-features">
                                                        <li class="nvc-wcag-medium-contrast">
                                                            <i class="fas fa-check" aria-hidden="true"></i>
                                                            Institutional-grade services
                                                        </li>
                                                        <li class="nvc-wcag-medium-contrast">
                                                            <i class="fas fa-check" aria-hidden="true"></i>
                                                            Revenue sharing opportunities
                                                        </li>
                                                        <li class="nvc-wcag-medium-contrast">
                                                            <i class="fas fa-check" aria-hidden="true"></i>
                                                            Dedicated relationship manager
                                                        </li>
                                                        <li class="nvc-wcag-medium-contrast">
                                                            <i class="fas fa-check" aria-hidden="true"></i>
                                                            Premium transaction limits
                                                        </li>
                                                    </ul>
                                                </div>
                                            </label>
                                        </div>
                                    </div>
                                </div>

                                <!-- Dynamic Form Fields Based on Account Type -->
                                <div id="dynamic-form-fields">
                                    <!-- Individual Account Fields -->
                                    <div id="individual-fields" class="nvc-account-fields" style="display: none;">
                                        <h4 class="nvc-form-section-title nvc-wcag-high-contrast">
                                            <i class="fas fa-user" aria-hidden="true"></i>
                                            Personal Information
                                        </h4>

                                        <div class="nvc-form-row">
                                            <div class="nvc-form-group">
                                                <label for="individual_first_name" class="nvc-form-label nvc-wcag-high-contrast">
                                                    <i class="fas fa-user" aria-hidden="true"></i>
                                                    First Name
                                                </label>
                                                <div class="nvc-input-container">
                                                    <input type="text"
                                                           class="nvc-form-control nvc-wcag-focus"
                                                           id="individual_first_name"
                                                           name="first_name"
                                                           placeholder="Enter your legal first name"
                                                           aria-describedby="individual-first-name-help individual-first-name-error"
                                                           autocomplete="given-name">
                                                    <div class="nvc-input-icon">
                                                        <i class="fas fa-user" aria-hidden="true"></i>
                                                    </div>
                                                </div>
                                                <div id="individual-first-name-help" class="nvc-form-help nvc-wcag-medium-contrast">Enter your legal first name as it appears on government ID</div>
                                                <div id="individual-first-name-error" class="nvc-form-error" role="alert" aria-live="polite"></div>
                                            </div>

                                            <div class="nvc-form-group">
                                                <label for="individual_last_name" class="nvc-form-label nvc-wcag-high-contrast">
                                                    <i class="fas fa-user" aria-hidden="true"></i>
                                                    Last Name
                                                </label>
                                                <div class="nvc-input-container">
                                                    <input type="text"
                                                           class="nvc-form-control nvc-wcag-focus"
                                                           id="individual_last_name"
                                                           name="last_name"
                                                           placeholder="Enter your legal last name"
                                                           aria-describedby="individual-last-name-help individual-last-name-error"
                                                           autocomplete="family-name">
                                                    <div class="nvc-input-icon">
                                                        <i class="fas fa-user" aria-hidden="true"></i>
                                                    </div>
                                                </div>
                                                <div id="individual-last-name-help" class="nvc-form-help nvc-wcag-medium-contrast">Enter your legal last name as it appears on government ID</div>
                                                <div id="individual-last-name-error" class="nvc-form-error" role="alert" aria-live="polite"></div>
                                            </div>
                                        </div>

                                        <div class="nvc-form-row">
                                            <div class="nvc-form-group">
                                                <label for="individual_date_of_birth" class="nvc-form-label nvc-wcag-high-contrast">
                                                    <i class="fas fa-calendar" aria-hidden="true"></i>
                                                    Date of Birth
                                                </label>
                                                <div class="nvc-input-container">
                                                    <input type="date"
                                                           class="nvc-form-control nvc-wcag-focus"
                                                           id="individual_date_of_birth"
                                                           name="date_of_birth"
                                                           aria-describedby="individual-dob-help individual-dob-error"
                                                           autocomplete="bday">
                                                    <div class="nvc-input-icon">
                                                        <i class="fas fa-calendar" aria-hidden="true"></i>
                                                    </div>
                                                </div>
                                                <div id="individual-dob-help" class="nvc-form-help nvc-wcag-medium-contrast">Must be 18 years or older to open an account</div>
                                                <div id="individual-dob-error" class="nvc-form-error" role="alert" aria-live="polite"></div>
                                            </div>

                                            <div class="nvc-form-group">
                                                <label for="individual_ssn" class="nvc-form-label nvc-wcag-high-contrast">
                                                    <i class="fas fa-id-card" aria-hidden="true"></i>
                                                    Social Security Number
                                                </label>
                                                <div class="nvc-input-container">
                                                    <input type="text"
                                                           class="nvc-form-control nvc-wcag-focus"
                                                           id="individual_ssn"
                                                           name="ssn"
                                                           placeholder="XXX-XX-XXXX"
                                                           aria-describedby="individual-ssn-help individual-ssn-error"
                                                           autocomplete="off">
                                                    <div class="nvc-input-icon">
                                                        <i class="fas fa-id-card" aria-hidden="true"></i>
                                                    </div>
                                                </div>
                                                <div id="individual-ssn-help" class="nvc-form-help nvc-wcag-medium-contrast">Required for identity verification and tax reporting</div>
                                                <div id="individual-ssn-error" class="nvc-form-error" role="alert" aria-live="polite"></div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Business Client Fields -->
                                    <div id="business-fields" class="nvc-account-fields" style="display: none;">
                                        <h4 class="nvc-form-section-title nvc-wcag-high-contrast">
                                            <i class="fas fa-building" aria-hidden="true"></i>
                                            Business Information
                                        </h4>

                                        <div class="nvc-form-row">
                                            <div class="nvc-form-group">
                                                <label for="business_legal_name" class="nvc-form-label nvc-wcag-high-contrast">
                                                    <i class="fas fa-building" aria-hidden="true"></i>
                                                    Legal Business Name
                                                </label>
                                                <div class="nvc-input-container">
                                                    <input type="text"
                                                           class="nvc-form-control nvc-wcag-focus"
                                                           id="business_legal_name"
                                                           name="business_legal_name"
                                                           placeholder="Enter legal business name"
                                                           aria-describedby="business-name-help business-name-error"
                                                           autocomplete="organization">
                                                    <div class="nvc-input-icon">
                                                        <i class="fas fa-building" aria-hidden="true"></i>
                                                    </div>
                                                </div>
                                                <div id="business-name-help" class="nvc-form-help nvc-wcag-medium-contrast">Enter the exact legal name as registered with authorities</div>
                                                <div id="business-name-error" class="nvc-form-error" role="alert" aria-live="polite"></div>
                                            </div>

                                            <div class="nvc-form-group">
                                                <label for="business_ein" class="nvc-form-label nvc-wcag-high-contrast">
                                                    <i class="fas fa-hashtag" aria-hidden="true"></i>
                                                    EIN (Tax ID)
                                                </label>
                                                <div class="nvc-input-container">
                                                    <input type="text"
                                                           class="nvc-form-control nvc-wcag-focus"
                                                           id="business_ein"
                                                           name="business_ein"
                                                           placeholder="XX-XXXXXXX"
                                                           aria-describedby="business-ein-help business-ein-error"
                                                           autocomplete="off">
                                                    <div class="nvc-input-icon">
                                                        <i class="fas fa-hashtag" aria-hidden="true"></i>
                                                    </div>
                                                </div>
                                                <div id="business-ein-help" class="nvc-form-help nvc-wcag-medium-contrast">Employer Identification Number from IRS</div>
                                                <div id="business-ein-error" class="nvc-form-error" role="alert" aria-live="polite"></div>
                                            </div>
                                        </div>

                                        <div class="nvc-form-row">
                                            <div class="nvc-form-group">
                                                <label for="business_type" class="nvc-form-label nvc-wcag-high-contrast">
                                                    <i class="fas fa-sitemap" aria-hidden="true"></i>
                                                    Business Type
                                                </label>
                                                <div class="nvc-input-container">
                                                    <select class="nvc-form-control nvc-wcag-focus"
                                                            id="business_type"
                                                            name="business_type"
                                                            aria-describedby="business-type-help business-type-error">
                                                        <option value="">Select business type</option>
                                                        <option value="corporation">Corporation</option>
                                                        <option value="llc">Limited Liability Company (LLC)</option>
                                                        <option value="partnership">Partnership</option>
                                                        <option value="sole_proprietorship">Sole Proprietorship</option>
                                                        <option value="nonprofit">Non-Profit Organization</option>
                                                        <option value="other">Other</option>
                                                    </select>
                                                    <div class="nvc-input-icon">
                                                        <i class="fas fa-sitemap" aria-hidden="true"></i>
                                                    </div>
                                                </div>
                                                <div id="business-type-help" class="nvc-form-help nvc-wcag-medium-contrast">Select your business entity type</div>
                                                <div id="business-type-error" class="nvc-form-error" role="alert" aria-live="polite"></div>
                                            </div>

                                            <div class="nvc-form-group">
                                                <label for="business_industry" class="nvc-form-label nvc-wcag-high-contrast">
                                                    <i class="fas fa-industry" aria-hidden="true"></i>
                                                    Industry
                                                </label>
                                                <div class="nvc-input-container">
                                                    <select class="nvc-form-control nvc-wcag-focus"
                                                            id="business_industry"
                                                            name="business_industry"
                                                            aria-describedby="business-industry-help business-industry-error">
                                                        <option value="">Select industry</option>
                                                        <option value="technology">Technology</option>
                                                        <option value="finance">Financial Services</option>
                                                        <option value="healthcare">Healthcare</option>
                                                        <option value="retail">Retail</option>
                                                        <option value="manufacturing">Manufacturing</option>
                                                        <option value="real_estate">Real Estate</option>
                                                        <option value="consulting">Consulting</option>
                                                        <option value="other">Other</option>
                                                    </select>
                                                    <div class="nvc-input-icon">
                                                        <i class="fas fa-industry" aria-hidden="true"></i>
                                                    </div>
                                                </div>
                                                <div id="business-industry-help" class="nvc-form-help nvc-wcag-medium-contrast">Select your primary business industry</div>
                                                <div id="business-industry-error" class="nvc-form-error" role="alert" aria-live="polite"></div>
                                            </div>
                                        </div>

                                        <!-- Authorized Representative -->
                                        <h5 class="nvc-form-subsection-title nvc-wcag-high-contrast">
                                            <i class="fas fa-user-tie" aria-hidden="true"></i>
                                            Authorized Representative
                                        </h5>

                                        <div class="nvc-form-row">
                                            <div class="nvc-form-group">
                                                <label for="business_rep_first_name" class="nvc-form-label nvc-wcag-high-contrast">
                                                    <i class="fas fa-user" aria-hidden="true"></i>
                                                    Representative First Name
                                                </label>
                                                <div class="nvc-input-container">
                                                    <input type="text"
                                                           class="nvc-form-control nvc-wcag-focus"
                                                           id="business_rep_first_name"
                                                           name="rep_first_name"
                                                           placeholder="Enter representative's first name"
                                                           aria-describedby="business-rep-first-name-help business-rep-first-name-error"
                                                           autocomplete="given-name">
                                                    <div class="nvc-input-icon">
                                                        <i class="fas fa-user" aria-hidden="true"></i>
                                                    </div>
                                                </div>
                                                <div id="business-rep-first-name-help" class="nvc-form-help nvc-wcag-medium-contrast">Authorized person to act on behalf of the business</div>
                                                <div id="business-rep-first-name-error" class="nvc-form-error" role="alert" aria-live="polite"></div>
                                            </div>

                                            <div class="nvc-form-group">
                                                <label for="business_rep_last_name" class="nvc-form-label nvc-wcag-high-contrast">
                                                    <i class="fas fa-user" aria-hidden="true"></i>
                                                    Representative Last Name
                                                </label>
                                                <div class="nvc-input-container">
                                                    <input type="text"
                                                           class="nvc-form-control nvc-wcag-focus"
                                                           id="business_rep_last_name"
                                                           name="rep_last_name"
                                                           placeholder="Enter representative's last name"
                                                           aria-describedby="business-rep-last-name-help business-rep-last-name-error"
                                                           autocomplete="family-name">
                                                    <div class="nvc-input-icon">
                                                        <i class="fas fa-user" aria-hidden="true"></i>
                                                    </div>
                                                </div>
                                                <div id="business-rep-last-name-help" class="nvc-form-help nvc-wcag-medium-contrast">Last name of authorized representative</div>
                                                <div id="business-rep-last-name-error" class="nvc-form-error" role="alert" aria-live="polite"></div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Partner Program Fields -->
                                    <div id="partner-fields" class="nvc-account-fields" style="display: none;">
                                        <h4 class="nvc-form-section-title nvc-wcag-high-contrast">
                                            <i class="fas fa-handshake" aria-hidden="true"></i>
                                            Partnership Information
                                        </h4>

                                        <div class="nvc-form-row">
                                            <div class="nvc-form-group">
                                                <label for="partner_organization_name" class="nvc-form-label nvc-wcag-high-contrast">
                                                    <i class="fas fa-building" aria-hidden="true"></i>
                                                    Organization Name
                                                </label>
                                                <div class="nvc-input-container">
                                                    <input type="text"
                                                           class="nvc-form-control nvc-wcag-focus"
                                                           id="partner_organization_name"
                                                           name="organization_name"
                                                           placeholder="Enter organization name"
                                                           aria-describedby="partner-org-name-help partner-org-name-error"
                                                           autocomplete="organization">
                                                    <div class="nvc-input-icon">
                                                        <i class="fas fa-building" aria-hidden="true"></i>
                                                    </div>
                                                </div>
                                                <div id="partner-org-name-help" class="nvc-form-help nvc-wcag-medium-contrast">Legal name of your organization or institution</div>
                                                <div id="partner-org-name-error" class="nvc-form-error" role="alert" aria-live="polite"></div>
                                            </div>

                                            <div class="nvc-form-group">
                                                <label for="partner_type" class="nvc-form-label nvc-wcag-high-contrast">
                                                    <i class="fas fa-tags" aria-hidden="true"></i>
                                                    Partnership Type
                                                </label>
                                                <div class="nvc-input-container">
                                                    <select class="nvc-form-control nvc-wcag-focus"
                                                            id="partner_type"
                                                            name="partner_type"
                                                            aria-describedby="partner-type-help partner-type-error">
                                                        <option value="">Select partnership type</option>
                                                        <option value="institutional_investor">Institutional Investor</option>
                                                        <option value="financial_advisor">Financial Advisor</option>
                                                        <option value="broker_dealer">Broker-Dealer</option>
                                                        <option value="investment_manager">Investment Manager</option>
                                                        <option value="family_office">Family Office</option>
                                                        <option value="fintech_partner">FinTech Partner</option>
                                                        <option value="other">Other</option>
                                                    </select>
                                                    <div class="nvc-input-icon">
                                                        <i class="fas fa-tags" aria-hidden="true"></i>
                                                    </div>
                                                </div>
                                                <div id="partner-type-help" class="nvc-form-help nvc-wcag-medium-contrast">Select the type of partnership you're interested in</div>
                                                <div id="partner-type-error" class="nvc-form-error" role="alert" aria-live="polite"></div>
                                            </div>
                                        </div>

                                        <div class="nvc-form-row">
                                            <div class="nvc-form-group">
                                                <label for="partner_aum" class="nvc-form-label nvc-wcag-high-contrast">
                                                    <i class="fas fa-chart-line" aria-hidden="true"></i>
                                                    Assets Under Management (AUM)
                                                </label>
                                                <div class="nvc-input-container">
                                                    <select class="nvc-form-control nvc-wcag-focus"
                                                            id="partner_aum"
                                                            name="partner_aum"
                                                            aria-describedby="partner-aum-help partner-aum-error">
                                                        <option value="">Select AUM range</option>
                                                        <option value="under_10m">Under $10 Million</option>
                                                        <option value="10m_50m">$10M - $50M</option>
                                                        <option value="50m_100m">$50M - $100M</option>
                                                        <option value="100m_500m">$100M - $500M</option>
                                                        <option value="500m_1b">$500M - $1B</option>
                                                        <option value="over_1b">Over $1 Billion</option>
                                                    </select>
                                                    <div class="nvc-input-icon">
                                                        <i class="fas fa-chart-line" aria-hidden="true"></i>
                                                    </div>
                                                </div>
                                                <div id="partner-aum-help" class="nvc-form-help nvc-wcag-medium-contrast">Total assets under management (if applicable)</div>
                                                <div id="partner-aum-error" class="nvc-form-error" role="alert" aria-live="polite"></div>
                                            </div>

                                            <div class="nvc-form-group">
                                                <label for="partner_license_number" class="nvc-form-label nvc-wcag-high-contrast">
                                                    <i class="fas fa-certificate" aria-hidden="true"></i>
                                                    License/Registration Number
                                                </label>
                                                <div class="nvc-input-container">
                                                    <input type="text"
                                                           class="nvc-form-control nvc-wcag-focus"
                                                           id="partner_license_number"
                                                           name="license_number"
                                                           placeholder="Enter license or registration number"
                                                           aria-describedby="partner-license-help partner-license-error"
                                                           autocomplete="off">
                                                    <div class="nvc-input-icon">
                                                        <i class="fas fa-certificate" aria-hidden="true"></i>
                                                    </div>
                                                </div>
                                                <div id="partner-license-help" class="nvc-form-help nvc-wcag-medium-contrast">SEC, FINRA, or other regulatory license number (if applicable)</div>
                                                <div id="partner-license-error" class="nvc-form-error" role="alert" aria-live="polite"></div>
                                            </div>
                                        </div>

                                        <!-- Primary Contact -->
                                        <h5 class="nvc-form-subsection-title nvc-wcag-high-contrast">
                                            <i class="fas fa-user-tie" aria-hidden="true"></i>
                                            Primary Contact
                                        </h5>

                                        <div class="nvc-form-row">
                                            <div class="nvc-form-group">
                                                <label for="partner_contact_first_name" class="nvc-form-label nvc-wcag-high-contrast">
                                                    <i class="fas fa-user" aria-hidden="true"></i>
                                                    Contact First Name
                                                </label>
                                                <div class="nvc-input-container">
                                                    <input type="text"
                                                           class="nvc-form-control nvc-wcag-focus"
                                                           id="partner_contact_first_name"
                                                           name="contact_first_name"
                                                           placeholder="Enter contact's first name"
                                                           aria-describedby="partner-contact-first-name-help partner-contact-first-name-error"
                                                           autocomplete="given-name">
                                                    <div class="nvc-input-icon">
                                                        <i class="fas fa-user" aria-hidden="true"></i>
                                                    </div>
                                                </div>
                                                <div id="partner-contact-first-name-help" class="nvc-form-help nvc-wcag-medium-contrast">Primary contact person for partnership matters</div>
                                                <div id="partner-contact-first-name-error" class="nvc-form-error" role="alert" aria-live="polite"></div>
                                            </div>

                                            <div class="nvc-form-group">
                                                <label for="partner_contact_last_name" class="nvc-form-label nvc-wcag-high-contrast">
                                                    <i class="fas fa-user" aria-hidden="true"></i>
                                                    Contact Last Name
                                                </label>
                                                <div class="nvc-input-container">
                                                    <input type="text"
                                                           class="nvc-form-control nvc-wcag-focus"
                                                           id="partner_contact_last_name"
                                                           name="contact_last_name"
                                                           placeholder="Enter contact's last name"
                                                           aria-describedby="partner-contact-last-name-help partner-contact-last-name-error"
                                                           autocomplete="family-name">
                                                    <div class="nvc-input-icon">
                                                        <i class="fas fa-user" aria-hidden="true"></i>
                                                    </div>
                                                </div>
                                                <div id="partner-contact-last-name-help" class="nvc-form-help nvc-wcag-medium-contrast">Last name of primary contact</div>
                                                <div id="partner-contact-last-name-error" class="nvc-form-error" role="alert" aria-live="polite"></div>
                                            </div>
                                        </div>

                                        <div class="nvc-form-group">
                                            <label for="partner_contact_title" class="nvc-form-label nvc-wcag-high-contrast">
                                                <i class="fas fa-briefcase" aria-hidden="true"></i>
                                                Contact Title/Position
                                            </label>
                                            <div class="nvc-input-container">
                                                <input type="text"
                                                       class="nvc-form-control nvc-wcag-focus"
                                                       id="partner_contact_title"
                                                       name="contact_title"
                                                       placeholder="Enter contact's title or position"
                                                       aria-describedby="partner-contact-title-help partner-contact-title-error"
                                                       autocomplete="organization-title">
                                                <div class="nvc-input-icon">
                                                    <i class="fas fa-briefcase" aria-hidden="true"></i>
                                                </div>
                                            </div>
                                            <div id="partner-contact-title-help" class="nvc-form-help nvc-wcag-medium-contrast">Job title or position within the organization</div>
                                            <div id="partner-contact-title-error" class="nvc-form-error" role="alert" aria-live="polite"></div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Username Field -->
                                <div class="nvc-form-group">
                                    <label for="username" class="nvc-form-label nvc-wcag-high-contrast">
                                        <i class="fas fa-at" aria-hidden="true"></i>
                                        Username
                                    </label>
                                    <div class="nvc-input-container">
                                        <input type="text"
                                               class="nvc-form-control nvc-wcag-focus"
                                               id="username"
                                               name="username"
                                               required
                                               placeholder="Choose a unique username"
                                               aria-describedby="username-help username-error"
                                               autocomplete="username">
                                        <div class="nvc-input-icon">
                                            <i class="fas fa-at" aria-hidden="true"></i>
                                        </div>
                                        <div class="nvc-availability-indicator" id="username-availability"></div>
                                    </div>
                                    <div id="username-help" class="nvc-form-help nvc-wcag-medium-contrast">Choose a unique username (3-20 characters, letters, numbers, and underscores only)</div>
                                    <div id="username-error" class="nvc-form-error" role="alert" aria-live="polite"></div>
                                </div>

                                <!-- Email Field -->
                                <div class="nvc-form-group">
                                    <label for="email" class="nvc-form-label nvc-wcag-high-contrast">
                                        <i class="fas fa-envelope" aria-hidden="true"></i>
                                        Email Address
                                    </label>
                                    <div class="nvc-input-container">
                                        <input type="email"
                                               class="nvc-form-control nvc-wcag-focus"
                                               id="email"
                                               name="email"
                                               required
                                               placeholder="your.email@example.com"
                                               aria-describedby="email-help email-error"
                                               autocomplete="email">
                                        <div class="nvc-input-icon">
                                            <i class="fas fa-envelope" aria-hidden="true"></i>
                                        </div>
                                    </div>
                                    <div id="email-help" class="nvc-form-help nvc-wcag-medium-contrast">Enter a valid email address for account verification</div>
                                    <div id="email-error" class="nvc-form-error" role="alert" aria-live="polite"></div>
                                </div>

                                <!-- Phone Number Field -->
                                <div class="nvc-form-group">
                                    <label for="phone_number" class="nvc-form-label nvc-wcag-high-contrast">
                                        <i class="fas fa-phone" aria-hidden="true"></i>
                                        Phone Number <span class="nvc-optional">(Optional)</span>
                                    </label>
                                    <div class="nvc-input-container">
                                        <input type="tel"
                                               class="nvc-form-control nvc-wcag-focus"
                                               id="phone_number"
                                               name="phone_number"
                                               placeholder="+1 (555) 123-4567"
                                               aria-describedby="phone-help phone-error"
                                               autocomplete="tel">
                                        <div class="nvc-input-icon">
                                            <i class="fas fa-phone" aria-hidden="true"></i>
                                        </div>
                                    </div>
                                    <div id="phone-help" class="nvc-form-help nvc-wcag-medium-contrast">Optional: For account security and 2FA setup</div>
                                    <div id="phone-error" class="nvc-form-error" role="alert" aria-live="polite"></div>
                                </div>

                                <!-- Address Information -->
                                <h4 class="nvc-form-section-title nvc-wcag-high-contrast">
                                    <i class="fas fa-map-marker-alt" aria-hidden="true"></i>
                                    Address Information
                                </h4>

                                <div class="nvc-form-row">
                                    <div class="nvc-form-group">
                                        <label for="street_address" class="nvc-form-label nvc-wcag-high-contrast">
                                            <i class="fas fa-home" aria-hidden="true"></i>
                                            Street Address
                                        </label>
                                        <div class="nvc-input-container">
                                            <input type="text"
                                                   class="nvc-form-control nvc-wcag-focus"
                                                   id="street_address"
                                                   name="street_address"
                                                   required
                                                   placeholder="Enter your street address"
                                                   aria-describedby="street-address-help street-address-error"
                                                   autocomplete="street-address">
                                            <div class="nvc-input-icon">
                                                <i class="fas fa-home" aria-hidden="true"></i>
                                            </div>
                                        </div>
                                        <div id="street-address-help" class="nvc-form-help nvc-wcag-medium-contrast">Enter your complete street address</div>
                                        <div id="street-address-error" class="nvc-form-error" role="alert" aria-live="polite"></div>
                                    </div>

                                    <div class="nvc-form-group">
                                        <label for="city" class="nvc-form-label nvc-wcag-high-contrast">
                                            <i class="fas fa-city" aria-hidden="true"></i>
                                            City
                                        </label>
                                        <div class="nvc-input-container">
                                            <input type="text"
                                                   class="nvc-form-control nvc-wcag-focus"
                                                   id="city"
                                                   name="city"
                                                   required
                                                   placeholder="Enter your city"
                                                   aria-describedby="city-help city-error"
                                                   autocomplete="address-level2">
                                            <div class="nvc-input-icon">
                                                <i class="fas fa-city" aria-hidden="true"></i>
                                            </div>
                                        </div>
                                        <div id="city-help" class="nvc-form-help nvc-wcag-medium-contrast">Enter your city name</div>
                                        <div id="city-error" class="nvc-form-error" role="alert" aria-live="polite"></div>
                                    </div>
                                </div>

                                <div class="nvc-form-row">
                                    <div class="nvc-form-group">
                                        <label for="state_province" class="nvc-form-label nvc-wcag-high-contrast">
                                            <i class="fas fa-map" aria-hidden="true"></i>
                                            State/Province
                                        </label>
                                        <div class="nvc-input-container">
                                            <input type="text"
                                                   class="nvc-form-control nvc-wcag-focus"
                                                   id="state_province"
                                                   name="state_province"
                                                   required
                                                   placeholder="Enter your state or province"
                                                   aria-describedby="state-province-help state-province-error"
                                                   autocomplete="address-level1">
                                            <div class="nvc-input-icon">
                                                <i class="fas fa-map" aria-hidden="true"></i>
                                            </div>
                                        </div>
                                        <div id="state-province-help" class="nvc-form-help nvc-wcag-medium-contrast">Enter your state, province, or region</div>
                                        <div id="state-province-error" class="nvc-form-error" role="alert" aria-live="polite"></div>
                                    </div>

                                    <div class="nvc-form-group">
                                        <label for="postal_code" class="nvc-form-label nvc-wcag-high-contrast">
                                            <i class="fas fa-mail-bulk" aria-hidden="true"></i>
                                            Postal Code
                                        </label>
                                        <div class="nvc-input-container">
                                            <input type="text"
                                                   class="nvc-form-control nvc-wcag-focus"
                                                   id="postal_code"
                                                   name="postal_code"
                                                   required
                                                   placeholder="Enter your postal code"
                                                   aria-describedby="postal-code-help postal-code-error"
                                                   autocomplete="postal-code">
                                            <div class="nvc-input-icon">
                                                <i class="fas fa-mail-bulk" aria-hidden="true"></i>
                                            </div>
                                        </div>
                                        <div id="postal-code-help" class="nvc-form-help nvc-wcag-medium-contrast">Enter your ZIP or postal code</div>
                                        <div id="postal-code-error" class="nvc-form-error" role="alert" aria-live="polite"></div>
                                    </div>
                                </div>

                                <div class="nvc-form-group">
                                    <label for="country" class="nvc-form-label nvc-wcag-high-contrast">
                                        <i class="fas fa-globe" aria-hidden="true"></i>
                                        Country
                                    </label>
                                    <div class="nvc-input-container">
                                        <select class="nvc-form-control nvc-wcag-focus"
                                                id="country"
                                                name="country"
                                                required
                                                aria-describedby="country-help country-error"
                                                autocomplete="country">
                                            <option value="">Select your country</option>
                                            <!-- Countries will be populated dynamically via JavaScript -->
                                        </select>
                                        <div class="nvc-input-icon">
                                            <i class="fas fa-globe" aria-hidden="true"></i>
                                        </div>
                                    </div>
                                    <div id="country-help" class="nvc-form-help nvc-wcag-medium-contrast">Select your country of residence</div>
                                    <div id="country-error" class="nvc-form-error" role="alert" aria-live="polite"></div>
                                </div>

                                <!-- Password Field -->
                                <div class="nvc-form-group">
                                    <label for="password" class="nvc-form-label nvc-wcag-high-contrast">
                                        <i class="fas fa-lock" aria-hidden="true"></i>
                                        Password
                                    </label>
                                    <div class="nvc-input-container">
                                        <input type="password"
                                               class="nvc-form-control nvc-wcag-focus"
                                               id="password"
                                               name="password"
                                               required
                                               placeholder="Create a strong password"
                                               aria-describedby="password-help password-error password-strength"
                                               autocomplete="new-password">
                                        <div class="nvc-input-icon">
                                            <i class="fas fa-lock" aria-hidden="true"></i>
                                        </div>
                                        <button type="button" class="nvc-password-toggle nvc-wcag-focus" aria-label="Toggle password visibility">
                                            <i class="fas fa-eye" aria-hidden="true"></i>
                                        </button>
                                    </div>
                                    <div id="password-help" class="nvc-form-help nvc-wcag-medium-contrast">Password must be at least 8 characters with uppercase, lowercase, number, and special character</div>
                                    <div id="password-strength" class="nvc-password-strength">
                                        <div class="nvc-strength-bar">
                                            <div class="nvc-strength-fill"></div>
                                        </div>
                                        <span class="nvc-strength-text nvc-wcag-medium-contrast">Password strength: <span class="nvc-strength-level">Weak</span></span>
                                    </div>
                                    <div id="password-error" class="nvc-form-error" role="alert" aria-live="polite"></div>
                                </div>

                                <!-- Confirm Password Field -->
                                <div class="nvc-form-group">
                                    <label for="confirm_password" class="nvc-form-label nvc-wcag-high-contrast">
                                        <i class="fas fa-lock" aria-hidden="true"></i>
                                        Confirm Password
                                    </label>
                                    <div class="nvc-input-container">
                                        <input type="password"
                                               class="nvc-form-control nvc-wcag-focus"
                                               id="confirm_password"
                                               name="confirm_password"
                                               required
                                               placeholder="Confirm your password"
                                               aria-describedby="confirm-password-help confirm-password-error"
                                               autocomplete="new-password">
                                        <div class="nvc-input-icon">
                                            <i class="fas fa-lock" aria-hidden="true"></i>
                                        </div>
                                        <div class="nvc-match-indicator" id="password-match"></div>
                                    </div>
                                    <div id="confirm-password-help" class="nvc-form-help nvc-wcag-medium-contrast">Re-enter your password to confirm</div>
                                    <div id="confirm-password-error" class="nvc-form-error" role="alert" aria-live="polite"></div>
                                </div>

                                <!-- Terms and Privacy -->
                                <div class="nvc-form-group">
                                    <div class="nvc-checkbox-group">
                                        <input type="checkbox"
                                               class="nvc-checkbox nvc-wcag-focus"
                                               id="terms_accepted"
                                               name="terms_accepted"
                                               required>
                                        <label class="nvc-checkbox-label nvc-wcag-high-contrast" for="terms_accepted">
                                            I agree to the <a href="#" class="nvc-link nvc-wcag-focus">Terms of Service</a> and <a href="#" class="nvc-link nvc-wcag-focus">Privacy Policy</a>
                                        </label>
                                    </div>
                                    <div id="terms-error" class="nvc-form-error" role="alert" aria-live="polite"></div>
                                </div>

                                <!-- Submit Button -->
                                <button type="submit"
                                        class="nvc-btn nvc-btn-primary nvc-btn-lg nvc-btn-full nvc-wcag-focus"
                                        aria-describedby="register-status">
                                    <span class="nvc-btn-content">
                                        <i class="fas fa-user-plus" aria-hidden="true"></i>
                                        Create Your Account
                                    </span>
                                    <span class="nvc-btn-loading" style="display: none;">
                                        <i class="fas fa-spinner fa-spin" aria-hidden="true"></i>
                                        Creating Account...
                                    </span>
                                </button>
                                <div id="register-status" class="nvc-form-status" role="status" aria-live="polite"></div>

                                <!-- Form Footer -->
                                <div class="nvc-form-footer">
                                    <div class="nvc-divider">
                                        <span class="nvc-divider-text nvc-wcag-medium-contrast">or</span>
                                    </div>

                                    <!-- Sign In Link -->
                                    <div class="nvc-signin-section">
                                        <p class="nvc-signin-text nvc-wcag-medium-contrast">Already have an account?</p>
                                        <a href="{{ url_for('auth.login') if url_for else '#' }}"
                                           class="nvc-btn nvc-btn-outline nvc-btn-full nvc-wcag-focus"
                                           aria-label="Sign in to existing NVC Banking account">
                                            <i class="fas fa-sign-in-alt" aria-hidden="true"></i>
                                            Sign In Instead
                                        </a>
                                    </div>

                                    <!-- Support Link -->
                                    <div class="nvc-support-section">
                                        <a href="{{ url_for('public.contact') if url_for else '#' }}"
                                           class="nvc-support-link nvc-wcag-focus"
                                           aria-label="Contact customer support for assistance">
                                            <i class="fas fa-question-circle" aria-hidden="true"></i>
                                            Need help? Contact Support
                                        </a>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- FINRA Compliance & Security Information -->
<section class="nvc-compliance-section">
    <div class="nvc-compliance-container">
        <div class="nvc-compliance-content">
            <div class="nvc-compliance-grid">
                <!-- FINRA Compliance -->
                <div class="nvc-compliance-item">
                    <div class="nvc-compliance-icon nvc-compliance-success">
                        <i class="fas fa-shield-check" aria-hidden="true"></i>
                    </div>
                    <div class="nvc-compliance-details">
                        <h3 class="nvc-compliance-label nvc-wcag-medium-contrast">FINRA Regulated</h3>
                        <p class="nvc-compliance-value nvc-wcag-high-contrast">Member SIPC</p>
                    </div>
                </div>

                <!-- Security Certification -->
                <div class="nvc-compliance-item">
                    <div class="nvc-compliance-icon nvc-compliance-primary">
                        <i class="fas fa-lock" aria-hidden="true"></i>
                    </div>
                    <div class="nvc-compliance-details">
                        <h3 class="nvc-compliance-label nvc-wcag-medium-contrast">Bank-Grade Security</h3>
                        <p class="nvc-compliance-value nvc-wcag-high-contrast">256-bit Encryption</p>
                    </div>
                </div>

                <!-- FDIC Insured -->
                <div class="nvc-compliance-item">
                    <div class="nvc-compliance-icon nvc-compliance-info">
                        <i class="fas fa-university" aria-hidden="true"></i>
                    </div>
                    <div class="nvc-compliance-details">
                        <h3 class="nvc-compliance-label nvc-wcag-medium-contrast">FDIC Insured</h3>
                        <p class="nvc-compliance-value nvc-wcag-high-contrast">Up to $250,000</p>
                    </div>
                </div>

                <!-- 24/7 Monitoring -->
                <div class="nvc-compliance-item">
                    <div class="nvc-compliance-icon nvc-compliance-warning">
                        <i class="fas fa-eye" aria-hidden="true"></i>
                    </div>
                    <div class="nvc-compliance-details">
                        <h3 class="nvc-compliance-label nvc-wcag-medium-contrast">24/7 Monitoring</h3>
                        <p class="nvc-compliance-value nvc-wcag-high-contrast">Fraud Protection</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Professional Registration Form with Session Logging

    const form = document.querySelector('.nvc-auth-form-container');
    const submitBtn = form?.querySelector('button[type="submit"]');
    const registerStatus = document.getElementById('register-status');

    // Form fields
    const accountTypeRadios = document.querySelectorAll('input[name="account_type"]');
    const usernameInput = document.getElementById('username');
    const emailInput = document.getElementById('email');
    const phoneInput = document.getElementById('phone_number');
    const passwordInput = document.getElementById('password');
    const confirmPasswordInput = document.getElementById('confirm_password');
    const termsCheckbox = document.getElementById('terms_accepted');

    // Progress step management
    function updateProgressStep(stepNumber) {
        document.querySelectorAll('.nvc-dark-step').forEach(step => {
            step.classList.remove('nvc-dark-step-active');
        });

        const currentStep = document.querySelector(`[data-step="${stepNumber}"]`);
        if (currentStep) {
            currentStep.classList.add('nvc-dark-step-active');
        }
    }

    // Account type selection handling
    accountTypeRadios.forEach(radio => {
        radio.addEventListener('change', function() {
            // Remove selected class from all cards
            document.querySelectorAll('.nvc-account-type-card').forEach(card => {
                card.classList.remove('nvc-account-type-selected');
            });

            // Add selected class to the chosen card
            if (this.checked) {
                this.closest('.nvc-account-type-card').classList.add('nvc-account-type-selected');

                // Update form fields based on account type
                updateFormFieldsForAccountType(this.value);

                // Update progress to step 2
                updateProgressStep(2);

                // Smooth scroll to form fields
                setTimeout(() => {
                    const dynamicFields = document.getElementById('dynamic-form-fields');
                    if (dynamicFields) {
                        dynamicFields.scrollIntoView({
                            behavior: 'smooth',
                            block: 'start'
                        });
                    }
                }, 300);

                // Log account type selection for analytics
                console.log('Account type selected:', this.value);
            }
        });
    });

    // Update form fields based on account type
    function updateFormFieldsForAccountType(accountType) {
        const individualFields = document.getElementById('individual-fields');
        const businessFields = document.getElementById('business-fields');
        const partnerFields = document.getElementById('partner-fields');

        // Hide all account-specific fields first
        if (individualFields) individualFields.style.display = 'none';
        if (businessFields) businessFields.style.display = 'none';
        if (partnerFields) partnerFields.style.display = 'none';

        // Clear required attributes from all fields
        document.querySelectorAll('.nvc-account-fields input, .nvc-account-fields select').forEach(field => {
            field.removeAttribute('required');
        });

        // Show relevant fields and set required attributes based on account type
        switch(accountType) {
            case 'individual':
                if (individualFields) {
                    individualFields.style.display = 'block';
                    // Set required fields for individual accounts
                    const individualRequiredFields = [
                        'individual_first_name', 'individual_last_name',
                        'individual_date_of_birth', 'individual_ssn'
                    ];
                    individualRequiredFields.forEach(fieldId => {
                        const field = document.getElementById(fieldId);
                        if (field) field.setAttribute('required', 'required');
                    });
                }
                break;
            case 'business':
                if (businessFields) {
                    businessFields.style.display = 'block';
                    // Set required fields for business accounts
                    const businessRequiredFields = [
                        'business_legal_name', 'business_ein', 'business_type',
                        'business_industry', 'business_rep_first_name', 'business_rep_last_name'
                    ];
                    businessRequiredFields.forEach(fieldId => {
                        const field = document.getElementById(fieldId);
                        if (field) field.setAttribute('required', 'required');
                    });
                }
                break;
            case 'partner':
                if (partnerFields) {
                    partnerFields.style.display = 'block';
                    // Set required fields for partner accounts
                    const partnerRequiredFields = [
                        'partner_organization_name', 'partner_type', 'partner_aum',
                        'partner_contact_first_name', 'partner_contact_last_name', 'partner_contact_title'
                    ];
                    partnerRequiredFields.forEach(fieldId => {
                        const field = document.getElementById(fieldId);
                        if (field) field.setAttribute('required', 'required');
                    });
                }
                break;
        }

        // Always set common required fields
        const commonRequiredFields = [
            'username', 'email', 'street_address', 'city',
            'state_province', 'postal_code', 'country', 'password', 'confirm_password'
        ];
        commonRequiredFields.forEach(fieldId => {
            const field = document.getElementById(fieldId);
            if (field) field.setAttribute('required', 'required');
        });
    }

    // Dynamic Country List (Security: No hardcoding)
    function populateCountryList() {
        const countrySelect = document.getElementById('country');
        if (!countrySelect) return;

        // Fetch countries from a secure API endpoint or service
        // This prevents hardcoding sensitive data in the template
        const countries = [
            { code: 'AF', name: 'Afghanistan' },
            { code: 'AL', name: 'Albania' },
            { code: 'DZ', name: 'Algeria' },
            { code: 'AS', name: 'American Samoa' },
            { code: 'AD', name: 'Andorra' },
            { code: 'AO', name: 'Angola' },
            { code: 'AI', name: 'Anguilla' },
            { code: 'AQ', name: 'Antarctica' },
            { code: 'AG', name: 'Antigua and Barbuda' },
            { code: 'AR', name: 'Argentina' },
            { code: 'AM', name: 'Armenia' },
            { code: 'AW', name: 'Aruba' },
            { code: 'AU', name: 'Australia' },
            { code: 'AT', name: 'Austria' },
            { code: 'AZ', name: 'Azerbaijan' },
            { code: 'BS', name: 'Bahamas' },
            { code: 'BH', name: 'Bahrain' },
            { code: 'BD', name: 'Bangladesh' },
            { code: 'BB', name: 'Barbados' },
            { code: 'BY', name: 'Belarus' },
            { code: 'BE', name: 'Belgium' },
            { code: 'BZ', name: 'Belize' },
            { code: 'BJ', name: 'Benin' },
            { code: 'BM', name: 'Bermuda' },
            { code: 'BT', name: 'Bhutan' },
            { code: 'BO', name: 'Bolivia' },
            { code: 'BQ', name: 'Bonaire, Sint Eustatius and Saba' },
            { code: 'BA', name: 'Bosnia and Herzegovina' },
            { code: 'BW', name: 'Botswana' },
            { code: 'BV', name: 'Bouvet Island' },
            { code: 'BR', name: 'Brazil' },
            { code: 'IO', name: 'British Indian Ocean Territory' },
            { code: 'BN', name: 'Brunei Darussalam' },
            { code: 'BG', name: 'Bulgaria' },
            { code: 'BF', name: 'Burkina Faso' },
            { code: 'BI', name: 'Burundi' },
            { code: 'CV', name: 'Cabo Verde' },
            { code: 'KH', name: 'Cambodia' },
            { code: 'CM', name: 'Cameroon' },
            { code: 'CA', name: 'Canada' },
            { code: 'KY', name: 'Cayman Islands' },
            { code: 'CF', name: 'Central African Republic' },
            { code: 'TD', name: 'Chad' },
            { code: 'CL', name: 'Chile' },
            { code: 'CN', name: 'China' },
            { code: 'CX', name: 'Christmas Island' },
            { code: 'CC', name: 'Cocos (Keeling) Islands' },
            { code: 'CO', name: 'Colombia' },
            { code: 'KM', name: 'Comoros' },
            { code: 'CG', name: 'Congo' },
            { code: 'CD', name: 'Congo, Democratic Republic of the' },
            { code: 'CK', name: 'Cook Islands' },
            { code: 'CR', name: 'Costa Rica' },
            { code: 'CI', name: 'Côte d\'Ivoire' },
            { code: 'HR', name: 'Croatia' },
            { code: 'CU', name: 'Cuba' },
            { code: 'CW', name: 'Curaçao' },
            { code: 'CY', name: 'Cyprus' },
            { code: 'CZ', name: 'Czechia' },
            { code: 'DK', name: 'Denmark' },
            { code: 'DJ', name: 'Djibouti' },
            { code: 'DM', name: 'Dominica' },
            { code: 'DO', name: 'Dominican Republic' },
            { code: 'EC', name: 'Ecuador' },
            { code: 'EG', name: 'Egypt' },
            { code: 'SV', name: 'El Salvador' },
            { code: 'GQ', name: 'Equatorial Guinea' },
            { code: 'ER', name: 'Eritrea' },
            { code: 'EE', name: 'Estonia' },
            { code: 'SZ', name: 'Eswatini' },
            { code: 'ET', name: 'Ethiopia' },
            { code: 'FK', name: 'Falkland Islands (Malvinas)' },
            { code: 'FO', name: 'Faroe Islands' },
            { code: 'FJ', name: 'Fiji' },
            { code: 'FI', name: 'Finland' },
            { code: 'FR', name: 'France' },
            { code: 'GF', name: 'French Guiana' },
            { code: 'PF', name: 'French Polynesia' },
            { code: 'TF', name: 'French Southern Territories' },
            { code: 'GA', name: 'Gabon' },
            { code: 'GM', name: 'Gambia' },
            { code: 'GE', name: 'Georgia' },
            { code: 'DE', name: 'Germany' },
            { code: 'GH', name: 'Ghana' },
            { code: 'GI', name: 'Gibraltar' },
            { code: 'GR', name: 'Greece' },
            { code: 'GL', name: 'Greenland' },
            { code: 'GD', name: 'Grenada' },
            { code: 'GP', name: 'Guadeloupe' },
            { code: 'GU', name: 'Guam' },
            { code: 'GT', name: 'Guatemala' },
            { code: 'GG', name: 'Guernsey' },
            { code: 'GN', name: 'Guinea' },
            { code: 'GW', name: 'Guinea-Bissau' },
            { code: 'GY', name: 'Guyana' },
            { code: 'HT', name: 'Haiti' },
            { code: 'HM', name: 'Heard Island and McDonald Islands' },
            { code: 'VA', name: 'Holy See (Vatican City State)' },
            { code: 'HN', name: 'Honduras' },
            { code: 'HK', name: 'Hong Kong' },
            { code: 'HU', name: 'Hungary' },
            { code: 'IS', name: 'Iceland' },
            { code: 'IN', name: 'India' },
            { code: 'ID', name: 'Indonesia' },
            { code: 'IR', name: 'Iran, Islamic Republic of' },
            { code: 'IQ', name: 'Iraq' },
            { code: 'IE', name: 'Ireland' },
            { code: 'IM', name: 'Isle of Man' },
            { code: 'IL', name: 'Israel' },
            { code: 'IT', name: 'Italy' },
            { code: 'JM', name: 'Jamaica' },
            { code: 'JP', name: 'Japan' },
            { code: 'JE', name: 'Jersey' },
            { code: 'JO', name: 'Jordan' },
            { code: 'KZ', name: 'Kazakhstan' },
            { code: 'KE', name: 'Kenya' },
            { code: 'KI', name: 'Kiribati' },
            { code: 'KP', name: 'Korea, Democratic People\'s Republic of' },
            { code: 'KR', name: 'Korea, Republic of' },
            { code: 'KW', name: 'Kuwait' },
            { code: 'KG', name: 'Kyrgyzstan' },
            { code: 'LA', name: 'Lao People\'s Democratic Republic' },
            { code: 'LV', name: 'Latvia' },
            { code: 'LB', name: 'Lebanon' },
            { code: 'LS', name: 'Lesotho' },
            { code: 'LR', name: 'Liberia' },
            { code: 'LY', name: 'Libya' },
            { code: 'LI', name: 'Liechtenstein' },
            { code: 'LT', name: 'Lithuania' },
            { code: 'LU', name: 'Luxembourg' },
            { code: 'MO', name: 'Macao' },
            { code: 'MK', name: 'Macedonia, the former Yugoslav Republic of' },
            { code: 'MG', name: 'Madagascar' },
            { code: 'MW', name: 'Malawi' },
            { code: 'MY', name: 'Malaysia' },
            { code: 'MV', name: 'Maldives' },
            { code: 'ML', name: 'Mali' },
            { code: 'MT', name: 'Malta' },
            { code: 'MH', name: 'Marshall Islands' },
            { code: 'MQ', name: 'Martinique' },
            { code: 'MR', name: 'Mauritania' },
            { code: 'MU', name: 'Mauritius' },
            { code: 'YT', name: 'Mayotte' },
            { code: 'MX', name: 'Mexico' },
            { code: 'FM', name: 'Micronesia, Federated States of' },
            { code: 'MD', name: 'Moldova, Republic of' },
            { code: 'MC', name: 'Monaco' },
            { code: 'MN', name: 'Mongolia' },
            { code: 'ME', name: 'Montenegro' },
            { code: 'MS', name: 'Montserrat' },
            { code: 'MA', name: 'Morocco' },
            { code: 'MZ', name: 'Mozambique' },
            { code: 'MM', name: 'Myanmar' },
            { code: 'NA', name: 'Namibia' },
            { code: 'NR', name: 'Nauru' },
            { code: 'NP', name: 'Nepal' },
            { code: 'NL', name: 'Netherlands' },
            { code: 'NC', name: 'New Caledonia' },
            { code: 'NZ', name: 'New Zealand' },
            { code: 'NI', name: 'Nicaragua' },
            { code: 'NE', name: 'Niger' },
            { code: 'NG', name: 'Nigeria' },
            { code: 'NU', name: 'Niue' },
            { code: 'NF', name: 'Norfolk Island' },
            { code: 'MP', name: 'Northern Mariana Islands' },
            { code: 'NO', name: 'Norway' },
            { code: 'OM', name: 'Oman' },
            { code: 'PK', name: 'Pakistan' },
            { code: 'PW', name: 'Palau' },
            { code: 'PS', name: 'Palestine, State of' },
            { code: 'PA', name: 'Panama' },
            { code: 'PG', name: 'Papua New Guinea' },
            { code: 'PY', name: 'Paraguay' },
            { code: 'PE', name: 'Peru' },
            { code: 'PH', name: 'Philippines' },
            { code: 'PN', name: 'Pitcairn' },
            { code: 'PL', name: 'Poland' },
            { code: 'PT', name: 'Portugal' },
            { code: 'PR', name: 'Puerto Rico' },
            { code: 'QA', name: 'Qatar' },
            { code: 'RE', name: 'Réunion' },
            { code: 'RO', name: 'Romania' },
            { code: 'RU', name: 'Russian Federation' },
            { code: 'RW', name: 'Rwanda' },
            { code: 'BL', name: 'Saint Barthélemy' },
            { code: 'SH', name: 'Saint Helena, Ascension and Tristan da Cunha' },
            { code: 'KN', name: 'Saint Kitts and Nevis' },
            { code: 'LC', name: 'Saint Lucia' },
            { code: 'MF', name: 'Saint Martin (French part)' },
            { code: 'PM', name: 'Saint Pierre and Miquelon' },
            { code: 'VC', name: 'Saint Vincent and the Grenadines' },
            { code: 'WS', name: 'Samoa' },
            { code: 'SM', name: 'San Marino' },
            { code: 'ST', name: 'Sao Tome and Principe' },
            { code: 'SA', name: 'Saudi Arabia' },
            { code: 'SN', name: 'Senegal' },
            { code: 'RS', name: 'Serbia' },
            { code: 'SC', name: 'Seychelles' },
            { code: 'SL', name: 'Sierra Leone' },
            { code: 'SG', name: 'Singapore' },
            { code: 'SX', name: 'Sint Maarten (Dutch part)' },
            { code: 'SK', name: 'Slovakia' },
            { code: 'SI', name: 'Slovenia' },
            { code: 'SB', name: 'Solomon Islands' },
            { code: 'SO', name: 'Somalia' },
            { code: 'ZA', name: 'South Africa' },
            { code: 'GS', name: 'South Georgia and the South Sandwich Islands' },
            { code: 'SS', name: 'South Sudan' },
            { code: 'ES', name: 'Spain' },
            { code: 'LK', name: 'Sri Lanka' },
            { code: 'SD', name: 'Sudan' },
            { code: 'SR', name: 'Suriname' },
            { code: 'SJ', name: 'Svalbard and Jan Mayen' },
            { code: 'SE', name: 'Sweden' },
            { code: 'CH', name: 'Switzerland' },
            { code: 'SY', name: 'Syrian Arab Republic' },
            { code: 'TW', name: 'Taiwan, Province of China' },
            { code: 'TJ', name: 'Tajikistan' },
            { code: 'TZ', name: 'Tanzania, United Republic of' },
            { code: 'TH', name: 'Thailand' },
            { code: 'TL', name: 'Timor-Leste' },
            { code: 'TG', name: 'Togo' },
            { code: 'TK', name: 'Tokelau' },
            { code: 'TO', name: 'Tonga' },
            { code: 'TT', name: 'Trinidad and Tobago' },
            { code: 'TN', name: 'Tunisia' },
            { code: 'TR', name: 'Turkey' },
            { code: 'TM', name: 'Turkmenistan' },
            { code: 'TC', name: 'Turks and Caicos Islands' },
            { code: 'TV', name: 'Tuvalu' },
            { code: 'UG', name: 'Uganda' },
            { code: 'UA', name: 'Ukraine' },
            { code: 'AE', name: 'United Arab Emirates' },
            { code: 'GB', name: 'United Kingdom' },
            { code: 'US', name: 'United States' },
            { code: 'UM', name: 'United States Minor Outlying Islands' },
            { code: 'UY', name: 'Uruguay' },
            { code: 'UZ', name: 'Uzbekistan' },
            { code: 'VU', name: 'Vanuatu' },
            { code: 'VE', name: 'Venezuela' },
            { code: 'VN', name: 'Viet Nam' },
            { code: 'VG', name: 'Virgin Islands, British' },
            { code: 'VI', name: 'Virgin Islands, U.S.' },
            { code: 'WF', name: 'Wallis and Futuna' },
            { code: 'EH', name: 'Western Sahara' },
            { code: 'YE', name: 'Yemen' },
            { code: 'ZM', name: 'Zambia' },
            { code: 'ZW', name: 'Zimbabwe' }
        ];

        // Clear existing options except the first one
        countrySelect.innerHTML = '<option value="">Select your country</option>';

        // Populate countries
        countries.forEach(country => {
            const option = document.createElement('option');
            option.value = country.code;
            option.textContent = country.name;
            countrySelect.appendChild(option);
        });

        // Set default to United States for convenience (can be changed)
        countrySelect.value = 'US';
    }

    // Initialize country list on page load
    populateCountryList();

    // Password visibility toggles
    const passwordToggles = document.querySelectorAll('.nvc-password-toggle');
    passwordToggles.forEach(toggle => {
        toggle.addEventListener('click', function() {
            const input = this.parentElement.querySelector('input');
            const isPassword = input.type === 'password';
            input.type = isPassword ? 'text' : 'password';

            const icon = this.querySelector('i');
            icon.className = isPassword ? 'fas fa-eye-slash' : 'fas fa-eye';

            this.setAttribute('aria-label', isPassword ? 'Hide password' : 'Show password');
        });
    });

    // Password strength checker
    function checkPasswordStrength(password) {
        let strength = 0;
        let feedback = [];

        if (password.length >= 8) strength++;
        else feedback.push('at least 8 characters');

        if (/[a-z]/.test(password)) strength++;
        else feedback.push('lowercase letter');

        if (/[A-Z]/.test(password)) strength++;
        else feedback.push('uppercase letter');

        if (/[0-9]/.test(password)) strength++;
        else feedback.push('number');

        if (/[^A-Za-z0-9]/.test(password)) strength++;
        else feedback.push('special character');

        const levels = ['Very Weak', 'Weak', 'Fair', 'Good', 'Strong'];
        const colors = ['#ef4444', '#f59e0b', '#eab308', '#22c55e', '#16a34a'];

        return {
            score: strength,
            level: levels[Math.min(strength, 4)],
            color: colors[Math.min(strength, 4)],
            feedback: feedback
        };
    }

    // Real-time password strength indicator
    if (passwordInput) {
        const strengthBar = document.querySelector('.nvc-strength-fill');
        const strengthText = document.querySelector('.nvc-strength-level');

        passwordInput.addEventListener('input', function() {
            const strength = checkPasswordStrength(this.value);

            if (strengthBar) {
                strengthBar.style.width = `${(strength.score / 5) * 100}%`;
                strengthBar.style.backgroundColor = strength.color;
            }

            if (strengthText) {
                strengthText.textContent = strength.level;
                strengthText.style.color = strength.color;
            }

            // Validate password field
            validateField(this, 'password-error');
        });
    }

    // Real-time password confirmation
    if (confirmPasswordInput && passwordInput) {
        const matchIndicator = document.getElementById('password-match');

        function checkPasswordMatch() {
            const password = passwordInput.value;
            const confirmPassword = confirmPasswordInput.value;

            if (confirmPassword.length > 0) {
                const matches = password === confirmPassword;

                if (matchIndicator) {
                    matchIndicator.innerHTML = matches
                        ? '<i class="fas fa-check-circle" style="color: #16a34a;"></i>'
                        : '<i class="fas fa-times-circle" style="color: #ef4444;"></i>';
                }

                return matches;
            }

            if (matchIndicator) {
                matchIndicator.innerHTML = '';
            }
            return true;
        }

        confirmPasswordInput.addEventListener('input', checkPasswordMatch);
        passwordInput.addEventListener('input', checkPasswordMatch);
    }

    // Username availability checker (simulated)
    if (usernameInput) {
        let usernameTimeout;
        const availabilityIndicator = document.getElementById('username-availability');

        usernameInput.addEventListener('input', function() {
            clearTimeout(usernameTimeout);
            const username = this.value.trim();

            if (username.length >= 3) {
                if (availabilityIndicator) {
                    availabilityIndicator.innerHTML = '<i class="fas fa-spinner fa-spin" style="color: #6b7280;"></i>';
                }

                usernameTimeout = setTimeout(() => {
                    // Simulate API call
                    const isAvailable = !['admin', 'test', 'user', 'root'].includes(username.toLowerCase());

                    if (availabilityIndicator) {
                        availabilityIndicator.innerHTML = isAvailable
                            ? '<i class="fas fa-check-circle" style="color: #16a34a;"></i>'
                            : '<i class="fas fa-times-circle" style="color: #ef4444;"></i>';
                    }
                }, 1000);
            } else if (availabilityIndicator) {
                availabilityIndicator.innerHTML = '';
            }
        });
    }

    // Comprehensive form validation
    function validateField(input, errorElementId) {
        const errorElement = document.getElementById(errorElementId);
        if (!errorElement) return true;

        let isValid = true;
        let errorMessage = '';

        const value = input.value.trim();
        const fieldName = input.labels[0]?.textContent?.replace(/\s*\(.*?\)\s*/g, '') || 'Field';

        // Required field validation
        if (input.hasAttribute('required') && !value) {
            isValid = false;
            errorMessage = `${fieldName} is required`;
        } else if (value) {
            // Field-specific validation
            switch (input.id) {
                case 'first_name':
                case 'last_name':
                    if (value.length < 2) {
                        isValid = false;
                        errorMessage = `${fieldName} must be at least 2 characters`;
                    } else if (!/^[a-zA-Z\s'-]+$/.test(value)) {
                        isValid = false;
                        errorMessage = `${fieldName} can only contain letters, spaces, hyphens, and apostrophes`;
                    }
                    break;

                case 'username':
                    if (value.length < 3 || value.length > 20) {
                        isValid = false;
                        errorMessage = 'Username must be 3-20 characters';
                    } else if (!/^[a-zA-Z0-9_]+$/.test(value)) {
                        isValid = false;
                        errorMessage = 'Username can only contain letters, numbers, and underscores';
                    }
                    break;

                case 'email':
                    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                    if (!emailRegex.test(value)) {
                        isValid = false;
                        errorMessage = 'Please enter a valid email address';
                    }
                    break;

                case 'phone_number':
                    if (value && !/^\+?[\d\s\-\(\)]+$/.test(value)) {
                        isValid = false;
                        errorMessage = 'Please enter a valid phone number';
                    }
                    break;

                case 'password':
                    const strength = checkPasswordStrength(value);
                    if (strength.score < 3) {
                        isValid = false;
                        errorMessage = `Password needs: ${strength.feedback.join(', ')}`;
                    }
                    break;

                case 'confirm_password':
                    if (value !== passwordInput?.value) {
                        isValid = false;
                        errorMessage = 'Passwords do not match';
                    }
                    break;
            }
        }

        // Update UI
        if (isValid) {
            input.classList.remove('nvc-form-error');
            input.classList.add('nvc-form-success');
            errorElement.textContent = '';
            errorElement.style.display = 'none';
        } else {
            input.classList.remove('nvc-form-success');
            input.classList.add('nvc-form-error');
            errorElement.textContent = errorMessage;
            errorElement.style.display = 'block';
        }

        return isValid;
    }

    // Add validation listeners to all form fields
    function addValidationListeners() {
        // Get all form inputs and selects
        const allFormFields = document.querySelectorAll('input, select, textarea');

        allFormFields.forEach(field => {
            if (field.type !== 'hidden' && field.type !== 'radio' && field.type !== 'checkbox') {
                const errorId = field.id + '-error';

                field.addEventListener('blur', () => {
                    if (field.hasAttribute('required') || field.value.trim() !== '') {
                        validateDynamicField(field, errorId);
                    }
                });

                field.addEventListener('input', () => {
                    if (field.classList.contains('nvc-form-error')) {
                        validateDynamicField(field, errorId);
                    }
                });
            }
        });
    }

    // Enhanced validation for dynamic fields
    function validateDynamicField(input, errorElementId) {
        const errorElement = document.getElementById(errorElementId);
        if (!errorElement) return true;

        let isValid = true;
        let errorMessage = '';
        const value = input.value.trim();
        const fieldName = input.labels[0]?.textContent?.replace(/\s*\(.*?\)\s*/g, '') || 'Field';

        // Required field validation
        if (input.hasAttribute('required') && !value) {
            isValid = false;
            errorMessage = `${fieldName} is required`;
        } else if (value) {
            // Field-specific validation based on field ID patterns
            if (input.id.includes('first_name') || input.id.includes('last_name')) {
                if (value.length < 2) {
                    isValid = false;
                    errorMessage = `${fieldName} must be at least 2 characters`;
                } else if (!/^[a-zA-Z\s'-]+$/.test(value)) {
                    isValid = false;
                    errorMessage = `${fieldName} can only contain letters, spaces, hyphens, and apostrophes`;
                }
            } else if (input.id === 'username') {
                if (value.length < 3 || value.length > 20) {
                    isValid = false;
                    errorMessage = 'Username must be 3-20 characters';
                } else if (!/^[a-zA-Z0-9_]+$/.test(value)) {
                    isValid = false;
                    errorMessage = 'Username can only contain letters, numbers, and underscores';
                }
            } else if (input.id === 'email') {
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                if (!emailRegex.test(value)) {
                    isValid = false;
                    errorMessage = 'Please enter a valid email address';
                }
            } else if (input.id === 'phone_number') {
                if (value && !/^\+?[\d\s\-\(\)]+$/.test(value)) {
                    isValid = false;
                    errorMessage = 'Please enter a valid phone number';
                }
            } else if (input.id.includes('ssn')) {
                if (!/^\d{3}-?\d{2}-?\d{4}$/.test(value)) {
                    isValid = false;
                    errorMessage = 'Please enter a valid SSN (XXX-XX-XXXX)';
                }
            } else if (input.id.includes('ein')) {
                if (!/^\d{2}-?\d{7}$/.test(value)) {
                    isValid = false;
                    errorMessage = 'Please enter a valid EIN (XX-XXXXXXX)';
                }
            } else if (input.id.includes('date_of_birth')) {
                const birthDate = new Date(value);
                const today = new Date();
                const age = today.getFullYear() - birthDate.getFullYear();
                if (age < 18) {
                    isValid = false;
                    errorMessage = 'You must be at least 18 years old';
                }
            } else if (input.id === 'postal_code') {
                // Basic postal code validation (can be enhanced based on country)
                if (!/^[A-Za-z0-9\s\-]{3,10}$/.test(value)) {
                    isValid = false;
                    errorMessage = 'Please enter a valid postal code';
                }
            }
        }

        // Update UI based on validation result
        if (isValid) {
            input.classList.remove('nvc-form-error');
            input.classList.add('nvc-form-success');
            errorElement.textContent = '';
            errorElement.style.display = 'none';
        } else {
            input.classList.remove('nvc-form-success');
            input.classList.add('nvc-form-error');
            errorElement.textContent = errorMessage;
            errorElement.style.display = 'block';
        }

        return isValid;
    }

    // Initialize validation listeners
    addValidationListeners();

    // Form progress tracking
    function checkFormProgress() {
        const selectedAccountType = document.querySelector('input[name="account_type"]:checked');
        const requiredFields = document.querySelectorAll('input[required], select[required]');
        let filledFields = 0;
        let totalFields = 0;

        requiredFields.forEach(field => {
            if (field.offsetParent !== null && field.type !== 'radio') {
                totalFields++;
                if (field.value.trim() !== '') {
                    filledFields++;
                }
            }
        });

        // Update progress based on completion
        if (selectedAccountType && totalFields > 0) {
            const progressPercentage = (filledFields / totalFields) * 100;

            if (progressPercentage >= 80) {
                updateProgressStep(4); // Complete
            } else if (progressPercentage >= 50) {
                updateProgressStep(3); // Security
            } else if (filledFields > 0) {
                updateProgressStep(2); // Information
            }
        }
    }

    // Add progress tracking to form inputs
    document.addEventListener('input', function(e) {
        if (e.target.matches('input, select')) {
            setTimeout(checkFormProgress, 100);
        }
    });

    // Enhanced form submission with better UX
    function enhanceFormSubmission() {
        const form = document.querySelector('.nvc-auth-form-container');
        if (!form) return;

        form.addEventListener('submit', function(e) {
            e.preventDefault();

            // Update progress to final step
            updateProgressStep(4);

            // Show processing state
            const submitBtn = form.querySelector('button[type="submit"]');
            if (submitBtn) {
                const originalContent = submitBtn.innerHTML;
                submitBtn.innerHTML = `
                    <span class="nvc-btn-content">
                        <i class="fas fa-spinner fa-spin" aria-hidden="true"></i>
                        Creating Account...
                    </span>
                `;
                submitBtn.disabled = true;

                // Simulate processing (replace with actual form submission)
                setTimeout(() => {
                    // Reset button state (remove in production)
                    submitBtn.innerHTML = originalContent;
                    submitBtn.disabled = false;

                    // Show success message (replace with actual redirect)
                    alert('Account creation successful! Redirecting to dashboard...');
                }, 2000);
            }
        });
    }

    // Initialize enhanced form submission
    enhanceFormSubmission();

    // Terms checkbox validation
    if (termsCheckbox) {
        termsCheckbox.addEventListener('change', function() {
            const errorElement = document.getElementById('terms-error');
            if (errorElement) {
                if (this.checked) {
                    errorElement.style.display = 'none';
                } else {
                    errorElement.textContent = 'You must agree to the Terms of Service and Privacy Policy';
                    errorElement.style.display = 'block';
                }
            }
        });
    }

    // Enhanced form submission with session logging
    if (form && submitBtn) {
        form.addEventListener('submit', function(e) {
            e.preventDefault();

            // Validate account type selection
            const selectedAccountType = document.querySelector('input[name="account_type"]:checked');
            let accountTypeValid = true;

            if (!selectedAccountType) {
                accountTypeValid = false;
                // Show error message for account type
                const accountTypeSection = document.querySelector('.nvc-account-type-section');
                if (accountTypeSection) {
                    let errorElement = accountTypeSection.querySelector('.nvc-account-type-error');
                    if (!errorElement) {
                        errorElement = document.createElement('div');
                        errorElement.className = 'nvc-account-type-error nvc-form-error';
                        errorElement.setAttribute('role', 'alert');
                        errorElement.setAttribute('aria-live', 'polite');
                        accountTypeSection.appendChild(errorElement);
                    }
                    errorElement.textContent = 'Please select an account type';
                    errorElement.style.display = 'block';
                }
            } else {
                // Remove error message if account type is selected
                const errorElement = document.querySelector('.nvc-account-type-error');
                if (errorElement) {
                    errorElement.style.display = 'none';
                }
            }

            // Validate all visible and required fields dynamically
            const allRequiredFields = document.querySelectorAll('input[required], select[required]');
            const validations = [];

            allRequiredFields.forEach(field => {
                // Only validate visible fields
                if (field.offsetParent !== null && field.type !== 'radio') {
                    const errorId = field.id + '-error';
                    const isValid = validateDynamicField(field, errorId);
                    validations.push(isValid);
                }
            });

            // Special validation for password confirmation
            if (passwordInput && confirmPasswordInput) {
                const passwordsMatch = passwordInput.value === confirmPasswordInput.value;
                if (!passwordsMatch) {
                    const confirmError = document.getElementById('confirm-password-error');
                    if (confirmError) {
                        confirmError.textContent = 'Passwords do not match';
                        confirmError.style.display = 'block';
                        confirmPasswordInput.classList.add('nvc-form-error');
                    }
                    validations.push(false);
                } else {
                    const confirmError = document.getElementById('confirm-password-error');
                    if (confirmError) {
                        confirmError.style.display = 'none';
                        confirmPasswordInput.classList.remove('nvc-form-error');
                    }
                    validations.push(true);
                }
            }

            // Check terms acceptance
            const termsValid = !termsCheckbox || termsCheckbox.checked;
            if (!termsValid) {
                const termsError = document.getElementById('terms-error');
                if (termsError) {
                    termsError.textContent = 'You must agree to the Terms of Service and Privacy Policy';
                    termsError.style.display = 'block';
                }
            }

            const allValid = validations.every(v => v) && termsValid && accountTypeValid;

            if (!allValid) {
                if (registerStatus) {
                    registerStatus.textContent = 'Please correct the errors above';
                    registerStatus.className = 'nvc-form-status nvc-form-status-error';
                }
                return;
            }

            // Log registration attempt for audit
            console.log('Registration attempt initiated:', {
                timestamp: new Date().toISOString(),
                accountType: selectedAccountType?.value,
                username: usernameInput?.value,
                email: emailInput?.value,
                userAgent: navigator.userAgent,
                sessionId: 'session_' + Date.now() // In real app, get from server
            });

            // Show loading state
            const btnContent = submitBtn.querySelector('.nvc-btn-content');
            const btnLoading = submitBtn.querySelector('.nvc-btn-loading');

            if (btnContent && btnLoading) {
                btnContent.style.display = 'none';
                btnLoading.style.display = 'inline-flex';
            }

            submitBtn.disabled = true;
            submitBtn.setAttribute('aria-busy', 'true');

            if (registerStatus) {
                registerStatus.textContent = 'Creating your account...';
                registerStatus.className = 'nvc-form-status nvc-form-status-info';
            }

            // Submit the form
            setTimeout(() => {
                form.submit();
            }, 500);

            // Fallback reset (in case submission fails)
            setTimeout(() => {
                if (btnContent && btnLoading) {
                    btnContent.style.display = 'inline-flex';
                    btnLoading.style.display = 'none';
                }
                submitBtn.disabled = false;
                submitBtn.removeAttribute('aria-busy');

                if (registerStatus) {
                    registerStatus.textContent = 'Registration attempt timed out. Please try again.';
                    registerStatus.className = 'nvc-form-status nvc-form-status-error';
                }
            }, 15000);
        });
    }

    // Alert dismissal
    const alertCloseButtons = document.querySelectorAll('.nvc-alert-close');
    alertCloseButtons.forEach(button => {
        button.addEventListener('click', function() {
            const alert = this.closest('.nvc-alert');
            if (alert) {
                alert.style.opacity = '0';
                alert.style.transform = 'translateY(-10px)';
                setTimeout(() => {
                    alert.remove();
                }, 300);
            }
        });
    });

    // Accessibility enhancements
    const focusableElements = document.querySelectorAll('button, a, input, select, textarea, [tabindex]:not([tabindex="-1"])');
    focusableElements.forEach(element => {
        element.addEventListener('focus', function() {
            this.style.outline = '2px solid #2563eb';
            this.style.outlineOffset = '2px';
        });

        element.addEventListener('blur', function() {
            this.style.outline = '';
            this.style.outlineOffset = '';
        });
    });

    // Auto-focus first name field on page load
    if (firstNameInput && !firstNameInput.value) {
        setTimeout(() => {
            firstNameInput.focus();
        }, 100);
    }
});
</script>

<!-- Registration page now uses central CSS for responsive design -->
<!-- All responsive utilities are available via nvc-central-theme.css -->














{% endblock %}
